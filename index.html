<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        body {
            font-family: 'Courier New', monospace;
            background: #0f0f0f;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        #game-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #1a1a1a;
            border: 2px solid #444;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 25px #ff4500;
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
        .property-card {
            background: #252525;
            border-left: 4px solid #ff4500;
            padding: 10px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .mission-item {
            background: #2a2a2a;
            border: 1px solid #555;
            padding: 8px;
            margin: 5px 0;
        }
        #crypto-chart {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .skill-bar {
            height: 10px;
            background: #333;
            margin: 5px 0;
            border-radius: 5px;
        }
        .skill-progress {
            height: 100%;
            background: #ff4500;
            border-radius: 5px;
            width: 0%;
        }
        .universe-card {
            background: linear-gradient(135deg, #1e0033 0%, #3c0066 100%);
            border: 1px solid #8a2be2;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .universe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(138, 43, 226, 0.4);
        }
        .apocalypse-event {
            background-color: #330000;
            border-left: 4px solid #ff0000;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        #multiplayer-tab {
            background: #001a33;
            border: 1px solid #0077cc;
        }
        #deep-state-tab {
            background: #003314;
            border: 1px solid #00cc66;
        }
        .tab-content {
            display: none;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .tab-button {
            background: #333;
            border: none;
            padding: 10px 15px;
            margin-right: 5px;
            cursor: pointer;
        }
        .tab-button.active {
            background: #555;
            border-bottom: 2px solid #ff4500;
        }
        #lab-container {
            background: #1a1a2e;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .chemical-slot {
            width: 60px;
            height: 60px;
            background: #333;
            border: 2px dashed #666;
            display: inline-block;
            margin: 5px;
            text-align: center;
            line-height: 60px;
            cursor: pointer;
        }
        .stat {
            display: inline-block;
            margin: 0 15px;
            text-align: center;
        }
        .stat-value {
            font-size: 1.5em;
            color: #ff4500;
        }
        .message {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        .message.success {
            background: #1a2a1a;
            border-left: 4px solid #00ff7f;
        }
        .message.alert {
            background: #2a1a1a;
            border-left: 4px solid #ff0000;
        }
        .message.event {
            background: #1a1a2a;
            border-left: 4px solid #8a2be2;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>ğŸ‘‘ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h1>
        
        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
        <div id="stats">
            <div class="stat">
                <div>ğŸ’° Ø§Ù„Ù…Ø§Ù„</div>
                <div class="stat-value" id="money">10000</div>
            </div>
            <div class="stat">
                <div>ğŸ’Š Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª</div>
                <div class="stat-value" id="drugs">0</div>
            </div>
            <div class="stat">
                <div>ğŸ”« Ø§Ù„Ø£Ø³Ù„Ø­Ø©</div>
                <div class="stat-value" id="weapons">0</div>
            </div>
            <div class="stat">
                <div>ğŸ“Š Ø§Ù„Ù…Ù‡Ø§Ø±Ø©</div>
                <div class="stat-value" id="skill-level">1</div>
            </div>
            <div class="stat">
                <div>ğŸ“… Ø§Ù„ÙŠÙˆÙ…</div>
                <div class="stat-value" id="day">1</div>
            </div>
        </div>
        
        <!-- Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
        <div class="tab-system">
            <button class="tab-button active" onclick="openTab('main-tab')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
            <button class="tab-button" onclick="openTab('properties-tab')">Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</button>
            <button class="tab-button" onclick="openTab('missions-tab')">Ø§Ù„Ù…Ù‡Ø§Ù…</button>
            <button class="tab-button" onclick="openTab('skills-tab')">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</button>
            <button class="tab-button" onclick="openTab('crypto-tab')">Ø§Ù„ÙƒØ±ÙŠØ¨ØªÙˆ</button>
            <button class="tab-button" id="universes-tab-btn" onclick="openTab('universes-tab')" style="display:none;">Ø§Ù„Ø£ÙƒÙˆØ§Ù†</button>
            <button class="tab-button" id="apocalypse-tab-btn" onclick="openTab('apocalypse-tab')" style="display:none;">Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</button>
            <button class="tab-button" id="multiplayer-tab-btn" onclick="openTab('multiplayer-tab')" style="display:none;">Ù…ØªØ¹Ø¯Ø¯</button>
            <button class="tab-button" id="lab-tab-btn" onclick="openTab('lab-tab')" style="display:none;">Ø§Ù„Ù…Ø®ØªØ¨Ø±</button>
        </div>
        
        <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
        <div id="main-tab" class="tab-content">
            <div id="messages"></div>
            <button onclick="nextDay()">Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ</button>
            <button onclick="buyDrugs(100)">Ø´Ø±Ø§Ø¡ 100g Ù…Ø®Ø¯Ø±Ø§Øª ($5000)</button>
            <button onclick="sellDrugs(100)">Ø¨ÙŠØ¹ 100g Ù…Ø®Ø¯Ø±Ø§Øª ($7000)</button>
            <button onclick="buyWeapons(10)">Ø´Ø±Ø§Ø¡ 10 Ø£Ø³Ù„Ø­Ø© ($3000)</button>
        </div>
        
        <div id="properties-tab" class="tab-content" style="display:none;">
            <h3>ğŸ¢ Ù…Ù…ØªÙ„ÙƒØ§ØªÙƒ</h3>
            <div id="properties-list"></div>
            <button id="buy-property">Ø´Ø±Ø§Ø¡ Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯</button>
        </div>
        
        <div id="missions-tab" class="tab-content" style="display:none;">
            <h3>ğŸ¯ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
            <div id="missions-list"></div>
        </div>
        
        <div id="skills-tab" class="tab-content" style="display:none;">
            <h3>ğŸ“š Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h3>
            <div id="skills-tree"></div>
        </div>
        
        <div id="crypto-tab" class="tab-content" style="display:none;">
            <h3>â‚¿ Ø³ÙˆÙ‚ Ø§Ù„ÙƒØ±ÙŠØ¨ØªÙˆ</h3>
            <div id="crypto-prices"></div>
            <canvas id="crypto-chart" width="400" height="200"></canvas>
        </div>
        
        <div id="universes-tab" class="tab-content" style="display:none;">
            <h3>ğŸŒŒ Ø§Ù„Ø£ÙƒÙˆØ§Ù† Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠØ©</h3>
            <div id="universes-list"></div>
            <button id="jump-universe">Ù‚ÙØ² Ø¥Ù„Ù‰ ÙƒÙˆÙ† Ø¹Ø´ÙˆØ§Ø¦ÙŠ (10 Ø£ÙŠØ§Ù…)</button>
        </div>
        
        <div id="apocalypse-tab" class="tab-content" style="display:none;">
            <h3>ğŸ’¥ Ø£Ø­Ø¯Ø§Ø« Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù„Ù…</h3>
            <div id="apocalypse-events"></div>
        </div>
        
        <div id="multiplayer-tab" class="tab-content" style="display:none;">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="openMultiTab('global-market-tab')">Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ</button>
                <button class="tab-button" onclick="openMultiTab('deep-state-tab')">Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø§Ù„Ø®ÙÙŠØ©</button>
            </div>
            
            <div id="global-market-tab" class="tab-content">
                <h4>ğŸŒ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø£Ø³ÙˆØ¯ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ</h4>
                <div id="global-market"></div>
                <button id="refresh-market">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
            </div>
            
            <div id="deep-state-tab" class="tab-content" style="display:none;">
                <h4>ğŸ•µï¸â€â™‚ï¸ Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø§Ù„Ø®ÙÙŠØ©</h4>
                <div id="factions-list"></div>
            </div>
        </div>
        
        <div id="lab-tab" class="tab-content" style="display:none;">
            <h3>âš—ï¸ Ù…Ø®ØªØ¨Ø± Ø§Ù„ØªØµÙ†ÙŠØ¹ Ø§Ù„Ø³Ø±ÙŠ</h3>
            <div id="lab-container">
                <div id="chemical-slots"></div>
                <button id="craft-drug">ØµÙ†Ø¹ Ù…Ø®Ø¯Ø± Ø¬Ø¯ÙŠØ¯</button>
                <div id="lab-results"></div>
            </div>
        </div>
    </div>

    <script>
        // ======== Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ======== //
        const state = {
            money: 10000,
            drugs: 0,
            weapons: 0,
            drugPrice: 70,
            weaponPrice: 300,
            reputation: 50,
            policeSuspicion: 0,
            crew: 5,
            day: 1,
            currentUniverse: "default",
            unlockedSections: {
                universes: false,
                apocalypse: false,
                multiplayer: false,
                lab: false
            },
            gangs: [
                { name: "Ø§Ù„Ù…Ø§ÙÙŠØ§ Ø§Ù„Ø±ÙˆØ³ÙŠØ©", power: 30 },
                { name: "Ø¹ØµØ§Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØ³ÙŠÙƒ", power: 25 }
            ]
        };

        // ======== Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ======== //
        
        // 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
        const properties = {
            list: [
                { id: 1, name: "Ø´Ù‚Ø© Ø¢Ù…Ù†Ø©", price: 50000, income: 2000, owned: false },
                { id: 2, name: "Ù…Ø®Ø²Ù† Ø³Ø±ÙŠ", price: 100000, income: 5000, owned: false }
            ],
            buyProperty(id) {
                const property = this.list.find(p => p.id === id);
                if (property && !property.owned && state.money >= property.price) {
                    property.owned = true;
                    state.money -= property.price;
                    addMessage(`âœ… Ø§Ø´ØªØ±ÙŠØª ${property.name}! Ø¯Ø®Ù„ ÙŠÙˆÙ…ÙŠ: $${property.income}`, "success");
                    updatePropertiesUI();
                    updateUI();
                }
            },
            collectIncome() {
                this.list.forEach(p => {
                    if (p.owned) state.money += p.income;
                });
            }
        };

        // 2. Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ù…
        const missions = {
            active: [],
            generateDailyMissions() {
                this.active = [
                    { id: 1, title: "ØªÙ‡Ø±ÙŠØ¨ Ø´Ø­Ù†Ø© ØµØºÙŠØ±Ø©", reward: 5000, risk: 0.3, completed: false },
                    { id: 2, title: "Ø±Ø´ÙˆØ© Ø¶Ø§Ø¨Ø·", reward: 3000, risk: 0.5, completed: false }
                ];
                updateMissionsUI();
            },
            completeMission(id) {
                const mission = this.active.find(m => m.id === id);
                if (mission && !mission.completed) {
                    mission.completed = true;
                    state.money += mission.reward;
                    state.policeSuspicion += mission.risk * 10;
                    addMessage(`ğŸ‰ Ø£ÙƒÙ…Ù„Øª Ø§Ù„Ù…Ù‡Ù…Ø©: ${mission.title}! Ø±Ø¨Ø­Øª $${mission.reward}`, "success");
                    updateMissionsUI();
                    updateUI();
                }
            }
        };

        // 3. Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª
        const skills = {
            list: [
                { id: 1, name: "Ø§Ù„ØªØ®ÙˆÙŠÙ", level: 1, exp: 0, expToNext: 100 },
                { id: 2, name: "Ø§Ù„ØªÙØ§ÙˆØ¶", level: 1, exp: 0, expToNext: 100 }
            ],
            addExp(skillId, amount) {
                const skill = this.list.find(s => s.id === skillId);
                if (skill) {
                    skill.exp += amount;
                    if (skill.exp >= skill.expToNext) {
                        skill.level++;
                        skill.exp -= skill.expToNext;
                        skill.expToNext = Math.floor(skill.expToNext * 1.5);
                        addMessage(`ğŸ“ˆ Ø§Ø±ØªÙØ¹Øª Ù…Ù‡Ø§Ø±Ø© ${skill.name} Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${skill.level}!`, "success");
                    }
                    updateSkillsUI();
                    updateUI();
                }
            }
        };

        // 4. Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ±ÙŠØ¨ØªÙˆ
        const crypto = {
            prices: {
                bitcoin: { value: 50000, history: [] },
                monero: { value: 300, history: [] }
            },
            portfolio: {
                bitcoin: 0,
                monero: 0
            },
            updatePrices() {
                Object.keys(this.prices).forEach(crypto => {
                    const change = (Math.random() - 0.5) * 0.1;
                    this.prices[crypto].value *= (1 + change);
                    this.prices[crypto].history.push(this.prices[crypto].value);
                    if (this.prices[crypto].history.length > 20) {
                        this.prices[crypto].history.shift();
                    }
                });
                updateCryptoUI();
            },
            buy(cryptoName, amount) {
                const cost = this.prices[cryptoName].value * amount;
                if (state.money >= cost) {
                    this.portfolio[cryptoName] += amount;
                    state.money -= cost;
                    addMessage(`âœ… Ø§Ø´ØªØ±ÙŠØª ${amount} ${cryptoName}`, "success");
                    updateCryptoUI();
                    updateUI();
                }
            }
        };

        // ======== Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ======== //
        
        // 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø£ÙƒÙˆØ§Ù† Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠØ©
        const parallelUniverses = {
            mafiaVerse: { 
                name: "Ø¹Ø§Ù„Ù… Ø§Ù„Ù…Ø§ÙÙŠØ§",
                drugPriceModifier: 0.5, 
                policeAggression: 2.0,
                specialEvent: "Ø­Ø±Ø¨ Ø§Ù„Ù…Ø§ÙÙŠØ§ Ø§Ù„Ø£Ø¨Ø¯ÙŠØ©",
                color: "#8B0000"
            },
            cyberPunkVerse: { 
                name: "Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ",
                drugPriceModifier: 3.0, 
                policeAggression: 0.2,
                specialEvent: "Ù‚Ø±ØµÙ†Ø© Ø§Ù„Ø¹Ù‚ÙˆÙ„",
                color: "#00FF7F"
            },
            zombieVerse: {
                name: "Ø¹Ø§Ù„Ù… Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ",
                drugPriceModifier: 1.5,
                policeAggression: 0.1,
                specialEvent: "ÙˆØ¨Ø§Ø¡ Ø§Ù„Ø²ÙˆÙ…Ø¨ÙŠ",
                color: "#32CD32"
            },
            fantasyVerse: {
                name: "Ø¹Ø§Ù„Ù… Ø§Ù„ÙØ§Ù†ØªØ§Ø²ÙŠØ§",
                drugPriceModifier: 2.0,
                policeAggression: 0.5,
                specialEvent: "ØªÙ†Ø§Ù†ÙŠÙ† ØªÙ‡Ø±Ø¨ Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª",
                color: "#9370DB"
            }
        };

        // 2. Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ù…Ø¹Ø§Ø¯ÙŠ
        class NemesisAI {
            constructor() {
                this.model = null;
                this.playerActions = [];
                this.backupPlans = ["Ø§Ù†Ù‚Ù„Ø§Ø¨ Ø¹Ø³ÙƒØ±ÙŠ", "ØªÙØ¬ÙŠØ± Ø§Ù„Ø³ÙˆÙ‚", "Ø¥Ø®ØªØ±Ø§Ù‚ Ø¨Ù†ÙƒÙƒ"];
                this.initModel();
            }

            async initModel() {
                this.model = tf.sequential();
                this.model.add(tf.layers.dense({units: 16, activation: 'relu', inputShape: [8]}));
                this.model.add(tf.layers.dense({units: 8, activation: 'relu'}));
                this.model.add(tf.layers.dense({units: 4, activation: 'softmax'}));
                
                this.model.compile({
                    optimizer: 'adam',
                    loss: 'categoricalCrossentropy',
                    metrics: ['accuracy']
                });
            }

            logAction(action) {
                this.playerActions.push(action);
                if (this.playerActions.length > 50) {
                    this.trainModel();
                }
            }

            async trainModel() {
                const actions = this.playerActions.map(a => this.encodeAction(a));
                const xs = tf.tensor2d(actions);
                const ys = tf.oneHot(tf.tensor1d(actions.map((_, i) => i % 4), 'int32', 4);
                
                await this.model.fit(xs, ys, {
                    epochs: 10,
                    batchSize: 8
                });
            }

            encodeAction(action) {
                return [
                    state.money / 100000,
                    state.drugs / 1000,
                    state.weapons / 50,
                    state.reputation / 100,
                    state.policeSuspicion / 10,
                    state.crew / 20,
                    state.day / 100,
                    action.length / 20
                ];
            }

            predictNextAction() {
                if (this.playerActions.length < 10) return null;
                
                const lastAction = this.encodeAction(this.playerActions[this.playerActions.length-1]);
                const prediction = this.model.predict(tf.tensor2d([lastAction]));
                const predictedAction = prediction.argMax(1).dataSync()[0];
                
                return ["Ù‡Ø¬ÙˆÙ…", "Ø¯ÙØ§Ø¹", "ØªÙˆØ³Ø¹", "ØªØ­Ø§Ù„Ù"][predictedAction];
            }

            executeCounterAction() {
                const predictedAction = this.predictNextAction();
                if (!predictedAction) return;
                
                if (predictedAction === "Ù‡Ø¬ÙˆÙ…" && Math.random() < 0.7) {
                    addMessage(`ğŸ›¡ï¸ Ø§Ù„Ø¹Ø¯Ùˆ ÙŠØªÙˆÙ‚Ø¹ Ù‡Ø¬ÙˆÙ…Ùƒ ÙˆÙŠØ¬Ù‡Ø² Ø¯ÙØ§Ø¹Ø§ØªÙ‡!`, "alert");
                    state.gangs.forEach(g => g.power += 5);
                }
            }
        }

        // 3. Ø£Ø­Ø¯Ø§Ø« Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ø§Ù„Ù…
        const apocalypseEvents = [
            {
                name: "ØºØ²Ùˆ ÙØ¶Ø§Ø¦ÙŠ Ù„Ù„Ù…Ø®Ø¯Ø±Ø§Øª",
                effect: () => {
                    state.drugPrice *= 0.1;
                    addMessage(`ğŸ‘½ Ø§Ù„ÙØ¶Ø§Ø¦ÙŠÙˆÙ† ØºØ²ÙˆØ§ Ø§Ù„Ø£Ø±Ø¶ Ø¨Ù…ÙˆØ§Ø¯ Ù…Ø®Ø¯Ø±Ø© Ø±Ø®ÙŠØµØ©! Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù†Ø®ÙØ¶Øª 90%`, "apocalypse-event");
                },
                probability: 0.001
            },
            {
                name: "Ø«ÙˆØ±Ø© Ø§Ù„Ø±ÙˆØ¨ÙˆØªØ§Øª",
                effect: () => {
                    state.weapons = 0;
                    addMessage(`ğŸ¤– Ø§Ù„Ø±ÙˆØ¨ÙˆØªØ§Øª ØªØ¹Ø·Ù„Øª Ø¬Ù…ÙŠØ¹ Ø£Ø³Ù„Ø­ØªÙƒ! Ø£Ù†Øª Ø£Ø¹Ø²Ù„ Ø§Ù„Ø¢Ù†`, "apocalypse-event");
                },
                probability: 0.003
            },
            {
                name: "Ø§Ù†Ù‡ÙŠØ§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠ",
                effect: () => {
                    state.money = Math.floor(state.money * 0.0001);
                    addMessage(`ğŸ’¸ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù†Ù‡Ø§Ø±! Ø£Ù…ÙˆØ§Ù„Ùƒ Ø§Ù„Ø¢Ù† Ù„Ø§ ØªØ³Ø§ÙˆÙŠ Ø´ÙŠØ¦Ø§Ù‹`, "apocalypse-event");
                },
                probability: 0.005
            }
        ];

        // 4. Ù†Ø¸Ø§Ù… Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† (Ù…Ø­Ø§ÙƒØ§Ø©)
        const darkWebMarket = {
            players: [
                { name: "Ø³ÙŠØ¯ Ø§Ù„Ø¸Ù„Ø§Ù…", country: "Ø±ÙˆØ³ÙŠØ§", drugs: 1500, weapons: 45 },
                { name: "Ù‚Ø±ØµØ§Ù†", country: "Ø§Ù„ÙŠØ§Ø¨Ø§Ù†", drugs: 800, weapons: 30 },
                { name: "Ø§Ù„Ù…Ù„Ùƒ", country: "ÙƒÙˆÙ„ÙˆÙ…Ø¨ÙŠØ§", drugs: 5000, weapons: 100 }
            ],
            getGlobalPrices: function() {
                return {
                    drugPrice: Math.floor(state.drugPrice * (0.8 + Math.random() * 0.4)),
                    weaponPrice: Math.floor(state.weaponPrice * (0.7 + Math.random() * 0.6))
                };
            }
        };

        // 5. Ø§Ù„Ø­ÙƒÙˆÙ…Ø© Ø§Ù„Ø®ÙÙŠØ©
        const shadowGovernment = {
            factions: [
                {
                    name: "Ø§Ù„Ù…ØªÙ†ÙˆØ±ÙˆÙ†",
                    description: "ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù…Ù† Ø§Ù„Ø¸Ù„",
                    joinCondition: (state) => state.money > 1000000,
                    joined: false,
                    power: "ØªØªØ­ÙƒÙ… ÙÙŠ Ø£Ø³ÙˆØ§Ù‚ 10 Ø¯ÙˆÙ„"
                },
                {
                    name: "Ø§Ù„Ù†Ø®Ø¨Ø© Ø§Ù„ÙØ¶Ø§Ø¦ÙŠØ©",
                    description: "ØªÙ…ØªÙ„Ùƒ ØªÙ‚Ù†ÙŠØ§Øª Ø®Ø§Ø±Ù‚Ø© Ù…Ù† Ø®Ø§Ø±Ø¬ Ø§Ù„Ø£Ø±Ø¶",
                    joinCondition: (state) => state.suspicion === 0 && state.reputation === 100,
                    joined: false,
                    power: "Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø£Ø³Ù„Ø­Ø© ØºÙŠØ± ØªÙ‚Ù„ÙŠØ¯ÙŠØ©"
                }
            ],
            checkMembership: function() {
                this.factions.forEach(faction => {
                    if (!faction.joined && faction.joinCondition(state)) {
                        faction.joined = true;
                        addMessage(`ğŸ•¶ï¸ ØªÙ…Øª Ø¯Ø¹ÙˆØªÙƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ ${faction.name}! ${faction.power}`, "success");
                    }
                });
            }
        };

        // 6. Ù…Ø®ØªØ¨Ø± Ø§Ù„ØªØµÙ†ÙŠØ¹
        class DrugLab {
            constructor() {
                this.chemicals = ["Ù…ÙŠØ«Ø§Ù…ÙÙŠØªØ§Ù…ÙŠÙ†", "ÙƒÙˆÙƒØ§ÙŠÙŠÙ†", "Ø¥ÙƒØ³ØªØ§Ø³ÙŠ", "Ø£ÙÙŠÙˆÙ†", "Ù‚Ù†Ø¨", "ÙƒÙŠØªØ§Ù…ÙŠÙ†"];
                this.recipes = {
                    "Ø§Ù„Ø³Ù…Ø§Ø¡ Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡": { meth: 2, mercury: 1 },
                    "Ø§Ù„Ø´Ù…Ø³ Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡": { cocaine: 3, opium: 1 },
                    "Ø§Ù„ØºØ¨Ø§Ø± Ø§Ù„Ù†Ø¬Ù…ÙŠ": { ecstasy: 2, cannabis: 2 }
                };
                this.currentMix = [];
            }

            addChemical(chem) {
                if (this.currentMix.length < 4) {
                    this.currentMix.push(chem);
                    updateLabUI();
                }
            }

            craft() {
                let result = null;
                
                for (const [drug, recipe] of Object.entries(this.recipes)) {
                    const chemCount = {};
                    this.currentMix.forEach(chem => {
                        chemCount[chem] = (chemCount[chem] || 0) + 1;
                    });
                    
                    let match = true;
                    for (const [chem, count] of Object.entries(recipe)) {
                        if ((chemCount[chem] || 0) < count) {
                            match = false;
                            break;
                        }
                    }
                    
                    if (match) {
                        result = drug;
                        break;
                    }
                }
                
                if (result) {
                    const amount = Math.floor(Math.random() * 100) + 50;
                    state.drugs += amount;
                    addMessage(`âš—ï¸ Ù†Ø¬Ø­Øª ÙÙŠ ØªØµÙ†ÙŠØ¹ ${amount}g Ù…Ù† ${result}!`, "success");
                } else {
                    addMessage(`âš—ï¸ Ø§Ù„Ø®Ù„ÙŠØ· ÙØ´Ù„ ÙÙŠ Ø¥Ù†ØªØ§Ø¬ Ø£ÙŠ Ø´ÙŠØ¡ Ù…ÙÙŠØ¯!`, "alert");
                }
                
                this.currentMix = [];
                updateLabUI();
                updateUI();
            }
        }

        // ======== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© ======== //
        const nemesisAI = new NemesisAI();
        const drugLab = new DrugLab();

        // ======== ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ======== //
        function buyDrugs(amount) {
            const cost = amount * 50; // Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡ 50$ Ù„Ù„Ø¬Ø±Ø§Ù…
            if (state.money >= cost) {
                state.drugs += amount;
                state.money -= cost;
                addMessage(`âœ… Ø§Ø´ØªØ±ÙŠØª ${amount}g Ù…Ù† Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª Ø¨Ù€ $${cost}`, "success");
                updateUI();
            } else {
                addMessage(`âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ Ù…Ø§ ÙŠÙƒÙÙŠ Ù…Ù† Ø§Ù„Ù…Ø§Ù„ Ù„Ø´Ø±Ø§Ø¡ ${amount}g`, "alert");
            }
        }

        function sellDrugs(amount) {
            if (state.drugs >= amount) {
                const income = amount * state.drugPrice;
                state.drugs -= amount;
                state.money += income;
                addMessage(`ğŸ’° Ø¨Ø¹Øª ${amount}g Ù…Ù† Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª Ø¨Ù€ $${income}`, "success");
                updateUI();
            } else {
                addMessage(`âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ ${amount}g Ù…Ù† Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª Ù„Ù„Ø¨ÙŠØ¹`, "alert");
            }
        }

        function buyWeapons(amount) {
            const cost = amount * state.weaponPrice;
            if (state.money >= cost) {
                state.weapons += amount;
                state.money -= cost;
                addMessage(`ğŸ”« Ø§Ø´ØªØ±ÙŠØª ${amount} Ø³Ù„Ø§Ø­ Ø¨Ù€ $${cost}`, "success");
                updateUI();
            } else {
                addMessage(`âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ Ù…Ø§ ÙŠÙƒÙÙŠ Ù…Ù† Ø§Ù„Ù…Ø§Ù„ Ù„Ø´Ø±Ø§Ø¡ ${amount} Ø³Ù„Ø§Ø­`, "alert");
            }
        }

        function nextDay() {
            state.day++;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            properties.collectIncome();
            crypto.updatePrices();
            missions.generateDailyMissions();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
            checkApocalypse();
            nemesisAI.executeCounterAction();
            shadowGovernment.checkMembership();
            
            // ÙØªØ­ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ø§Ù„ØªØ¯Ø±Ø¬
            if (state.day === 10) unlockSection("universes");
            if (state.day === 20) unlockSection("apocalypse");
            if (state.day === 30) unlockSection("multiplayer");
            if (state.day === 40) unlockSection("lab");
            
            updateUI();
            addMessage(`ğŸŒ… Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙŠÙˆÙ… ${state.day}...`, "event");
        }

        function checkApocalypse() {
            if (state.day % 30 === 0) {
                apocalypseEvents.forEach(event => {
                    if (Math.random() < event.probability * 10) {
                        event.effect();
                    }
                });
            }
        }

        function jumpToUniverse() {
            const universeKeys = Object.keys(parallelUniverses);
            const randomUniverse = universeKeys[Math.floor(Math.random() * universeKeys.length)];
            state.currentUniverse = randomUniverse;
            
            const universe = parallelUniverses[randomUniverse];
            state.drugPrice *= universe.drugPriceModifier;
            state.policeSuspicion *= universe.policeAggression;
            
            addMessage(`ğŸª Ø¥Ù†ÙØªØ­ Ø¨ÙˆØ§Ø¨Ø© Ø¥Ù„Ù‰ ${universe.name}! ${universe.specialEvent}`, "event");
            addMessage(`ğŸ”® ØªØºÙŠØ±Øª Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ÙˆØ§Ù‚Ø¹: Ø³Ø¹Ø± Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª Ã—${universe.drugPriceModifier}ØŒ Ø´Ø±Ø§Ø³Ø© Ø§Ù„Ø´Ø±Ø·Ø© Ã—${universe.policeAggression}`, "event");
            
            updateUniverseUI();
            updateUI();
        }

        function unlockSection(section) {
            if (!state.unlockedSections[section]) {
                state.unlockedSections[section] = true;
                document.getElementById(`${section}-tab-btn`).style.display = 'inline-block';
                addMessage(`ğŸ”“ ØªÙ… ÙØªØ­ Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯: ${section.replace('-', ' ')}`, "success");
            }
        }

        function addMessage(text, type) {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            messageEl.textContent = text;
            document.getElementById('messages').prepend(messageEl);
            
            // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ¹Ù„ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            if (type !== 'event') {
                nemesisAI.logAction(text);
            }
        }

        // ======== ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ======== //
        function updateUI() {
            document.getElementById('money').textContent = state.money;
            document.getElementById('drugs').textContent = state.drugs;
            document.getElementById('weapons').textContent = state.weapons;
            document.getElementById('day').textContent = state.day;
        }

        function updatePropertiesUI() {
            let html = '';
            properties.list.forEach(prop => {
                html += `
                <div class="property-card" onclick="properties.buyProperty(${prop.id})" 
                     style="${prop.owned ? 'border-color:#00ff7f;background:#1a2a1a' : ''}">
                    <h4>${prop.name} ${prop.owned ? 'âœ…' : ''}</h4>
                    <p>Ø§Ù„Ø³Ø¹Ø±: $${prop.price.toLocaleString()}</p>
                    <p>Ø§Ù„Ø¯Ø®Ù„: $${prop.income}/ÙŠÙˆÙ…</p>
                </div>`;
            });
            document.getElementById('properties-list').innerHTML = html;
        }

        function updateMissionsUI() {
            let html = '';
            missions.active.forEach(mission => {
                html += `
                <div class="mission-item" onclick="missions.completeMission(${mission.id})"
                     style="${mission.completed ? 'opacity:0.5' : ''}">
                    <h4>${mission.title}</h4>
                    <p>Ø§Ù„Ù…ÙƒØ§ÙØ£Ø©: $${mission.reward}</p>
                    <p>Ø§Ù„Ø®Ø·Ø±: ${mission.risk * 100}%</p>
                    ${mission.completed ? '<p>âœ”ï¸ Ù…ÙƒØªÙ…Ù„</p>' : ''}
                </div>`;
            });
            document.getElementById('missions-list').innerHTML = html;
        }

        function updateSkillsUI() {
            let html = '';
            skills.list.forEach(skill => {
                const percent = Math.floor((skill.exp / skill.expToNext) * 100);
                html += `
                <div>
                    <h4>${skill.name} (Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${skill.level})</h4>
                    <div class="skill-bar">
                        <div class="skill-progress" style="width:${percent}%"></div>
                    </div>
                    <p>${skill.exp}/${skill.expToNext} Ø®Ø¨Ø±Ø©</p>
                </div>`;
            });
            document.getElementById('skills-tree').innerHTML = html;
        }

        function updateCryptoUI() {
            let html = `
            <div>
                <h4>â‚¿ Ø§Ù„Ø¨ÙŠØªÙƒÙˆÙŠÙ†: $${crypto.prices.bitcoin.value.toFixed(2)}</h4>
                <button onclick="crypto.buy('bitcoin', 1)">Ø´Ø±Ø§Ø¡ 1 Ø¨ÙŠØªÙƒÙˆÙŠÙ†</button>
                <p>ØªÙ…Ù„Ùƒ: ${crypto.portfolio.bitcoin}</p>
            </div>
            <div>
                <h4>â“‚ï¸ Ø§Ù„Ù…ÙˆÙ†ÙŠØ±Ùˆ: $${crypto.prices.monero.value.toFixed(2)}</h4>
                <button onclick="crypto.buy('monero', 10)">Ø´Ø±Ø§Ø¡ 10 Ù…ÙˆÙ†ÙŠØ±Ùˆ</button>
                <p>ØªÙ…Ù„Ùƒ: ${crypto.portfolio.monero}</p>
            </div>`;
            document.getElementById('crypto-prices').innerHTML = html;
            
            updateCryptoChart();
        }

        function updateCryptoChart() {
            const ctx = document.getElementById('crypto-chart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: crypto.prices.bitcoin.history.length}, (_, i) => i+1),
                    datasets: [
                        {
                            label: 'Ø¨ÙŠØªÙƒÙˆÙŠÙ†',
                            data: crypto.prices.bitcoin.history,
                            borderColor: '#f7931a',
                            tension: 0.1
                        },
                        {
                            label: 'Ù…ÙˆÙ†ÙŠØ±Ùˆ',
                            data: crypto.prices.monero.history,
                            borderColor: '#ff6600',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        function updateUniverseUI() {
            const universe = parallelUniverses[state.currentUniverse] || { name: "Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ", color: "#666" };
            
            document.getElementById('universes-list').innerHTML = `
                <div class="universe-card" style="border-color: ${universe.color}">
                    <h4>${universe.name}</h4>
                    <p>ğŸ“Œ ${universe.specialEvent || "Ù„Ø§ Ø£Ø­Ø¯Ø§Ø« Ø®Ø§ØµØ©"}</p>
                    <p>ğŸ’Š ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¹Ø±: Ã—${universe.drugPriceModifier || 1}</p>
                    <p>ğŸ‘® Ø´Ø±Ø§Ø³Ø© Ø§Ù„Ø´Ø±Ø·Ø©: Ã—${universe.policeAggression || 1}</p>
                </div>
            `;
        }

        function updateMultiplayerUI() {
            const prices = darkWebMarket.getGlobalPrices();
            document.getElementById('global-market').innerHTML = `
                <p>ğŸ’Š Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ: $${prices.drugPrice}</p>
                <p>ğŸ”« Ù…ØªÙˆØ³Ø· Ø³Ø¹Ø± Ø§Ù„Ø³Ù„Ø§Ø­ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ: $${prices.weaponPrice}</p>
                <h4>ğŸ‘¥ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù†Ø´Ø·ÙˆÙ†:</h4>
                <ul>
                    ${darkWebMarket.players.map(p => `<li>${p.name} (${p.country}): ${p.drugs}g Ù…Ø®Ø¯Ø±Ø§ØªØŒ ${p.weapons} Ø³Ù„Ø§Ø­</li>`).join('')}
                </ul>
            `;
            
            document.getElementById('factions-list').innerHTML = `
                ${shadowGovernment.factions.map(f => `
                    <div class="faction">
                        <h4>${f.name} ${f.joined ? 'âœ…' : ''}</h4>
                        <p>${f.description}</p>
                        <p>âš¡ Ø§Ù„Ù‚ÙˆØ©: ${f.power}</p>
                        <p>ğŸ”“ ${f.joined ? 'Ø¹Ø¶ÙˆÙŠØ© Ù†Ø´Ø·Ø©' : 'Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…: ' + 
                            (f.joinCondition.toString().match(/state\.money > (\d+)/) ? `Ø«Ø±ÙˆØ© > $${f.joinCondition.toString().match(/state\.money > (\d+)/)[1]}` : 
                             f.joinCondition.toString().match(/state\.suspicion === 0/) ? `Ø³Ù…Ø¹Ø© 100% Ø¨Ø¯ÙˆÙ† Ø´ÙƒÙˆÙƒ` : 'Ø´Ø±ÙˆØ· Ø³Ø±ÙŠØ©')}</p>
                    </div>
                `).join('')}
            `;
        }

        function updateLabUI() {
            document.getElementById('chemical-slots').innerHTML = '';
            
            state.drugLab.chemicals.forEach(chem => {
                const chemEl = document.createElement('div');
                chemEl.className = 'chemical-slot';
                chemEl.textContent = chem;
                chemEl.onclick = () => drugLab.addChemical(chem);
                document.getElementById('chemical-slots').appendChild(chemEl);
            });
            
            const mixEl = document.createElement('div');
            mixEl.style.margin = '15px 0';
            mixEl.innerHTML = `<h4>Ø§Ù„Ø®Ù„ÙŠØ· Ø§Ù„Ø­Ø§Ù„ÙŠ: ${drugLab.currentMix.join(' + ') || 'ÙØ§Ø±Øº'}</h4>`;
            document.getElementById('chemical-slots').appendChild(mixEl);
        }

        function openTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabId).style.display = 'block';
            event.currentTarget.classList.add('active');
        }

        function openMultiTab(tabId) {
            document.querySelectorAll('#multiplayer-tab .tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('#multiplayer-tab .tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(tabId).style.display = 'block';
            event.currentTarget.classList.add('active');
        }

        // ======== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© ======== //
        function initGame() {
            missions.generateDailyMissions();
            setInterval(() => crypto.updatePrices(), 30000);
            
            // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø§Øª
            updatePropertiesUI();
            updateMissionsUI();
            updateSkillsUI();
            updateCryptoUI();
            updateUI();
            
            // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
            document.getElementById('jump-universe').addEventListener('click', jumpToUniverse);
            document.getElementById('refresh-market').addEventListener('click', updateMultiplayerUI);
            document.getElementById('craft-drug').addEventListener('click', () => drugLab.craft());
            
            addMessage('ğŸŒƒ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø§Ù„Ø¬Ø±ÙŠÙ…Ø©! Ø§Ø¨Ø¯Ø£ Ø¨Ø¨Ù†Ø§Ø¡ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØªÙƒ Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª...', 'event');
        }

        initGame();
    </script>
</body>
</html>
