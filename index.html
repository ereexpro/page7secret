<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>👹 سلطان اللوجيستيك الشيطاني - السيطرة المطلقة</title>
<style>
  body {
    background: #0d0d0d;
    color: #e6e6e6;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    direction: rtl;
    padding: 20px;
    max-width: 1000px;
    margin: auto;
    user-select: none;
  }
  h1 {
    color: #ff1a1a;
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 0 0 20px #ff0000;
  }
  .status-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    font-size: 16px;
    color: #bbb;
  }
  .client, .competitor {
    background: #222;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 12px;
    box-shadow: 0 0 20px #ff0000;
    transition: box-shadow 0.4s ease;
  }
  .client:hover, .competitor:hover {
    box-shadow: 0 0 35px #ff4c4c;
  }
  .client h2, .competitor h3 {
    margin-top: 0;
    color: #ff6666;
    user-select: text;
  }
  .stock-bar {
    background: #444;
    border-radius: 12px;
    overflow: hidden;
    margin: 10px 0 10px 0;
    height: 24px;
  }
  .stock-fill {
    height: 100%;
    background: #ff4c4c;
    width: 0%;
    transition: width 0.7s ease;
  }
  button {
    background: #330000;
    color: #ff4c4c;
    border: none;
    border-radius: 10px;
    padding: 12px 20px;
    margin-top: 8px;
    cursor: pointer;
    font-weight: bold;
    width: 100%;
    transition: background 0.3s ease;
    user-select: none;
  }
  button:hover:not(:disabled) {
    background: #550000;
  }
  button:disabled {
    background: #111;
    cursor: not-allowed;
    color: #660000;
  }
  #events, #analytics {
    background: #111;
    border-radius: 12px;
    padding: 12px;
    max-height: 180px;
    overflow-y: auto;
    margin-bottom: 20px;
    font-size: 14px;
    box-shadow: inset 0 0 10px #440000;
  }
  #feedback {
    margin-top: 10px;
    font-weight: bold;
    font-size: 20px;
    text-align: center;
    min-height: 26px;
    color: #ff4c4c;
    user-select: text;
  }
  #start-btn {
    background: #ff1a1a;
    margin-bottom: 20px;
    font-size: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>👹 سلطان اللوجيستيك الشيطاني - السيطرة المطلقة</h1>

<div class="status-bar">
  <div>⏱️ الوقت: <span id="time">0</span> ثانية</div>
  <div>💠 النقاط: <span id="score">0</span></div>
  <div>🔥 التحدي: <span id="difficulty">1</span></div>
</div>

<button id="start-btn">ابدأ السيادة الشيطانية</button>

<div id="clients-container"></div>

<h3 style="color:#ff5555;">المنافسون الوهميون</h3>
<div id="competitors-container"></div>

<h3 style="color:#ff5555;">سجل الأحداث</h3>
<div id="events"></div>

<h3 style="color:#ff5555;">لوحة تحليلات الشيطان</h3>
<div id="analytics"></div>

<div id="feedback"></div>

<script>
(() => {
  // --- الإعدادات ---
  const totalDays = 20;
  const maxDifficulty = 10;
  let day = 1;
  let score = 0;
  let timeElapsed = 0;
  let difficulty = 1;
  let gameActive = false;
  let gameTimer;

  // --- DOM Elements ---
  const timeElem = document.getElementById('time');
  const scoreElem = document.getElementById('score');
  const difficultyElem = document.getElementById('difficulty');
  const clientsContainer = document.getElementById('clients-container');
  const competitorsContainer = document.getElementById('competitors-container');
  const eventsElem = document.getElementById('events');
  const analyticsElem = document.getElementById('analytics');
  const feedbackElem = document.getElementById('feedback');
  const startBtn = document.getElementById('start-btn');

  // --- خصائص العملاء ---
  class AIClient {
    constructor(id, name, baseStock, maxStock, price, personality) {
      this.id = id;
      this.name = name;
      this.stock = baseStock;
      this.maxStock = maxStock;
      this.price = price;
      this.personality = personality; // 'جشع', 'متردد', 'عنيد', 'ذكي'
      this.mood = Math.random();
      this.demandBase = Math.floor(baseStock * 0.25);
      this.reorderPoint = Math.floor(baseStock * 0.5);
      this.reorderAmount = Math.floor(baseStock * 0.7);
      this.negotiationAttempts = 0;
    }

    decideDemand() {
      let base = this.demandBase;
      switch(this.personality) {
        case 'جشع': base *= 1.3; break;
        case 'متردد': base *= 0.8; break;
        case 'عنيد': base *= 1.1; break;
        case 'ذكي': base *= 1.0; break;
      }
      let fluctuation = (Math.random() - 0.5) * 0.3;
      let demand = Math.floor(base * (1 + this.mood + fluctuation));
      demand = Math.min(demand, this.stock);
      return Math.max(1, demand);
    }

    negotiate(offerPrice) {
      this.negotiationAttempts++;
      if (offerPrice < this.price * 0.85 && this.personality === 'عنيد') {
        return {accept: false, counterOffer: this.price * 0.95};
      }
      if (offerPrice > this.price * 1.15 && this.personality === 'جشع') {
        return {accept: false, counterOffer: this.price * 1.1};
      }
      if (offerPrice >= this.price * 0.9 && offerPrice <= this.price * 1.1) {
        return {accept: true};
      }
      if (Math.random() < 0.5) return {accept: true};
      return {accept: false, counterOffer: this.price};
    }

    needsReorder() {
      return this.stock <= this.reorderPoint;
    }

    reorder() {
      if (this.needsReorder()) {
        this.stock += this.reorderAmount;
        this.negotiationAttempts = 0;
        return `العميل ${this.name} طلب إعادة توريد ${this.reorderAmount} وحدة بسعر ${this.price.toFixed(0)} درهم.`;
      }
      return null;
    }

    updateStock(used) {
      this.stock -= used;
      if (this.stock < 0) this.stock = 0;
    }
  }

  // --- خصائص المنافس الوهمي ---
  class Competitor {
    constructor(id, name) {
      this.id = id;
      this.name = name;
      this.score = 0;
      this.price = 100 + Math.floor(Math.random() * 100);
      this.activityLevel = Math.random();
    }

    act() {
      // منافس يزيد نقاطه بشكل عشوائي مع صعوبة متزايدة
      let gain = Math.floor(5 + this.activityLevel * 10 * difficulty * Math.random());
      this.score += gain;
      return `${this.name} حقق نقاط +${gain}`;
    }
  }

  let clientsAI = [];
  let competitors = [];

  // --- إنشاء عملاء بناءً على مستوى الصعوبة ---
  function createClients(level) {
    const personalities = ['جشع', 'متردد', 'عنيد', 'ذكي'];
    clientsAI = [];
    for (let i = 1; i <= level + 3; i++) {
      let baseStock = 100 + i * 20;
      let price = 80 + i * 20;
      let personality = personalities[i % personalities.length];
      clientsAI.push(new AIClient(i, `العميل الشيطاني #${i}`, baseStock, baseStock * 2, price, personality));
    }
  }

  // --- إنشاء منافسين وهميين ---
  function createCompetitors(level) {
    competitors = [];
    for (let i = 1; i <= level + 2; i++) {
      competitors.push(new Competitor(i, `منافس اللوجيستيك #${i}`));
    }
  }

  // --- عرض العملاء ---
  function displayClients() {
    clientsContainer.innerHTML = '';
    clientsAI.forEach(client => {
      let div = document.createElement('div');
      div.className = 'client';
      div.id = `client-${client.id}`;
      div.innerHTML = `
        <h2>${client.name} (${client.personality})</h2>
        <div>المخزون: <span class="stock-value">${client.stock}</span> / ${client.maxStock}</div>
        <div class="stock-bar"><div class="stock-fill" style="width: ${(client.stock / client.maxStock) * 100}%"></div></div>
        <div>السعر: <b>${client.price.toFixed(0)} درهم</b></div>
        <button onclick="manualReorder(${client.id})">طلب إعادة توريد يدوي</button>
        <button onclick="negotiateClient(${client.id})">التفاوض مع العميل</button>
      `;
      clientsContainer.appendChild(div);
    });
  }

  // --- عرض المنافسين ---
  function displayCompetitors() {
    competitorsContainer.innerHTML = '';
    competitors.forEach(comp => {
      let div = document.createElement('div');
      div.className = 'competitor';
      div.id = `competitor-${comp.id}`;
      div.innerHTML = `
        <h3>${comp.name}</h3>
        <div>النقاط: <span class="comp-score">${comp.score}</span></div>
      `;
      competitorsContainer.appendChild(div);
    });
  }

  // --- تحديث العملاء ---
  function updateClientUI(client) {
    const div = document.getElementById(`client-${client.id}`);
    if (!div) return;
    div.querySelector('.stock-value').textContent = client.stock;
    div.querySelector('.stock-fill').style.width = Math.min(100, (client.stock / client.maxStock) * 100) + '%';
  }

  // --- تحديث المنافسين ---
  function updateCompetitorUI(comp) {
    const div = document.getElementById(`competitor-${comp.id}`);
    if (!div) return;
    div.querySelector('.comp-score').textContent = comp.score;
  }

  // --- تسجيل حدث ---
  function addEvent(text) {
    const p = document.createElement('p');
    p.textContent = `📢 ${text}`;
    eventsElem.prepend(p);
    if (eventsElem.childElementCount > 10) eventsElem.removeChild(eventsElem.lastChild);
  }

  // --- تحديث لوحة التحليلات ---
  function updateAnalytics() {
    let totalStock = clientsAI.reduce((a,c) => a + c.stock, 0);
    let totalMax = clientsAI.reduce((a,c) => a + c.maxStock, 0);
    let avgStock = (totalStock / totalMax) * 100;

    let analyticsText = `
      عدد العملاء: ${clientsAI.length}
      | متوسط المخزون المتبقي: ${avgStock.toFixed(2)}%
      | النقاط: ${score}
      | اليوم: ${day} / ${totalDays}
      | مستوى الصعوبة: ${difficulty}
    `;
    analyticsElem.textContent = analyticsText;
  }

  // --- تنفيذ يوم جديد ---
  function nextDay() {
    if (day > totalDays) {
      endGame(true);
      return;
    }
    addEvent(`--- بداية اليوم ${day} ---`);
    feedbackElem.textContent = '';

    // عملاء يستهلكون المخزون بناء على طلبهم الذكي
    clientsAI.forEach(client => {
      const demand = client.decideDemand();
      client.updateStock(demand);
      addEvent(`${client.name} طلب ${demand} وحدة.`);
      updateClientUI(client);
    });

    // منافسون يحققون نقاط
    competitors.forEach(comp => {
      const result = comp.act();
      updateCompetitorUI(comp);
      addEvent(result);
    });

    // تحقق طلبات إعادة التوريد تلقائياً
    clientsAI.forEach(client => {
      if (client.needsReorder()) {
        const reorderMsg = client.reorder();
        if (reorderMsg) {
          score += 10;
          addEvent(reorderMsg);
          updateClientUI(client);
        }
      }
    });

    // زيادة الصعوبة تدريجياً كل 3 أيام
    if (day % 3 === 0 && difficulty < maxDifficulty) {
      difficulty++;
      difficultyElem.textContent = difficulty;
      createClients(difficulty);
      createCompetitors(difficulty);
      displayClients();
      displayCompetitors();
      addEvent(`🔥 مستوى الصعوبة ارتفع إلى ${difficulty}`);
    }

    day++;
    updateAnalytics();
  }

  // --- التفاوض مع العميل ---
  window.negotiateClient = function(clientId) {
    if (!gameActive) return;
    const client = clientsAI.find(c => c.id === clientId);
    if (!client) return;
    let offer = prompt(`عرض سعر ل${client.name} (السعر الحالي: ${client.price.toFixed(0)} درهم):`, client.price.toFixed(0));
    if (offer === null) return;
    offer = parseFloat(offer);
    if (isNaN(offer) || offer <= 0) {
      feedbackElem.textContent = '❌ عرض غير صالح!';
      return;
    }
    const result = client.negotiate(offer);
    if (result.accept) {
      feedbackElem.textContent = `✔️ العميل ${client.name} قبل العرض بـ ${offer.toFixed(0)} درهم!`;
      score += 15;
    } else if (result.counterOffer) {
      feedbackElem.textContent = `⚠️ العميل رفض العرض! عرض مضاد: ${result.counterOffer.toFixed(0)} درهم`;
    } else {
      feedbackElem.textContent = `❌ العميل رفض العرض تماماً.`;
    }
  };

  // --- طلب إعادة توريد يدوي ---
  window.manualReorder = function(clientId) {
    if (!gameActive) return;
    const client = clientsAI.find(c => c.id === clientId);
    if (!client) return;
    if (client.stock + client.reorderAmount > client.maxStock) {
      feedbackElem.textContent = `⚠️ لا يمكن زيادة المخزون فوق الحد الأقصى للعميل ${client.name}`;
      return;
    }
    client.stock += client.reorderAmount;
    score += 5;
    updateClientUI(client);
    feedbackElem.textContent = `✔️ طلب إعادة التوريد اليدوي للعميل ${client.name} تمت بنجاح! +5 نقاط`;
    addEvent(`تم طلب إعادة توريد ${client.reorderAmount} وحدة يدوياً للعميل ${client.name}`);
  };

  // --- إنهاء اللعبة ---
  function endGame(win) {
    gameActive = false;
    clearInterval(gameTimer);
    startBtn.disabled = false;
    feedbackElem.textContent = win ? `🎉 مبروك! أنت سيطرتم على اللوجيستيك الشيطاني بنجاح! نقاطك: ${score}` : '❌ خسرت اللعبة!';
    addEvent('🏆 اللعبة انتهت.');
  }

  // --- بدء اللعبة ---
  function startGame() {
    day = 1;
    score = 0;
    difficulty = 1;
    gameActive = true;
    startBtn.disabled = true;
    feedbackElem.textContent = '';
    timeElapsed = 0;
    difficultyElem.textContent = difficulty;
    createClients(difficulty);
    createCompetitors(difficulty);
    displayClients();
    displayCompetitors();
    updateAnalytics();
    eventsElem.innerHTML = '';

    if (gameTimer) clearInterval(gameTimer);
    gameTimer = setInterval(() => {
      timeElapsed++;
      timeElem.textContent = timeElapsed;
      if (timeElapsed % 15 === 0) {
        nextDay();
      }
    }, 1000);
  }

  startBtn.addEventListener('click', startGame);

  // تصدير لعناصر النافذة ليتم استخدامها في HTML buttons
  window.manualReorder = window.manualReorder;
  window.negotiateClient = window.negotiateClient;

})();
</script>

</body>
</html>
