<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¸Ù„Ù…Ø©</title>
<style>
  body {
    background: linear-gradient(135deg, #0a0014 0%, #220033 100%);
    color: #e0caff;
    font-family: 'Courier New', monospace;
    margin: 0; padding: 0; 
  }
  #game-container {
    max-width: 900px;
    margin: 20px auto;
    padding: 20px;
    background: #1a0033;
    border-radius: 12px;
    box-shadow: 0 0 30px #7a0eff88;
  }
  h1, h2, h3 {
    color: #b77aff;
    margin-bottom: 10px;
  }
  button {
    background: #4b0082;
    border: none;
    padding: 12px 20px;
    margin: 10px 5px 20px 0;
    border-radius: 8px;
    color: #ffd7ff;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 0 10px #7a0effcc;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #7a0eff;
  }
  #messages {
    background: #330044;
    padding: 15px;
    border-radius: 8px;
    height: 250px;
    overflow-y: auto;
    border: 1px solid #7a0eff;
    margin-bottom: 15px;
    font-size: 14px;
  }
  .message {
    margin-bottom: 8px;
  }
  .alert { color: #ff6a6a; font-weight: bold; }
  .success { color: #7aff7a; font-weight: bold; }
  .event { color: #ffa500; font-weight: bold; }
  #stats {
    margin-bottom: 20px;
  }
  #stats span {
    display: inline-block;
    margin-right: 15px;
    font-weight: bold;
  }
  #choices button {
    margin-right: 10px;
  }
  .hidden { display: none; }
  #universe-info {
    margin: 15px 0;
    padding: 12px;
    background: #440066;
    border-radius: 8px;
    box-shadow: inset 0 0 10px #a65aff;
  }
  #skill-tree {
    background: #2c0033;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 20px;
  }
  #skill-tree h3 {
    margin-top: 0;
  }
  .skill {
    cursor: pointer;
    margin: 5px 0;
    padding: 6px 10px;
    background: #551a8b;
    border-radius: 5px;
    box-shadow: 0 0 8px #a65affcc;
    transition: background 0.3s ease;
  }
  .skill.unlocked {
    background: #a65aff;
    box-shadow: 0 0 15px #ffaeff;
  }
  .skill:hover {
    background: #7a3aff;
  }
</style>
</head>
<body>
<div id="game-container">
  <h1>ğŸ©¸ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¸Ù„Ù…Ø©</h1>

  <div id="stats">
    <span>ğŸ’° Ø§Ù„Ù…Ø§Ù„: <span id="money">10000</span>$</span>
    <span>ğŸ’Š Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª: <span id="drugs">200</span> Ø¬Ù…</span>
    <span>ğŸ”« Ø§Ù„Ø£Ø³Ù„Ø­Ø©: <span id="weapons">10</span></span>
    <span>ğŸ•µï¸â€â™‚ï¸ Ø´ÙƒÙˆÙƒ Ø§Ù„Ø´Ø±Ø·Ø©: <span id="police">0</span></span>
    <span>ğŸ§  Ø³Ù…Ø¹Ø©: <span id="reputation">50</span>%</span>
    <span>ğŸ“… Ø§Ù„ÙŠÙˆÙ…: <span id="day">1</span></span>
  </div>

  <div id="universe-info" class="hidden"></div>

  <div id="messages"></div>

  <div id="choices"></div>

  <div id="skill-tree" class="hidden">
    <h3>âš¡ Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h3>
    <div id="skills-list"></div>
  </div>

  <button id="next-day-btn">â–¶ï¸ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
<script>
  // ======== Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ© ========
  const state = {
    money: 10000,
    drugs: 200,
    weapons: 10,
    police: 0,
    reputation: 50,
    day: 1,
    universe: 'Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ',
    skills: {
      stealth: { name: "Ø§Ù„ØªØ³Ù„Ù„", unlocked: false, desc: "ØªÙ‚Ù„ÙŠÙ„ Ø´ÙƒÙˆÙƒ Ø§Ù„Ø´Ø±Ø·Ø© Ø¨Ù†Ø³Ø¨Ø© 20%" },
      negotiation: { name: "Ø§Ù„ØªÙØ§ÙˆØ¶", unlocked: false, desc: "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø§Ù„ Ù…Ù† Ø§Ù„ØµÙÙ‚Ø§Øª 15%" },
      intimidation: { name: "Ø§Ù„ØªØ±Ù‡ÙŠØ¨", unlocked: false, desc: "Ø²ÙŠØ§Ø¯Ø© Ø³Ù…Ø¹Ø© Ø§Ù„Ø¹ØµØ§Ø¨Ø© 10%" }
    },
    nemesisAI: null,
    playerActions: [],
  };

  // ======== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ========
  const messagesEl = document.getElementById('messages');
  const choicesEl = document.getElementById('choices');
  const moneyEl = document.getElementById('money');
  const drugsEl = document.getElementById('drugs');
  const weaponsEl = document.getElementById('weapons');
  const policeEl = document.getElementById('police');
  const reputationEl = document.getElementById('reputation');
  const dayEl = document.getElementById('day');
  const universeInfoEl = document.getElementById('universe-info');
  const skillTreeEl = document.getElementById('skill-tree');
  const skillsListEl = document.getElementById('skills-list');

  // ======== ÙˆØ¸Ø§Ø¦Ù ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ========
  function updateStats() {
    moneyEl.textContent = state.money.toLocaleString();
    drugsEl.textContent = state.drugs.toLocaleString();
    weaponsEl.textContent = state.weapons;
    policeEl.textContent = state.police;
    reputationEl.textContent = state.reputation;
    dayEl.textContent = state.day;
  }

  function addMessage(text, type='') {
    const div = document.createElement('div');
    div.className = 'message ' + type;
    div.textContent = text;
    messagesEl.appendChild(div);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function clearChoices() {
    choicesEl.innerHTML = '';
  }

  // ======== Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ NemesisAI ========
  class NemesisAI {
    constructor() {
      this.model = null;
      this.playerHistory = [];
      this.initModel();
    }
    async initModel() {
      this.model = tf.sequential();
      this.model.add(tf.layers.dense({units: 16, activation: 'relu', inputShape: [5]}));
      this.model.add(tf.layers.dense({units: 8, activation: 'relu'}));
      this.model.add(tf.layers.dense({units: 3, activation: 'softmax'}));
      this.model.compile({optimizer: 'adam', loss: 'categoricalCrossentropy'});
    }
    logAction(actionVector) {
      this.playerHistory.push(actionVector);
      if (this.playerHistory.length > 20) {
        this.trainModel();
      }
    }
    async trainModel() {
      const xs = tf.tensor2d(this.playerHistory);
      const ys = tf.oneHot(tf.tensor1d(this.playerHistory.map((_, i) => i % 3), 'int32'), 3);
      await this.model.fit(xs, ys, {epochs: 5});
    }
    predictNextMove(stateVector) {
      if (!this.model) return null;
      const input = tf.tensor2d([stateVector]);
      const prediction = this.model.predict(input);
      return prediction.argMax(1).dataSync()[0];
    }
  }

  // ======== Ø§Ù„Ø£ÙƒÙˆØ§Ù† Ø§Ù„Ù…ØªÙˆØ§Ø²ÙŠØ© ========
  const universes = [
    {
      name: 'Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ',
      drugModifier: 1,
      policeModifier: 1,
      description: 'Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø°ÙŠ ØªØ¹Ø±ÙÙ‡ØŒ Ø­ÙŠØ« ØªØ¨Ø¯Ø£ Ø§Ù„Ø±Ø­Ù„Ø©.'
    },
    {
      name: 'Ø¹Ø§Ù„Ù… Ø§Ù„Ø¸Ù„',
      drugModifier: 1.5,
      policeModifier: 1.8,
      description: 'Ø¹Ø§Ù„Ù… Ù…Ø¸Ù„Ù… Ø­ÙŠØ« Ø§Ù„Ø´Ø±Ø·Ø© Ø£Ø´Ø¯ Ø´Ø±Ø§Ø³Ø©.'
    },
    {
      name: 'Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø³ÙŠØ¨Ø±Ø§Ù†ÙŠ',
      drugModifier: 2.5,
      policeModifier: 0.7,
      description: 'Ø¹Ø§Ù„Ù… Ù…ØªØ·ÙˆØ± ØªÙ‚Ù†ÙŠÙ‹Ø§ØŒ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ø±ØªÙØ¹Ø© ÙˆØ§Ù„Ø´Ø±Ø·Ø© Ø£Ù‚Ù„ Ù‚Ø³ÙˆØ©.'
    }
  ];

  function showUniverseInfo() {
    universeInfoEl.classList.remove('hidden');
    universeInfoEl.innerHTML = `<h3>ğŸŒŒ Ø§Ù„ÙƒÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ: ${state.universe}</h3><p>${universes.find(u=>u.name===state.universe).description}</p>`;
  }

  // ======== Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª ========
  function renderSkills() {
    skillsListEl.innerHTML = '';
    Object.entries(state.skills).forEach(([key, skill]) => {
      const skillEl = document.createElement('div');
      skillEl.className = 'skill' + (skill.unlocked ? ' unlocked' : '');
      skillEl.textContent = skill.name + (skill.unlocked ? ' âœ…' : '');
      skillEl.title = skill.desc;
      skillEl.onclick = () => {
        if (!skill.unlocked && state.money >= 5000) {
          skill.unlocked = true;
          state.money -= 5000;
          addMessage(`âš¡ ØªÙ… ÙØªØ­ Ø§Ù„Ù…Ù‡Ø§Ø±Ø©: ${skill.name}`, 'success');
          updateStats();
          renderSkills();
        }
      };
      skillsListEl.appendChild(skillEl);
    });
    skillTreeEl.classList.remove('hidden');
  }

  // ======== Ù…Ù‡Ø§Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© ========
  function presentChoices(choices) {
    clearChoices();
    choices.forEach(choice => {
      const btn = document.createElement('button');
      btn.textContent = choice.text;
      btn.onclick = () => {
        choice.action();
      };
      choicesEl.appendChild(btn);
    });
  }

  // ======== Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª ========
  function startDay() {
    addMessage(`ğŸ“… Ø§Ù„ÙŠÙˆÙ… ${state.day} ÙŠØ¨Ø¯Ø£...`, 'event');

    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø´ÙƒÙˆÙƒ ÙŠÙˆÙ…ÙŠÙ‹Ø§ Ø¨Ù†Ø³Ø¨Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
    state.police += Math.floor(Math.random() * 3);
    if (state.police > 100) state.police = 100;

    // Ø§Ø­ØªÙ…Ø§Ù„ Ø­Ø¯ÙˆØ« Ø­Ø¯Ø« Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø³Ù„Ø¨ÙŠ Ø£Ùˆ Ø¥ÙŠØ¬Ø§Ø¨ÙŠ
    const eventChance = Math.random();
    if (eventChance < 0.2) {
      addMessage('ğŸ’£ Ø­Ø¯Ø« ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: Ø§Ù„Ø´Ø±Ø·Ø© ØªÙ‚ÙˆÙ… Ø¨Ù…Ø¯Ø§Ù‡Ù…Ø©!', 'alert');
      state.drugs = Math.max(0, state.drugs - Math.floor(Math.random() * 50));
      state.money = Math.max(0, state.money - Math.floor(Math.random() * 2000));
      state.reputation = Math.max(0, state.reputation - 5);
    } else if (eventChance < 0.3) {
      addMessage('ğŸ‰ Ø­Ø¯Ø« Ø³Ø¹ÙŠØ¯: ØµÙÙ‚Ø© Ù…Ø±Ø¨Ø­Ø© Ù†Ø§Ø¬Ø­Ø©!', 'success');
      state.money += Math.floor(Math.random() * 5000) + 1000;
      state.drugs = Math.max(0, state.drugs - Math.floor(Math.random() * 30));
      state.reputation += 3;
    }

    updateStats();
    showUniverseInfo();

    presentChoices([
      { text: 'Ø¨ÙŠØ¹ Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª', action: sellDrugs },
      { text: 'Ø´Ø±Ø§Ø¡ Ø§Ù„Ø£Ø³Ù„Ø­Ø©', action: buyWeapons },
      { text: 'Ø§Ù„ØªÙ‡Ø±Ø¨ Ù…Ù† Ø§Ù„Ø´Ø±Ø·Ø©', action: evadePolice },
      { text: 'Ø§Ø³ØªÙƒØ´Ø§Ù ÙƒÙˆÙ† Ø¬Ø¯ÙŠØ¯', action: jumpUniverse },
      { text: 'ÙØªØ­ Ø´Ø¬Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª', action: renderSkills }
    ]);
  }

  // ======== Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù… ========
  function sellDrugs() {
    if (state.drugs < 10) {
      addMessage('âš ï¸ Ù„Ø§ ØªÙ…Ù„Ùƒ Ù…Ø®Ø¯Ø±Ø§Øª ÙƒØ§ÙÙŠØ© Ù„Ù„Ø¨ÙŠØ¹.', 'alert');
      return startDay();
    }
    const basePrice = 100;
    let price = basePrice * universes.find(u => u.name === state.universe).drugModifier;
    if (state.skills.negotiation.unlocked) price *= 1.15;
    const amount = Math.min(state.drugs, Math.floor(Math.random() * 50) + 10);
    const gain = Math.floor(amount * price);

    state.drugs -= amount;
    state.money += gain;
    addMessage(`ğŸ’° Ø¨Ø¹Øª ${amount} Ø¬Ù… Ù…Ø®Ø¯Ø±Ø§Øª Ù…Ù‚Ø§Ø¨Ù„ $${gain}.`, 'success');

    // ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙƒ Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø¨ÙŠØ¹ Ø§Ù„Ù†Ø§Ø¬Ø­
    state.police = Math.max(0, state.police - 2);
    if (state.skills.stealth.unlocked) state.police = Math.max(0, state.police - 3);

    state.reputation += 1;
    updateStats();
    startDay();
  }

  function buyWeapons() {
    const weaponPrice = 500;
    if (state.money < weaponPrice) {
      addMessage('âš ï¸ Ù„Ø§ ØªÙ…Ù„Ùƒ Ù…Ø§Ù„Ø§Ù‹ ÙƒØ§ÙÙŠØ§Ù‹ Ù„Ø´Ø±Ø§Ø¡ Ø§Ù„Ø£Ø³Ù„Ø­Ø©.', 'alert');
      return startDay();
    }
    state.money -= weaponPrice;
    state.weapons += 1;
    addMessage('ğŸ”« Ø§Ø´ØªØ±ÙŠØª Ø³Ù„Ø§Ø­Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹.', 'success');

    // Ø´Ø±Ø§Ø¡ Ø§Ù„Ø£Ø³Ù„Ø­Ø© ÙŠØ²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø´ÙƒÙˆÙƒ Ù‚Ù„ÙŠÙ„Ø§Ù‹
    state.police += 2;
    updateStats();
    startDay();
  }

  function evadePolice() {
    if (state.police < 10) {
      addMessage('ğŸ›¡ï¸ Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù„ØªÙ‡Ø±Ø¨ØŒ Ø§Ù„Ø´Ø±Ø·Ø© ØºÙŠØ± Ù…Ø´ØªØ¨Ù‡ Ø¨Ùƒ Ø¨Ø´Ø¯Ø©.', 'event');
      return startDay();
    }
    const evadeChance = 0.5 + (state.weapons * 0.02);
    if (Math.random() < evadeChance) {
      addMessage('ğŸš” Ù†Ø¬Ø­Øª ÙÙŠ Ø§Ù„ØªÙ‡Ø±Ø¨ Ù…Ù† Ø§Ù„Ø´Ø±Ø·Ø©!', 'success');
      state.police = Math.max(0, state.police - 15);
      state.reputation += 2;
    } else {
      addMessage('âŒ ÙØ´Ù„Øª ÙÙŠ Ø§Ù„ØªÙ‡Ø±Ø¨! Ø§Ù„Ø´Ø±Ø·Ø© ØªØ¶ØºØ· Ø¹Ù„ÙŠÙƒ.', 'alert');
      state.police += 10;
      state.money = Math.max(0, state.money - 3000);
      state.drugs = Math.max(0, state.drugs - 50);
      state.reputation = Math.max(0, state.reputation - 10);
    }
    updateStats();
    startDay();
  }

  function jumpUniverse() {
    const currentIndex = universes.findIndex(u => u.name === state.universe);
    const nextIndex = (currentIndex + 1) % universes.length;
    state.universe = universes[nextIndex].name;
    addMessage(`ğŸŒŒ Ø§Ù†ØªÙ‚Ù„Øª Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙˆÙ†: ${state.universe}`, 'event');
    updateStats();
    startDay();
  }

  // ======== Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© ========
  async function initGame() {
    state.nemesisAI = new NemesisAI();
    updateStats();
    addMessage('ğŸ”¥ Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø¹Ø§Ù„Ù… Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø®Ø¯Ø±Ø§Øª Ø§Ù„Ù…Ø¸Ù„Ù…!', 'event');
    showUniverseInfo();
    startDay();
  }

  // ======== Ø²Ø± Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ ========
  document.getElementById('next-day-btn').addEventListener('click', () => {
    state.day++;
    startDay();
  });

  initGame();
</script>
</body>
</html>
