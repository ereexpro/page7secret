<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ’° Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠÙƒ - Ù„Ø¹Ø¨Ø© Ø§Ù„Ø¹ØµØ§Ø¨Ø§Øª ÙˆØ§Ù„ØªÙ‡Ø±ÙŠØ¨</title>
<style>
  body {
    background: #121212;
    color: #eee;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
  }
  nav {
    background: #1f1f1f;
    padding: 10px;
    display: flex;
    gap: 8px;
    justify-content: center;
    border-bottom: 2px solid #b31217;
  }
  nav button {
    background: #b31217;
    border: none;
    padding: 10px 16px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.3s ease;
  }
  nav button:hover, nav button.active {
    background: #ee2f35;
  }
  .screen {
    display: none;
    padding: 15px 25px;
  }
  .screen.active {
    display: block;
  }
  h2, h3, h4 {
    margin-top: 0;
  }
  .card {
    background: #1e1e1e;
    margin: 10px 0;
    padding: 12px 15px;
    border-radius: 6px;
    box-shadow: 0 0 8px #b31217cc;
  }
  .action-btn {
    background: #b31217;
    color: white;
    border: none;
    padding: 6px 12px;
    margin-top: 6px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s ease;
  }
  .action-btn:hover:enabled {
    background: #ee2f35;
  }
  .action-btn:disabled {
    background: #770a0c;
    cursor: not-allowed;
  }
  #events-log {
    height: 150px;
    overflow-y: auto;
    background: #222;
    padding: 10px;
    font-family: monospace;
    font-size: 0.9em;
    border-radius: 4px;
    white-space: pre-wrap;
  }
  label {
    display: inline-block;
    margin: 5px 0 3px 0;
  }
  select, input[type=number] {
    width: 100%;
    padding: 6px;
    border-radius: 4px;
    border: none;
    margin-bottom: 8px;
    background: #333;
    color: white;
  }
  #risk-display {
    font-weight: bold;
    margin: 10px 0;
    font-size: 1.2em;
    color: #ff4444;
  }
  hr {
    border: 1px solid #b31217;
    margin: 20px 0;
  }
</style>
</head>
<body>

<nav>
  <button onclick="switchScreen('gang')" class="active">ğŸ•¶ï¸ Ø¹ØµØ§Ø¨ØªÙƒ</button>
  <button onclick="switchScreen('market')">ğŸª Ø§Ù„Ø³ÙˆÙ‚</button>
  <button onclick="switchScreen('loans')">ğŸ’¸ Ø§Ù„Ù‚Ø±ÙˆØ¶</button>
  <button onclick="switchScreen('shipments')">ğŸšš Ø§Ù„Ø´Ø­Ù†Ø§Øª</button>
  <button onclick="switchScreen('events')">ğŸ“œ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</button>
</nav>

<!-- Ø´Ø§Ø´Ø© Ø¹ØµØ§Ø¨ØªÙƒ -->
<div id="gang" class="screen active">
  <h2>Ø¹ØµØ§Ø¨ØªÙƒ</h2>
  <div class="card">
    <p>ğŸ’° Ø§Ù„Ù…Ø§Ù„: <span id="gang-money"></span> Ø¯Ø±Ù‡Ù…</p>
    <p>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ†: <span id="gang-workers"></span></p>
    <p>ğŸš› Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø§Ø­Ù†Ø§Øª: <span id="gang-trucks"></span></p>
    <p>ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù„Ø¹ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: <span id="gang-inventory"></span></p>
  </div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø³ÙˆÙ‚ -->
<div id="market" class="screen">
  <h2>Ø§Ù„Ù…ÙˆØ±Ø¯ÙˆÙ† ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡</h2>
  <div id="supplier-list"></div>

  <hr />

  <h3>Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ø§Ù„</h3>
  <div id="worker-suppliers"></div>

  <hr />

  <h3>Ø´Ø±Ø§Ø¡ Ø§Ù„Ø´Ø§Ø­Ù†Ø§Øª</h3>
  <div id="truck-suppliers"></div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù‚Ø±ÙˆØ¶ -->
<div id="loans" class="screen">
  <h2>Ø§Ù„Ù‚Ø±ÙˆØ¶ ÙˆØ§Ù„ØªÙ…ÙˆÙŠÙ„</h2>
  <div id="loan-info" class="card"></div>

  <h3>Ø£Ø®Ø° Ù‚Ø±Ø¶ Ø¬Ø¯ÙŠØ¯</h3>
  <label for="loan-amount">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø±Ù‡Ù…):</label>
  <input id="loan-amount" type="number" min="1000" disabled />
  <label for="loan-interest">Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© %:</label>
  <input id="loan-interest" type="number" min="5" disabled />
  <button id="take-loan-btn" class="action-btn" disabled onclick="takeLoan()">Ø£Ø®Ø° Ù‚Ø±Ø¶</button>

  <hr />

  <h3>Ø¥Ø¹Ø·Ø§Ø¡ Ù‚Ø±Ø¶ (Ù…Ù‚ÙÙ„)</h3>
  <label for="give-loan-amount">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø±Ù‡Ù…):</label>
  <input id="give-loan-amount" type="number" min="1000" disabled />
  <label for="give-loan-interest">Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© %:</label>
  <input id="give-loan-interest" type="number" min="5" disabled />
  <button id="give-loan-btn" class="action-btn disabled" disabled onclick="giveLoan()">Ø¥Ø¹Ø·Ø§Ø¡ Ù‚Ø±Ø¶</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø´Ø­Ù†Ø§Øª -->
<div id="shipments" class="screen">
  <h2>Ø§Ù„Ø´Ø­Ù†Ø§Øª</h2>
  
  <label for="select-route">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø§Ø±:</label>
  <select id="select-route" onchange="onSelectionChange()"></select>

  <label for="select-truck">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø§Ø­Ù†Ø©:</label>
  <select id="select-truck" onchange="onSelectionChange()"></select>

  <label for="select-worker">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚:</label>
  <select id="select-worker" onchange="onSelectionChange()"></select>

  <label for="shipment-qty">ÙƒÙ…ÙŠØ© Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„:</label>
  <input id="shipment-qty" type="number" min="1" value="1" onchange="validateShipmentQty()" />

  <div id="risk-display">Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø±: 0%</div>

  <button class="action-btn" onclick="sendShipment()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ø­Ù†Ø©</button>

  <div id="shipping-status" style="margin-top: 10px;"></div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« -->
<div id="events" class="screen">
  <h2>Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h2>
  <div id="events-log"></div>
</div>

<script>
  // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ù„Ø§Ø¹Ø¨
  let money = 10000;
  let gangWorkers = 5;
  let gangTrucks = 2;
  let inventory = 0;

  let loanAmount = 0;
  let loanInterest = 10; // Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© %
  let loanDueTurns = 5; // Ø¯ÙˆØ±Ø§Øª Ù„Ù„Ø³Ø¯Ø§Ø¯ Ù‚Ø¨Ù„ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø©
  let debtUnpaidTurns = 0;

  let currentTurn = 1;
  let shippingInProgress = false;
  let shippingTimer = 0;
  let shippingDetails = null;
  let stage = 1; // Ù…Ø³ØªÙˆÙ‰ ØµØ¹ÙˆØ¨Ø© Ù…ØªØºÙŠØ±

  let eventsLog = [];

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (Ø¹Ù…Ø§Ù„ ÙˆØ´Ø§Ø­Ù†Ø§Øª)
  const workerSuppliers = [
    { id: 'jack', name: 'Jack the Hustler', temperament: 'greedy', basePrice: 2200 },
    { id: 'lisa', name: 'Lisa the Loyal', temperament: 'friendly', basePrice: 1800 }
  ];
  const truckSuppliers = [
    { id: 'speedy', name: 'Speedy Truck Co.', temperament: 'aggressive', basePrice: 16000,
      features: { speed: 8, capacity: 100, security: 3 } },
    { id: 'tank', name: 'Tank Haulers', temperament: 'defensive', basePrice: 20000,
      features: { speed: 5, capacity: 150, security: 8 } }
  ];

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ØªÙˆÙØ±ÙŠÙ† (Ù„Ù„Ø³ÙŠØ§Ø±Ø§Øª)
  let workers = [
    { id: 'w1', name: 'Ø¹Ù„ÙŠ', skill: 'Ù…Ø¨ØªØ¯Ø¦', skillValue: 1, price: 1500 },
    { id: 'w2', name: 'Ø³Ø§Ø±Ø©', skill: 'Ù…ØªÙˆØ³Ø·', skillValue: 2, price: 3000 },
    { id: 'w3', name: 'Ø¹Ù…Ø±', skill: 'Ø±Ø§Ø¦Ø¹', skillValue: 3, price: 6000 },
    { id: 'w4', name: 'Ù†ÙˆØ±Ø§', skill: 'Ø£Ø³Ø·ÙˆØ±ÙŠ', skillValue: 5, price: 12000 }
  ];

  // Ø§Ù„Ø´Ø§Ø­Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø© ÙØ¹Ù„ÙŠØ§Ù‹
  let trucks = [
    { id: 't1', name: 'Speedy', security: 3, capacity: 100, speed: 8 },
    { id: 't2', name: 'Tank', security: 8, capacity: 150, speed: 5 }
  ];

  // Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©
  let routes = [
    { id: 'safe', name: 'Ù…Ø³Ø§Ø± Ø¢Ù…Ù†', baseRisk: 10 },
    { id: 'risky', name: 'Ù…Ø³Ø§Ø± Ù…Ø­ÙÙˆÙ Ø¨Ø§Ù„Ù…Ø®Ø§Ø·Ø±', baseRisk: 40 },
    { id: 'darkweb', name: 'Ù…Ø³Ø§Ø± Ø¯Ø§Ø±Ùƒ ÙˆÙŠØ¨', baseRisk: 60 }
  ];

  // Ø³Ø­Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
  function switchScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(screenId).classList.add('active');
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    event.target?.classList.add('active');
  }

  // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø¹ØµØ§Ø¨ØªÙƒ
  function renderGangInfo() {
    document.getElementById('gang-money').textContent = money;
    document.getElementById('gang-workers').textContent = gangWorkers;
    document.getElementById('gang-trucks').textContent = gangTrucks;
    document.getElementById('gang-inventory').textContent = inventory;
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ù„Ù„Ø¹Ù…Ø§Ù„
  function renderWorkerSuppliers() {
    const container = document.getElementById('worker-suppliers');
    container.innerHTML = '';
    workerSuppliers.forEach(s => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <h4>${s.name}</h4>
        <p>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ: ${s.basePrice} Ø¯Ø±Ù‡Ù…</p>
        <button class="action-btn" onclick="negotiateWithSupplier('worker', '${s.id}')">ØªÙØ§ÙˆØ¶ ÙˆØ´Ø±Ø§Ø¡</button>
      `;
      container.appendChild(card);
    });
  }
  // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† Ù„Ù„Ø´Ø§Ø­Ù†Ø§Øª
  function renderTruckSuppliers() {
    const container = document.getElementById('truck-suppliers');
    container.innerHTML = '';
    truckSuppliers.forEach(s => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <h4>${s.name}</h4>
        <p>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠ: ${s.basePrice} Ø¯Ø±Ù‡Ù…</p>
        <p>Ø§Ù„Ø³Ø±Ø¹Ø©: ${s.features.speed} | Ø§Ù„Ø³Ø¹Ø©: ${s.features.capacity} | Ø§Ù„Ø£Ù…Ø§Ù†: ${s.features.security}</p>
        <button class="action-btn" onclick="negotiateWithSupplier('truck', '${s.id}')">ØªÙØ§ÙˆØ¶ ÙˆØ´Ø±Ø§Ø¡</button>
      `;
      container.appendChild(card);
    });
  }

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø§Ù„ ÙÙŠ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¨
  function updateMoneyDisplay() {
    document.title = `ğŸ’° ${money} Ø¯Ø±Ù‡Ù… - Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠÙƒ`;
    renderGangInfo();
  }

  // Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙØ§ÙˆØ¶ ÙˆØ´Ø±Ø§Ø¡
  function negotiateWithSupplier(type, id) {
    let supplier;
    if (type === 'worker') {
      supplier = workerSuppliers.find(s => s.id === id);
    } else if (type === 'truck') {
      supplier = truckSuppliers.find(s => s.id === id);
    }
    if (!supplier) return alert('Ø§Ù„Ù…ÙˆØ±Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');

    let price = supplier.basePrice;
    switch (supplier.temperament) {
      case 'greedy': price = Math.floor(price * 1.2); break;
      case 'friendly': price = Math.floor(price * 0.85); break;
      case 'aggressive': price = Math.floor(price * 1.3); break;
      case 'defensive': price = Math.floor(price * 1.1); break;
    }

    if (!confirm(`${supplier.name} ÙŠØ¹Ø±Ø¶ ${price} Ø¯Ø±Ù‡Ù…. Ù‡Ù„ ØªÙ‚Ø¨Ù„ Ø§Ù„Ø´Ø±Ø§Ø¡ØŸ`)) return;

    if (money < price) {
      alert('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ù…Ø§Ù„ ÙƒØ§ÙÙŠ Ù„Ù„Ø´Ø±Ø§Ø¡.');
      return;
    }
    money -= price;
    if (type === 'worker') {
      gangWorkers++;
      addEventLog(`ğŸ‘¥ Ø§Ø´ØªØ±ÙŠØª Ø¹Ø§Ù…Ù„ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${supplier.name} Ù…Ù‚Ø§Ø¨Ù„ ${price} Ø¯Ø±Ù‡Ù….`);
    } else if (type === 'truck') {
      gangTrucks++;
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø§Ø­Ù†Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø®ØµØ§Ø¦ØµÙ‡Ø§
      trucks.push({
        id: supplier.id + '_' + Date.now(),
        name: supplier.name,
        security: supplier.features.security,
        capacity: supplier.features.capacity,
        speed: supplier.features.speed
      });
      addEventLog(`ğŸš› Ø§Ø´ØªØ±ÙŠØª Ø´Ø§Ø­Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† ${supplier.name} Ù…Ù‚Ø§Ø¨Ù„ ${price} Ø¯Ø±Ù‡Ù….`);
    }
    updateMoneyDisplay();
  }

  // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  function calculateRisk(routeId, truckId, workerId, stage) {
    let route = routes.find(r => r.id === routeId);
    let truck = trucks.find(t => t.id === truckId);
    let worker = workers.find(w => w.id === workerId);

    if (!route || !truck || !worker) return 0;

    let risk = route.baseRisk;
    risk -= truck.security * 2;
    risk -= worker.skillValue * 3;
    risk += stage * 5;
    risk = Math.min(Math.max(risk, 5), 95);

    return risk;
  }

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø±
  function updateRiskDisplay() {
    const routeId = document.getElementById('select-route').value;
    const truckId = document.getElementById('select-truck').value;
    const workerId = document.getElementById('select-worker').value;
    const risk = calculateRisk(routeId, truckId, workerId, stage);
    document.getElementById('risk-display').textContent = `Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø±: ${risk}% âš ï¸`;
  }

  // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ…ÙŠØ© Ø§Ù„Ø´Ø­Ù†Ø© Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
  function validateShipmentQty() {
    const qtyInput = document.getElementById('shipment-qty');
    let val = parseInt(qtyInput.value);
    if (isNaN(val) || val < 1) val = 1;
    if (val > inventory) {
      alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.");
      val = inventory;
    }
    qtyInput.value = val;
  }

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ø­Ù†Ø©
  let shippingTimer = 0;
  let shippingInProgress = false;
  let shippingDetails = null;

  function sendShipment() {
    if (shippingInProgress) {
      alert("Ù‡Ù†Ø§Ùƒ Ø´Ø­Ù†Ø© Ø¬Ø§Ø±ÙŠØ© Ø¨Ø§Ù„ÙØ¹Ù„!");
      return;
    }
    const routeId = document.getElementById('select-route').value;
    const truckId = document.getElementById('select-truck').value;
    const workerId = document.getElementById('select-worker').value;
    let qty = parseInt(document.getElementById('shipment-qty').value);

    if (!routeId || !truckId || !workerId) {
      alert("Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø§Ø±ØŒ Ø§Ù„Ø´Ø§Ø­Ù†Ø©ØŒ ÙˆØ§Ù„Ø³Ø§Ø¦Ù‚.");
      return;
    }
    if (qty < 1 || qty > inventory) {
      alert("ÙƒÙ…ÙŠØ© ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„.");
      return;
    }
    shippingInProgress = true;
    shippingTimer = 5; // Ù…Ø«Ù„Ø§ 5 Ø¯ÙˆØ±Ø§Øª (ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ø³Ø±Ø¹Ø© Ù„Ø§Ø­Ù‚Ø§)
    shippingDetails = { route: routeId, qty, truckId, workerId };

    inventory -= qty;
    updateMoneyDisplay();
    addEventLog(`ğŸšš ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø´Ø­Ù†Ø© ${qty} ÙˆØ­Ø¯Ø© Ø¹Ø¨Ø± ${routes.find(r=>r.id===routeId).name}.`);

    document.getElementById('shipping-status').textContent = `Ø§Ù„Ø´Ø­Ù† Ø¬Ø§Ø±Ù... ØªØ¨Ù‚Ù‰ ${shippingTimer} Ø¯ÙˆØ±Ø§Øª.`;
  }

  // Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
  function addEventLog(text) {
    eventsLog.unshift(`[Ø§Ù„Ø¯ÙˆØ± ${currentTurn}] ${text}`);
    if (eventsLog.length > 50) eventsLog.pop();
    document.getElementById('events-log').textContent = eventsLog.join('\n');
  }

  // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯ÙˆØ±Ø© (turn)
  function runTurn() {
    if (shippingInProgress) {
      shippingTimer--;
      if (shippingTimer <= 0) {
        shippingInProgress = false;
        // Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ø¹ØªØ±Ø§Ø¶ Ø§Ù„Ø´Ø±Ø·Ø© Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø·Ø±
        const risk = calculateRisk(shippingDetails.route, shippingDetails.truckId, shippingDetails.workerId, stage);
        if (Math.random() < risk / 100) {
          addEventLog("ğŸš¨ ØªÙ… Ø§Ø¹ØªØ±Ø§Ø¶ Ø§Ù„Ø´Ø­Ù†Ø© Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø´Ø±Ø·Ø©! Ø®Ø³Ø±Øª Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© ÙˆØ¯ÙÙØ¹Øª ØºØ±Ø§Ù…Ø©.");
          money -= 2000;
          if (money < 0) money = 0;
        } else {
          const pricePerUnit = 700 + stage * 100;
          const gain = shippingDetails.qty * pricePerUnit;
          money += gain;
          addEventLog(`âœ… ÙˆØµÙ„Øª Ø§Ù„Ø´Ø­Ù†Ø© Ù…Ù† ${shippingDetails.qty} ÙˆØ­Ø¯Ø© Ø¨Ø£Ù…Ø§Ù†. Ø±Ø¨Ø­: ${gain} Ø¯Ø±Ù‡Ù….`);
        }
        updateMoneyDisplay();
        document.getElementById('shipping-status').textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø­Ù†Ø§Øª Ù†Ø´Ø·Ø©.";
        shippingDetails = null;
      } else {
        document.getElementById('shipping-status').textContent = `Ø§Ù„Ø´Ø­Ù† Ø¬Ø§Ø±Ù... ØªØ¨Ù‚Ù‰ ${shippingTimer} Ø¯ÙˆØ±Ø§Øª.`;
      }
    }

    // Ù‚Ø±Ø¶ - Ø­Ø³Ø§Ø¨ Ø§Ù„ÙØ§Ø¦Ø¯Ø© ÙˆÙ…Ø¯Ø© Ø§Ù„Ø³Ø¯Ø§Ø¯
    if (loanAmount > 0) {
      loanDueTurns--;
      if (loanDueTurns <= 0) {
        debtUnpaidTurns++;
        loanInterest += 5;
        addEventLog(`âš ï¸ Ù„Ù… ØªØ³Ø¯Ø¯ Ø§Ù„Ù‚Ø±Ø¶ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯. Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø²Ø§Ø¯Øª Ø¥Ù„Ù‰ ${loanInterest}%.`);
        loanDueTurns = 5;
      }
    }

    currentTurn++;
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø±Ø¶
  function renderLoanInfo() {
    const loanInfo = document.getElementById('loan-info');
    if (loanAmount > 0) {
      loanInfo.innerHTML = `
        Ù„Ø¯ÙŠÙƒ Ù‚Ø±Ø¶ Ø¨Ù…Ø¨Ù„Øº ${loanAmount} Ø¯Ø±Ù‡Ù….
        Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${loanInterest}%
        ÙŠØ¬Ø¨ Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø®Ù„Ø§Ù„ ${loanDueTurns} Ø¯ÙˆØ±Ø§Øª.
      `;
      document.getElementById('loan-amount').disabled = true;
      document.getElementById('loan-interest').disabled = true;
      document.getElementById('take-loan-btn').disabled = true;
    } else {
      loanInfo.textContent = "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ù‚Ø±Ø¶ Ø­Ø§Ù„ÙŠØ§Ù‹.";
      document.getElementById('loan-amount').disabled = false;
      document.getElementById('loan-interest').disabled = false;
      document.getElementById('take-loan-btn').disabled = false;
    }
  }

  function takeLoan() {
    const amountInput = document.getElementById('loan-amount');
    const interestInput = document.getElementById('loan-interest');
    let amt = parseInt(amountInput.value);
    let intr = parseInt(interestInput.value);

    if (isNaN(amt) || amt < 1000) {
      alert("Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº Ù‚Ø±Ø¶ ØµØ§Ù„Ø­ (1000 Ø¯Ø±Ù‡Ù… Ø£Ùˆ Ø£ÙƒØ«Ø±).");
      return;
    }
    if (isNaN(intr) || intr < 5) {
      alert("Ø£Ø¯Ø®Ù„ Ù†Ø³Ø¨Ø© ÙØ§Ø¦Ø¯Ø© ØµØ­ÙŠØ­Ø© (5% Ø£Ùˆ Ø£ÙƒØ«Ø±).");
      return;
    }
    loanAmount = amt;
    loanInterest = intr;
    loanDueTurns = 5;
    debtUnpaidTurns = 0;
    money += amt;
    addEventLog(`ğŸ’° Ø£Ø®Ø°Øª Ù‚Ø±Ø¶Ù‹Ø§ Ø¨Ù…Ø¨Ù„Øº ${amt} Ø¯Ø±Ù‡Ù… Ø¨ÙØ§Ø¦Ø¯Ø© ${intr}%.`);
    updateMoneyDisplay();
    renderLoanInfo();
  }

  // ØªÙˆØ³ÙŠØ¹ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø¯Ø§Ù„Ø© init
  function init() {
    renderGangInfo();
    renderWorkerSuppliers();
    renderTruckSuppliers();
    renderLoanInfo();
    populateShipmentsSelectors();
    updateRiskDisplay();
    addEventLog("ğŸ”¥ ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©. Ø­Ø¸Ù‹Ø§ Ù…ÙˆÙÙ‚Ù‹Ø§!");
  }

  // ØªØ¹Ø¨Ø¦Ø© Ù‚ÙˆØ§Ø¦Ù… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø­Ù†Ø§Øª
  function populateShipmentsSelectors() {
    const routeSel = document.getElementById('select-route');
    const truckSel = document.getElementById('select-truck');
    const workerSel = document.getElementById('select-worker');

    routeSel.innerHTML = '';
    routes.forEach(r => {
      let opt = document.createElement('option');
      opt.value = r.id;
      opt.textContent = r.name;
      routeSel.appendChild(opt);
    });

    truckSel.innerHTML = '';
    trucks.forEach(t => {
      let opt = document.createElement('option');
      opt.value = t.id;
      opt.textContent = `${t.name} (Ø³Ø¹Ø©: ${t.capacity}, Ø£Ù…Ø§Ù†: ${t.security})`;
      truckSel.appendChild(opt);
    });

    workerSel.innerHTML = '';
    workers.forEach(w => {
      let opt = document.createElement('option');
      opt.value = w.id;
      opt.textContent = `${w.name} - ${w.skill} (Ø³Ø¹Ø±: ${w.price} Ø¯Ø±Ù‡Ù…)`;
      workerSel.appendChild(opt);
    });
  }

  // Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
  function onSelectionChange() {
    updateRiskDisplay();
  }

  // ØªÙ†ÙÙŠØ° Ø¯ÙˆØ± (turn)
  function nextTurn() {
    runTurn();
    renderLoanInfo();
    updateMoneyDisplay();
  }

  // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø³Ø¬Ù„
  function addEventLog(text) {
    eventsLog.unshift(`[Ø§Ù„Ø¯ÙˆØ± ${currentTurn}] ${text}`);
    if (eventsLog.length > 50) eventsLog.pop();
    document.getElementById('events-log').textContent = eventsLog.join('\n');
  }

  // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
  window.onload = () => {
    init();

    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¯ÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§ ÙƒÙ„ 10 Ø«ÙˆØ§Ù†ÙŠ (Ù…Ø«Ø§Ù„)
    setInterval(() => {
      nextTurn();
    }, 10000);
  }
</script>

</body>
</html>
