<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>💀 إمبراطورية الظلام - لعبة اللوجستيك الشيطانية</title>
<style>
  body {
    background: #0c0c0c;
    color: #eee;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    user-select: none;
  }
  nav {
    background: #2a0b0b;
    padding: 10px;
    display: flex;
    gap: 8px;
    justify-content: center;
    border-bottom: 3px solid #aa0000;
  }
  nav button {
    background: #aa0000;
    border: none;
    padding: 10px 18px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border-radius: 6px;
    transition: background 0.3s ease;
    font-size: 1.1em;
  }
  nav button:hover, nav button.active {
    background: #ff0000;
  }
  .screen {
    display: none;
    padding: 20px 30px;
    min-height: 500px;
    overflow-y: auto;
  }
  .screen.active {
    display: block;
  }
  h1,h2,h3,h4 {
    margin-top: 0;
  }
  .card {
    background: #1b0d0d;
    margin: 12px 0;
    padding: 16px 18px;
    border-radius: 8px;
    box-shadow: 0 0 10px #bb0000cc;
  }
  .action-btn {
    background: #aa0000;
    color: white;
    border: none;
    padding: 10px 16px;
    margin-top: 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s ease;
    font-size: 1em;
  }
  .action-btn:hover:enabled {
    background: #ff0000;
  }
  .action-btn:disabled {
    background: #550000;
    cursor: not-allowed;
  }
  #events-log {
    height: 180px;
    overflow-y: auto;
    background: #220707;
    padding: 14px;
    font-family: monospace;
    font-size: 0.9em;
    border-radius: 8px;
    white-space: pre-wrap;
    border: 2px solid #aa0000;
  }
  label {
    display: block;
    margin: 8px 0 6px 0;
    font-weight: bold;
  }
  select, input[type=number], input[type=text] {
    width: 100%;
    padding: 8px 10px;
    border-radius: 6px;
    border: none;
    margin-bottom: 12px;
    background: #330909;
    color: #fff;
    font-size: 1em;
  }
  #risk-display {
    font-weight: bolder;
    margin: 16px 0 12px 0;
    font-size: 1.3em;
    color: #ff3333;
    text-align: center;
    text-shadow: 0 0 10px #ff0000;
  }
  hr {
    border: 1px solid #aa0000;
    margin: 28px 0;
  }
  .upgrade-btn {
    background: #880000;
    font-size: 0.9em;
    margin-left: 8px;
    padding: 5px 12px;
  }
  .upgrade-btn:hover {
    background: #cc0000;
  }
  .disabled-text {
    color: #770000;
    font-style: italic;
  }
</style>
</head>
<body>

<nav>
  <button onclick="switchScreen('gang')" class="active">🕶️ عصابتك</button>
  <button onclick="switchScreen('market')">🏪 السوق السوداء</button>
  <button onclick="switchScreen('loans')">💸 القروض والتمويل</button>
  <button onclick="switchScreen('shipments')">🚚 الشحنات</button>
  <button onclick="switchScreen('upgrades')">⚙️ الترقيات</button>
  <button onclick="switchScreen('events')">📜 سجل الأحداث</button>
</nav>

<!-- شاشة عصابتك -->
<div id="gang" class="screen active">
  <h1>عصابتك: قوة الظلام</h1>
  <div class="card">
    <p>💰 المال: <span id="gang-money"></span> درهم</p>
    <p>👥 عدد العاملين: <span id="gang-workers"></span></p>
    <p>🚛 عدد الشاحنات: <span id="gang-trucks"></span></p>
    <p>📦 عدد السلع في المخزون: <span id="gang-inventory"></span></p>
    <p>🛡️ السمعة مع العصابات: <span id="gang-reputation"></span></p>
    <p>🔥 مستوى الصعوبة: <span id="game-stage"></span></p>
  </div>
</div>

<!-- شاشة السوق -->
<div id="market" class="screen">
  <h2>🏪 سوق الموردين والتفاوض</h2>
  
  <h3>شراء العمال</h3>
  <div id="worker-suppliers"></div>

  <hr />

  <h3>شراء الشاحنات</h3>
  <div id="truck-suppliers"></div>
</div>

<!-- شاشة القروض -->
<div id="loans" class="screen">
  <h2>💸 القروض والتمويل</h2>
  <div id="loan-info" class="card"></div>

  <h3>أخذ قرض جديد</h3>
  <label for="loan-amount">المبلغ (درهم):</label>
  <input id="loan-amount" type="number" min="1000" />
  <label for="loan-interest">نسبة الفائدة %:</label>
  <input id="loan-interest" type="number" min="5" value="10" />
  <button id="take-loan-btn" class="action-btn" onclick="takeLoan()">أخذ قرض</button>

  <hr />

  <h3>سداد القرض</h3>
  <button id="pay-loan-btn" class="action-btn" onclick="payLoan()">سداد القرض بالكامل</button>
</div>

<!-- شاشة الشحنات -->
<div id="shipments" class="screen">
  <h2>🚚 إدارة الشحنات</h2>
  
  <label for="select-route">اختر المسار:</label>
  <select id="select-route" onchange="onSelectionChange()"></select>

  <label for="select-truck">اختر الشاحنة:</label>
  <select id="select-truck" onchange="onSelectionChange()"></select>

  <label for="select-worker">اختر السائق:</label>
  <select id="select-worker" onchange="onSelectionChange()"></select>

  <label for="shipment-qty">كمية البضاعة للإرسال:</label>
  <input id="shipment-qty" type="number" min="1" value="1" onchange="validateShipmentQty()" />

  <div id="risk-display">نسبة الخطر: 0%</div>

  <button class="action-btn" onclick="sendShipment()">إرسال الشحنة</button>

  <div id="shipping-status" style="margin-top: 12px;"></div>
</div>

<!-- شاشة الترقيات -->
<div id="upgrades" class="screen">
  <h2>⚙️ ترقيات الشاحنات والسائقين</h2>

  <h3>ترقية الشاحنات</h3>
  <div id="upgrade-trucks"></div>

  <hr />

  <h3>ترقية السائقين</h3>
  <div id="upgrade-workers"></div>
</div>

<!-- شاشة الأحداث -->
<div id="events" class="screen">
  <h2>📜 سجل الأحداث والدراما</h2>
  <div id="events-log"></div>
</div>

<script>
  // ==========================
  // بيانات اللعبة الأساسية
  // ==========================
  let money = 10000;
  let gangWorkers = 5;
  let gangTrucks = 2;
  let inventory = 0;
  let reputation = 50; // 0-100 مع العصابات
  let stage = 1; // مستوى الصعوبة (يتصاعد)

  // القرض والتمويل
  let loanAmount = 0;
  let loanInterest = 10; // %
  let loanDueTurns = 5; 
  let debtUnpaidTurns = 0;

  let currentTurn = 1;

  // حالة الشحنات
  let shippingInProgress = false;
  let shippingTimer = 0;
  let shippingDetails = null;

  // سجل الأحداث
  let eventsLog = [];

  // الموردين (سوق)
  const workerSuppliers = [
    { id: 'jack', name: 'Jack the Hustler', temperament: 'greedy', basePrice: 2200 },
    { id: 'lisa', name: 'Lisa the Loyal', temperament: 'friendly', basePrice: 1800 }
  ];
  const truckSuppliers = [
    { id: 'speedy', name: 'Speedy Truck Co.', temperament: 'aggressive', basePrice: 16000,
      features: { speed: 8, capacity: 100, security: 3 } },
    { id: 'tank', name: 'Tank Haulers', temperament: 'defensive', basePrice: 20000,
      features: { speed: 5, capacity: 150, security: 8 } }
  ];

  // عمال وسائقين متوفرين
  let workers = [
    { id: 'w1', name: 'علي', skill: 'مبتدئ', skillValue: 1, price: 1500, loyalty: 50, experience: 1 },
    { id: 'w2', name: 'سارة', skill: 'متوسط', skillValue: 2, price: 3000, loyalty: 60, experience: 2 },
    { id: 'w3', name: 'عمر', skill: 'رائع', skillValue: 3, price: 6000, loyalty: 70, experience: 3 },
    { id: 'w4', name: 'نورا', skill: 'أسطوري', skillValue: 5, price: 12000, loyalty: 80, experience: 5 }
  ];

  // الشاحنات المتوفرة
  let trucks = [
    { id: 't1', name: 'Speedy', security: 3, capacity: 100, speed: 8, upgrades: { security: 0, speed: 0, capacity: 0 } },
    { id: 't2', name: 'Tank', security: 8, capacity: 150, speed: 5, upgrades: { security: 0, speed: 0, capacity: 0 } }
  ];

  // المسارات
  let routes = [
    { id: 'safe', name: 'مسار آمن', baseRisk: 10 },
    { id: 'risky', name: 'مسار محفوف بالمخاطر', baseRisk: 40 },
    { id: 'darkweb', name: 'مسار دارك ويب', baseRisk: 60 }
  ];

  // ==========================
  // الدوال الرئيسية
  // ==========================

  // تبديل الشاشة
  function switchScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    event.target?.classList.add('active');
  }

  // تحديث واجهة العصابة
  function renderGangInfo() {
    document.getElementById('gang-money').textContent = money;
    document.getElementById('gang-workers').textContent = gangWorkers;
    document.getElementById('gang-trucks').textContent = gangTrucks;
    document.getElementById('gang-inventory').textContent = inventory;
    document.getElementById('gang-reputation').textContent = reputation + "%";
    document.getElementById('game-stage').textContent = stage;
  }

  // عرض الموردين
  function renderWorkerSuppliers() {
    const container = document.getElementById('worker-suppliers');
    container.innerHTML = '';
    workers.forEach(w => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <b>${w.name}</b> - مهارة: ${w.skill} - ولاء: ${w.loyalty}% - سعر: ${w.price} درهم
        <button class="action-btn" onclick="buyWorker('${w.id}')">شراء</button>
      `;
      container.appendChild(card);
    });
  }
  function renderTruckSuppliers() {
    const container = document.getElementById('truck-suppliers');
    container.innerHTML = '';
    trucks.forEach(t => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <b>${t.name}</b> - سعة: ${t.capacity} - سرعة: ${t.speed} - أمان: ${t.security} - ترقية: أمن(${t.upgrades.security}), سرعة(${t.upgrades.speed}), سعة(${t.upgrades.capacity})
        <button class="action-btn" onclick="buyTruck('${t.id}')">شراء</button>
      `;
      container.appendChild(card);
    });
  }

  // شراء عامل
  function buyWorker(id) {
    const w = workers.find(x => x.id === id);
    if (!w) return alert("خطأ في اختيار العامل.");
    if (money < w.price) return alert("ليس لديك ما يكفي من المال.");
    money -= w.price;
    gangWorkers++;
    inventory += 0; // لم نغير البضاعة هنا
    addEventLog(`✅ اشتريت العامل ${w.name} مقابل ${w.price} درهم.`);
    renderGangInfo();
    renderLoanInfo();
    updateMoneyDisplay();
  }
  // شراء شاحنة
  function buyTruck(id) {
    const t = trucks.find(x => x.id === id);
    if (!t) return alert("خطأ في اختيار الشاحنة.");
    if (money < t.basePrice) return alert("ليس لديك ما يكفي من المال.");
    money -= t.basePrice;
    gangTrucks++;
    addEventLog(`✅ اشتريت الشاحنة ${t.name} مقابل ${t.basePrice} درهم.`);
    renderGangInfo();
    renderLoanInfo();
    updateMoneyDisplay();
  }

  // تحديث عرض المال (نحتاجها في عدة أماكن)
  function updateMoneyDisplay() {
    document.getElementById('gang-money').textContent = money;
  }

  // =======================
  // نظام القروض
  // =======================
  function renderLoanInfo() {
    const loanInfo = document.getElementById('loan-info');
    if (loanAmount > 0) {
      loanInfo.innerHTML = `
        لديك قرض بمبلغ ${loanAmount} درهم.<br />
        نسبة الفائدة الحالية: ${loanInterest}%<br />
        يجب السداد خلال ${loanDueTurns} دورات.
      `;
      document.getElementById('loan-amount').disabled = true;
      document.getElementById('loan-interest').disabled = true;
      document.getElementById('take-loan-btn').disabled = true;
      document.getElementById('pay-loan-btn').disabled = false;
    } else {
      loanInfo.textContent = "ليس لديك أي قرض حالياً.";
      document.getElementById('loan-amount').disabled = false;
      document.getElementById('loan-interest').disabled = false;
      document.getElementById('take-loan-btn').disabled = false;
      document.getElementById('pay-loan-btn').disabled = true;
    }
  }
  function takeLoan() {
    const amountInput = document.getElementById('loan-amount');
    const interestInput = document.getElementById('loan-interest');
    let amt = parseInt(amountInput.value);
    let intr = parseInt(interestInput.value);

    if (isNaN(amt) || amt < 1000) {
      alert("أدخل مبلغ قرض صالح (1000 درهم أو أكثر).");
      return;
    }
    if (isNaN(intr) || intr < 5) {
      alert("أدخل نسبة فائدة صحيحة (5% أو أكثر).");
      return;
    }
    loanAmount = amt;
    loanInterest = intr;
    loanDueTurns = 5;
    debtUnpaidTurns = 0;
    money += amt;
    addEventLog(`💰 أخذت قرضًا بمبلغ ${amt} درهم بفائدة ${intr}%.`);
    updateMoneyDisplay();
    renderLoanInfo();
  }
  function payLoan() {
    if (loanAmount <= 0) return alert("لا يوجد قرض لسداده.");
    if (money < loanAmount) return alert("ليس لديك ما يكفي لسداد القرض.");
    money -= loanAmount;
    addEventLog(`✅ سددت القرض بمبلغ ${loanAmount} درهم.`);
    loanAmount = 0;
    loanInterest = 10;
    loanDueTurns = 0;
    debtUnpaidTurns = 0;
    updateMoneyDisplay();
    renderLoanInfo();
  }

  // ==========================
  // إدارة الشحنات
  // ==========================
  function populateShipmentsSelectors() {
    const routeSel = document.getElementById('select-route');
    const truckSel = document.getElementById('select-truck');
    const workerSel = document.getElementById('select-worker');

    routeSel.innerHTML = '';
    routes.forEach(r => {
      let opt = document.createElement('option');
      opt.value = r.id;
      opt.textContent = r.name;
      routeSel.appendChild(opt);
    });

    truckSel.innerHTML = '';
    trucks.forEach(t => {
      let opt = document.createElement('option');
      opt.value = t.id;
      opt.textContent = `${t.name} (سعة: ${t.capacity}, أمان: ${t.security}, سرعة: ${t.speed})`;
      truckSel.appendChild(opt);
    });

    workerSel.innerHTML = '';
    workers.forEach(w => {
      let opt = document.createElement('option');
      opt.value = w.id;
      opt.textContent = `${w.name} - ${w.skill} (سعر: ${w.price} درهم)`;
      workerSel.appendChild(opt);
    });
  }

  // تحديث نسبة الخطر قبل الإرسال
  function updateRiskDisplay() {
    const routeId = document.getElementById('select-route').value;
    const truckId = document.getElementById('select-truck').value;
    const workerId = document.getElementById('select-worker').value;
    const qty = parseInt(document.getElementById('shipment-qty').value);

    if (!routeId || !truckId || !workerId || isNaN(qty)) {
      document.getElementById('risk-display').textContent = "اختر جميع الخيارات وادخل الكمية.";
      return;
    }

    let route = routes.find(r => r.id === routeId);
    let truck = trucks.find(t => t.id === truckId);
    let worker = workers.find(w => w.id === workerId);

    // حساب نسبة الخطر: أساسياً + خصائص + كمية + سمعة
    let risk = route.baseRisk;
    risk -= truck.security; // الأمان يقلل الخطر
    risk -= worker.skillValue * 5; // مهارة السائق تقلل الخطر
    risk += qty * 0.5; // كل وحدة تزيد الخطر قليلاً
    risk -= reputation / 10; // السمعة تقلل الخطر

    if (risk < 5) risk = 5;
    if (risk > 95) risk = 95;

    document.getElementById('risk-display').textContent = `نسبة الخطر: ${risk.toFixed(1)}%`;
    shippingDetails = { route, truck, worker, qty, risk };
  }

  function validateShipmentQty() {
    const qtyInput = document.getElementById('shipment-qty');
    let val = parseInt(qtyInput.value);
    if (isNaN(val) || val < 1) {
      qtyInput.value = 1;
    }
    if (val > inventory) {
      qtyInput.value = inventory;
    }
    updateRiskDisplay();
  }

  // إرسال الشحنة
  function sendShipment() {
    if (shippingInProgress) {
      alert("هناك شحنة جارية بالفعل، انتظر انتهاءها.");
      return;
    }
    if (!shippingDetails) {
      alert("اختر المسار، الشاحنة، السائق، والكمية أولاً.");
      return;
    }
    if (shippingDetails.qty > inventory) {
      alert("ليس لديك كمية كافية في المخزون.");
      return;
    }

    shippingInProgress = true;
    shippingTimer = 3 + stage; // مدة الشحن تعتمد على المرحلة (تصاعدي)
    addEventLog(`🚚 أرسلت شحنة من ${shippingDetails.qty} وحدة عبر ${shippingDetails.route.name} باستخدام ${shippingDetails.truck.name} مع السائق ${shippingDetails.worker.name}.`);

    // خصم الكمية من المخزون فوراً
    inventory -= shippingDetails.qty;
    renderGangInfo();

    document.getElementById('shipping-status').textContent = `الشحن جارٍ... تبقى ${shippingTimer} دورات.`;

    // بداية العد التنازلي للدورات عبر setInterval
    let intervalId = setInterval(() => {
      shippingTimer--;
      if (shippingTimer <= 0) {
        clearInterval(intervalId);
        completeShipment();
      } else {
        document.getElementById('shipping-status').textContent = `الشحن جارٍ... تبقى ${shippingTimer} دورات.`;
      }
    }, 5000); // كل 5 ثواني دورة
  }

  // إتمام الشحنة
  function completeShipment() {
    shippingInProgress = false;

    // احتمال ضبط الشحنة حسب نسبة الخطر
    let chance = Math.random() * 100;
    if (chance < shippingDetails.risk) {
      // تم ضبط الشحنة
      addEventLog(`❌ تم ضبط شحنتك على طريق ${shippingDetails.route.name}! خسرت البضاعة والمال.`);
      // خسارة مال ونقص سمعة
      money -= shippingDetails.qty * 100; // خسارة نقدية تقديرية
      if (money < 0) money = 0;
      reputation -= 10;
      if (reputation < 0) reputation = 0;
    } else {
      // نجاح الشحنة
      let profit = shippingDetails.qty * (200 + (stage * 50)); // ربح تصاعدي مع المستوى
      money += profit;
      addEventLog(`✅ وصلت شحنتك بسلام وربحت ${profit} درهم.`);
      reputation += 5;
      if (reputation > 100) reputation = 100;
    }
    shippingDetails = null;
    document.getElementById('shipping-status').textContent = "لا توجد شحنات جارية حالياً.";
    renderGangInfo();
    updateMoneyDisplay();
    renderLoanInfo();
  }

  // ======================
  // الترقيات
  // ======================
  function renderUpgrades() {
    const truckDiv = document.getElementById('upgrade-trucks');
    truckDiv.innerHTML = '';
    trucks.forEach(t => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <b>${t.name}</b> - أمان: ${t.security + t.upgrades.security} (ترقية: ${t.upgrades.security}) 
        - سرعة: ${t.speed + t.upgrades.speed} (ترقية: ${t.upgrades.speed})
        - سعة: ${t.capacity + t.upgrades.capacity} (ترقية: ${t.upgrades.capacity})
        <br />
        <button class="action-btn upgrade-btn" onclick="upgradeTruck('${t.id}', 'security')">ترقية الأمان (5000 درهم)</button>
        <button class="action-btn upgrade-btn" onclick="upgradeTruck('${t.id}', 'speed')">ترقية السرعة (5000 درهم)</button>
        <button class="action-btn upgrade-btn" onclick="upgradeTruck('${t.id}', 'capacity')">ترقية السعة (5000 درهم)</button>
      `;
      truckDiv.appendChild(card);
    });

    const workerDiv = document.getElementById('upgrade-workers');
    workerDiv.innerHTML = '';
    workers.forEach(w => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <b>${w.name}</b> - مهارة: ${w.skill} - ولاء: ${w.loyalty}%
        <br />
        <button class="action-btn upgrade-btn" onclick="upgradeWorker('${w.id}')">ترقية المهارة (4000 درهم)</button>
      `;
      workerDiv.appendChild(card);
    });
  }

  function upgradeTruck(id, feature) {
    if (money < 5000) {
      alert("ليس لديك ما يكفي من المال لترقية.");
      return;
    }
    const t = trucks.find(x => x.id === id);
    if (!t) return;

    t.upgrades[feature]++;
    money -= 5000;
    addEventLog(`⚙️ تم ترقية ${feature} للشاحنة ${t.name}.`);
    renderGangInfo();
    updateMoneyDisplay();
    renderUpgrades();
  }

  function upgradeWorker(id) {
    if (money < 4000) {
      alert("ليس لديك ما يكفي من المال لترقية.");
      return;
    }
    const w = workers.find(x => x.id === id);
    if (!w) return;
    // ترقية المهارة (رفع قيمة skillValue ونقطة ولاء)
    if (w.skillValue >= 5) {
      alert("هذه المهارة في أقصى مستوى.");
      return;
    }
    w.skillValue++;
    w.loyalty += 10;
    w.price += 2000;
    money -= 4000;

    // تحديث اسم المهارة
    const skills = ['مبتدئ', 'متوسط', 'رائع', 'أسطوري', 'إسطورة', 'مافيا'];
    w.skill = skills[Math.min(w.skillValue - 1, skills.length -1)];

    addEventLog(`⚙️ تم ترقية مهارة السائق ${w.name} إلى ${w.skill}.`);
    renderGangInfo();
    updateMoneyDisplay();
    renderUpgrades();
  }

  // ========================
  // سجل الأحداث
  // ========================
  function addEventLog(text) {
    const now = new Date().toLocaleTimeString();
    eventsLog.unshift(`[${now}][الدور ${currentTurn}] ${text}`);
    if (eventsLog.length > 100) eventsLog.pop();
    document.getElementById('events-log').textContent = eventsLog.join('\n');
  }

  // ========================
  // تحديثات دورية وتقدم اللعبة
  // ========================
  function runTurn() {
    currentTurn++;

    // قروض: زيادة الفائدة عند عدم السداد
    if (loanAmount > 0) {
      loanDueTurns--;
      if (loanDueTurns <= 0) {
        debtUnpaidTurns++;
        loanInterest += 5;
        loanDueTurns = 5;
        addEventLog(`⚠️ لم تسدد القرض في الوقت المحدد. الفائدة ارتفعت إلى ${loanInterest}%.`);
      }
    }

    // زيادة الصعوبة مع مرور الزمن
    if (currentTurn % 10 === 0) {
      stage++;
      addEventLog(`🔥 ارتفع مستوى الصعوبة إلى ${stage}.`);
    }
  }

  // تهيئة اللعبة
  function init() {
    renderGangInfo();
    renderWorkerSuppliers();
    renderTruckSuppliers();
    renderLoanInfo();
    populateShipmentsSelectors();
    renderUpgrades();
    addEventLog("🔥 تم بدء اللعبة. استعد للهيمنة!");
    updateRiskDisplay();
  }

  // كل 15 ثانية دورة جديدة (تسارع مع الزمن لاحقًا ممكن)
  setInterval(() => {
    runTurn();
  }, 15000);

  // تحديث نسبة الخطر عند تغيير الخيارات
  document.getElementById('select-route').addEventListener('change', updateRiskDisplay);
  document.getElementById('select-truck').addEventListener('change', updateRiskDisplay);
  document.getElementById('select-worker').addEventListener('change', updateRiskDisplay);
  document.getElementById('shipment-qty').addEventListener('input', validateShipmentQty);

  // بدأ اللعبة عند التحميل
  window.onload = init;

</script>

</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>💀 إمبراطورية الظلام - لعبة اللوجستيك السوداء</title>
  <style>
    body {
      background: #0d0d0d;
      color: #eee;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
    }
    nav {
      background: #330000;
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 15px;
      border-bottom: 3px solid #ff0000;
    }
    nav button {
      background: #aa0000;
      border: none;
      padding: 10px 20px;
      color: white;
      font-weight: bold;
      font-size: 1em;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.3s;
    }
    nav button:hover, nav button.active {
      background: #ff0000;
    }
    .screen {
      display: none;
      padding: 20px;
    }
    .screen.active {
      display: block;
    }
    .card {
      background: #1a0a0a;
      padding: 15px;
      margin: 15px 0;
      border-radius: 8px;
      box-shadow: 0 0 10px #aa0000a0;
    }
    .action-btn {
      background: #aa0000;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      font-weight: bold;
      margin-top: 10px;
      cursor: pointer;
    }
    .action-btn:hover {
      background: #ff0000;
    }
    h1, h2, h3 {
      margin: 0 0 10px 0;
    }
    .data-line {
      margin: 5px 0;
    }
    select, input {
      padding: 8px;
      border: none;
      border-radius: 5px;
      margin: 5px 0 10px 0;
      width: 100%;
      background: #330000;
      color: white;
    }
    #log {
      background: #220000;
      padding: 10px;
      font-family: monospace;
      height: 150px;
      overflow-y: scroll;
      border: 1px solid #550000;
      margin-top: 15px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
<script>
  // بيانات أولية
  let money = 10000;
  let inventory = 0;
  let trucks = [];
  let workers = [];
  let level = 1;
  let reputation = 50;
  let loan = { amount: 0, rate: 10, turnsLeft: 5 };

  const items = [
    { name: "AK-47", type: "سلاح", price: 2000 },
    { name: "Cocaine", type: "مخدر", price: 3500 },
    { name: "Pistol", type: "سلاح", price: 1000 },
    { name: "Meth", type: "مخدر", price: 4000 }
  ];

  const routes = [
    { name: "شارع الموت", risk: 70 },
    { name: "الحدود الشرقية", risk: 40 },
    { name: "نفق السوق السوداء", risk: 60 },
    { name: "طريق آمن", risk: 20 }
  ];

  const availableTrucks = [
    { name: "Truck Z", speed: 7, security: 4, capacity: 80 },
    { name: "Armor Van", speed: 5, security: 9, capacity: 60 },
    { name: "Fast Hauler", speed: 9, security: 3, capacity: 100 }
  ];

  const availableWorkers = [
    { name: "أمين", skill: "مبتدئ", value: 1 },
    { name: "فهد", skill: "متوسط", value: 2 },
    { name: "ياسين", skill: "رائع", value: 3 },
    { name: "جمال", skill: "أسطوري", value: 5 }
  ];

  const log = [];

  // ====== دوال عرض اللعبة ======

  function updateUI() {
    document.getElementById("money").innerText = money;
    document.getElementById("inventory").innerText = inventory;
    document.getElementById("truckCount").innerText = trucks.length;
    document.getElementById("workerCount").innerText = workers.length;
    document.getElementById("level").innerText = level;
    document.getElementById("reputation").innerText = reputation;
    document.getElementById("logBox").innerText = log.join("\n");

    document.getElementById("marketItems").innerHTML = items.map((item, i) => `
      <div class="card">
        ${item.type} - <b>${item.name}</b> | السعر: ${item.price} درهم
        <button onclick="buyItem(${i})" class="action-btn">شراء</button>
      </div>
    `).join("");

    document.getElementById("selectItem").innerHTML = items.map((item, i) => `
      <option value="${i}">${item.name}</option>
    `).join("");

    document.getElementById("selectWorker").innerHTML = workers.map((w, i) => `
      <option value="${i}">${w.name} (${w.skill})</option>
    `).join("");

    document.getElementById("selectTruck").innerHTML = trucks.map((t, i) => `
      <option value="${i}">${t.name}</option>
    `).join("");

    document.getElementById("selectRoute").innerHTML = routes.map((r, i) => `
      <option value="${i}">${r.name} - خطورة: ${r.risk}%</option>
    `).join("");

    document.getElementById("loanStatus").innerHTML = loan.amount > 0 ?
      `💸 لديك قرض بـ ${loan.amount} درهم بنسبة ${loan.rate}%. باقي ${loan.turnsLeft} دورة.` :
      `✔️ لا يوجد أي قرض حالياً.`;
  }

  function switchScreen(screen) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(screen).classList.add("active");
    document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
    event.target.classList.add("active");
  }

  function addLog(entry) {
    const time = new Date().toLocaleTimeString();
    log.unshift(`[${time}] ${entry}`);
    if (log.length > 100) log.pop();
    updateUI();
  }

  // ====== الأحداث الأساسية ======

  function buyItem(index) {
    const item = items[index];
    if (money >= item.price) {
      money -= item.price;
      inventory++;
      addLog(`📦 اشتريت ${item.name} مقابل ${item.price} درهم.`);
    } else {
      alert("❌ ليس لديك مال كاف.");
    }
  }

  function sendShipment() {
    const qty = parseInt(document.getElementById("shipmentQty").value);
    const item = items[document.getElementById("selectItem").value];
    const worker = workers[document.getElementById("selectWorker").value];
    const truck = trucks[document.getElementById("selectTruck").value];
    const route = routes[document.getElementById("selectRoute").value];

    if (!item || !worker || !truck || !route || isNaN(qty) || qty < 1 || qty > inventory) {
      alert("❌ تأكد من كل البيانات بشكل صحيح.");
      return;
    }

    let risk = route.risk - truck.security * 3 - worker.value * 4;
    if (risk < 5) risk = 5;

    document.getElementById("riskDisplay").innerText = `نسبة الخطر: ${risk}%`;

    const caught = Math.random() * 100 < risk;

    if (caught) {
      inventory -= qty;
      reputation -= 10;
      addLog(`❌ تم ضبط شحنة من ${qty} × ${item.name} على طريق ${route.name}.`);
    } else {
      inventory -= qty;
      const profit = qty * item.price * (1.2 + level * 0.1);
      money += Math.round(profit);
      reputation += 5;
      addLog(`✅ شحنة ناجحة: ${qty} × ${item.name}. الربح: ${Math.round(profit)} درهم.`);
    }

    updateUI();
  }

  function takeLoan() {
    const amt = parseInt(document.getElementById("loanAmountInput").value);
    const rate = parseInt(document.getElementById("loanRateInput").value);

    if (loan.amount > 0) {
      alert("لديك قرض جاري بالفعل.");
      return;
    }

    if (amt < 1000 || rate < 5) {
      alert("❌ تحقق من المبلغ والنسبة.");
      return;
    }

    loan.amount = amt;
    loan.rate = rate;
    loan.turnsLeft = 5;
    money += amt;
    addLog(`💸 تم الحصول على قرض بقيمة ${amt} درهم.`);
    updateUI();
  }

  function payLoan() {
    const total = loan.amount + Math.round(loan.amount * loan.rate / 100);
    if (money >= total) {
      money -= total;
      loan = { amount: 0, rate: 10, turnsLeft: 0 };
      addLog(`✅ تم سداد القرض بنجاح.`);
    } else {
      alert("❌ لا تملك المبلغ الكافي.");
    }
    updateUI();
  }

  // ====== الترقيات ======

  function upgrade() {
    document.getElementById("upgradeOptions").innerHTML = `
      <div class="card">
        <h3>🚛 شراء شاحنة</h3>
        ${availableTrucks.map((t, i) => `
          <div>${t.name} - سعة: ${t.capacity}, أمان: ${t.security}
          <button onclick="buyTruck(${i})" class="action-btn">شراء</button></div>
        `).join("")}
        <hr />
        <h3>🧍‍♂️ توظيف سائق</h3>
        ${availableWorkers.map((w, i) => `
          <div>${w.name} - ${w.skill}
          <button onclick="hireWorker(${i})" class="action-btn">توظيف</button></div>
        `).join("")}
      </div>
    `;
  }

  function buyTruck(i) {
    const t = availableTrucks[i];
    const cost = 10000 + t.security * 1000;
    if (money >= cost) {
      trucks.push(t);
      money -= cost;
      addLog(`🚛 اشتريت ${t.name}`);
      updateUI();
    } else {
      alert("❌ لا تملك المال الكافي.");
    }
  }

  function hireWorker(i) {
    const w = availableWorkers[i];
    const cost = 5000 + w.value * 1500;
    if (money >= cost) {
      workers.push(w);
      money -= cost;
      addLog(`🧍‍♂️ وظّفت ${w.name}`);
      updateUI();
    } else {
      alert("❌ لا تملك المال الكافي.");
    }
  }

  // ====== تقدم اللعبة ======
  setInterval(() => {
    level++;
    if (loan.amount > 0) {
      loan.turnsLeft--;
      if (loan.turnsLeft <= 0) {
        loan.rate += 5;
        loan.turnsLeft = 5;
        addLog(`⚠️ تأخير في سداد القرض. الفائدة ارتفعت لـ ${loan.rate}%`);
      }
    }
    updateUI();
  }, 15000); // كل 15 ثانية

  window.onload = () => {
    trucks.push(availableTrucks[0]);
    workers.push(availableWorkers[0]);
    upgrade();
    updateUI();
  };
</script>
