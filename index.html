<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>👑 سلطان اللوجيستيك - لعبة الإدارة الشيطانية</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    direction: rtl;
    padding: 20px;
    max-width: 700px;
    margin: auto;
  }
  h1 {
    color: #00ffe1;
    text-align: center;
    margin-bottom: 20px;
  }
  .status-bar {
    font-size: 14px;
    color: #aaa;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
  }
  .client {
    background: #222;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 10px;
    box-shadow: 0 0 12px crimson;
  }
  .client h2 {
    margin-top: 0;
    color: #ff4c4c;
  }
  .stock-bar {
    background: #444;
    border-radius: 10px;
    overflow: hidden;
    margin: 8px 0 10px 0;
  }
  .stock-fill {
    height: 20px;
    background: #00ffe1;
    width: 0%;
    transition: width 0.5s ease;
  }
  button {
    background: #333;
    color: #eee;
    border: none;
    border-radius: 8px;
    padding: 10px 15px;
    margin-top: 10px;
    cursor: pointer;
    font-weight: bold;
    width: 100%;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #555;
  }
  #events {
    background: #222;
    border-radius: 12px;
    padding: 10px;
    max-height: 120px;
    overflow-y: auto;
    margin-bottom: 20px;
    font-size: 14px;
  }
  #feedback {
    margin-top: 10px;
    font-weight: bold;
    text-align: center;
    font-size: 18px;
  }
</style>
</head>
<body>

<h1>👑 سلطان اللوجيستيك - الإدارة الشيطانية</h1>
<div class="status-bar">
  <div>⏱️ الوقت: <span id="time">0</span> ثانية</div>
  <div>💠 النقاط: <span id="score">0</span></div>
</div>

<div id="clients-container"></div>

<div id="events"></div>

<div id="feedback"></div>

<script>
(() => {
  // --- بيانات العملاء والمخازن ---
  const clients = [
    {
      id: 1,
      name: "العميل الأحمر",
      stock: 100,
      maxStock: 200,
      dailyDemandRange: [15, 30],
      reorderPoint: 50,
      reorderAmount: 100,
    },
    {
      id: 2,
      name: "العميل الأزرق",
      stock: 150,
      maxStock: 300,
      dailyDemandRange: [20, 40],
      reorderPoint: 80,
      reorderAmount: 120,
    },
    {
      id: 3,
      name: "العميل الأخضر",
      stock: 80,
      maxStock: 150,
      dailyDemandRange: [10, 25],
      reorderPoint: 40,
      reorderAmount: 90,
    },
  ];

  let score = 0;
  let timeElapsed = 0;
  let day = 1;
  const totalDays = 7;

  const timeElem = document.getElementById("time");
  const scoreElem = document.getElementById("score");
  const clientsContainer = document.getElementById("clients-container");
  const eventsElem = document.getElementById("events");
  const feedbackElem = document.getElementById("feedback");

  // إنشاء واجهة العميل
  function createClientUI(client) {
    const div = document.createElement("div");
    div.className = "client";
    div.id = `client-${client.id}`;

    div.innerHTML = `
      <h2>${client.name}</h2>
      <div>المخزون الحالي: <span class="stock-value">${client.stock}</span> / ${client.maxStock}</div>
      <div class="stock-bar"><div class="stock-fill" style="width: ${Math.min(100, (client.stock / client.maxStock) * 100)}%"></div></div>
      <button onclick="reorder(${client.id})">طلب إعادة توريد (${client.reorderAmount} وحدة)</button>
    `;

    return div;
  }

  // عرض كل العملاء
  function displayClients() {
    clientsContainer.innerHTML = "";
    clients.forEach(client => {
      clientsContainer.appendChild(createClientUI(client));
    });
  }

  // تحديث واجهة العميل
  function updateClientUI(client) {
    const clientDiv = document.getElementById(`client-${client.id}`);
    if (!clientDiv) return;
    clientDiv.querySelector(".stock-value").textContent = client.stock;
    const fillPercent = Math.min(100, (client.stock / client.maxStock) * 100);
    clientDiv.querySelector(".stock-fill").style.width = fillPercent + "%";
  }

  // إضافة حدث في صندوق الأحداث
  function addEvent(text) {
    const p = document.createElement("p");
    p.textContent = `📢 ${text}`;
    eventsElem.prepend(p);
    if (eventsElem.childElementCount > 5) {
      eventsElem.removeChild(eventsElem.lastChild);
    }
  }

  // طلب إعادة توريد
  window.reorder = function(clientId) {
    const client = clients.find(c => c.id === clientId);
    if (!client) return;
    if (client.stock + client.reorderAmount > client.maxStock) {
      feedbackElem.textContent = `⚠️ لا يمكنك زيادة المخزون فوق الحد الأقصى للعميل ${client.name}`;
      return;
    }
    client.stock += client.reorderAmount;
    score += 5;
    updateClientUI(client);
    feedbackElem.textContent = `✔️ طلب إعادة التوريد للعميل ${client.name} تمت بنجاح! +5 نقاط`;
    scoreElem.textContent = score;
    addEvent(`تم طلب توريد ${client.reorderAmount} وحدة للعميل ${client.name}`);
  };

  // تنفيذ يوم جديد: خصم الطلب اليومي العشوائي من كل عميل
  function nextDay() {
    if (day > totalDays) {
      endGame();
      return;
    }
    feedbackElem.textContent = "";
    addEvent(`-- بدء اليوم ${day} --`);

    clients.forEach(client => {
      const demand = randomInt(client.dailyDemandRange[0], client.dailyDemandRange[1]);
      client.stock -= demand;
      addEvent(`العميل ${client.name} طلب ${demand} وحدة.`);
      if (client.stock < 0) {
        client.stock = 0;
      }
      updateClientUI(client);
    });

    // تحقق خسارة إذا نفد المخزون عند أي عميل
    const outOfStockClients = clients.filter(c => c.stock === 0);
    if (outOfStockClients.length > 0) {
      feedbackElem.textContent = `❌ خسرت! نفد المخزون لدى ${outOfStockClients.map(c => c.name).join(", ")} في اليوم ${day}`;
      clearInterval(gameTimer);
      disableReorderButtons();
      return;
    }

    day++;
  }

  // تعطيل أزرار الطلب عند انتهاء اللعبة
  function disableReorderButtons() {
    clients.forEach(client => {
      const btn = document.querySelector(`#client-${client.id} button`);
      if (btn) btn.disabled = true;
    });
  }

  // إنهاء اللعبة (فوز)
  function endGame() {
    clearInterval(gameTimer);
    disableReorderButtons();
    feedbackElem.textContent = `🎉 مبروك! أكملت ${totalDays} أيام من السيطرة على اللوجيستيك بنجاح. نقاطك النهائية: ${score}`;
    addEvent("🏆 اللعبة انتهت بنجاح!");
  }

  // توليد رقم عشوائي بين min و max
  function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  // تحديث الوقت والنقاط
  function updateStatus() {
    timeElapsed++;
    timeElem.textContent = timeElapsed;
    scoreElem.textContent = score;
  }

  displayClients();

  // بدء العد التنازلي لليوم الجديد كل 15 ثانية (يمكن تغيير المدة حسب رغبتك)
  const gameTimer = setInterval(() => {
    nextDay();
    updateStatus();
  }, 15000);

  // تحديث الوقت كل ثانية
  setInterval(() => {
    timeElapsed++;
    timeElem.textContent = timeElapsed;
  }, 1000);

})();
</script>

</body>
</html>
