<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ’€ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ø¸Ù„Ø§Ù… - Ù„Ø¹Ø¨Ø© Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠÙƒ Ø§Ù„Ø´ÙŠØ·Ø§Ù†ÙŠØ©</title>
<style>
  body {
    background: #0c0c0c;
    color: #eee;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    user-select: none;
  }
  nav {
    background: #2a0b0b;
    padding: 10px;
    display: flex;
    gap: 8px;
    justify-content: center;
    border-bottom: 3px solid #aa0000;
  }
  nav button {
    background: #aa0000;
    border: none;
    padding: 10px 18px;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border-radius: 6px;
    transition: background 0.3s ease;
    font-size: 1.1em;
  }
  nav button:hover, nav button.active {
    background: #ff0000;
  }
  .screen {
    display: none;
    padding: 20px 30px;
    min-height: 500px;
    overflow-y: auto;
  }
  .screen.active {
    display: block;
  }
  h1,h2,h3,h4 {
    margin-top: 0;
  }
  .card {
    background: #1b0d0d;
    margin: 12px 0;
    padding: 16px 18px;
    border-radius: 8px;
    box-shadow: 0 0 10px #bb0000cc;
  }
  .action-btn {
    background: #aa0000;
    color: white;
    border: none;
    padding: 10px 16px;
    margin-top: 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s ease;
    font-size: 1em;
  }
  .action-btn:hover:enabled {
    background: #ff0000;
  }
  .action-btn:disabled {
    background: #550000;
    cursor: not-allowed;
  }
  #events-log {
    height: 180px;
    overflow-y: auto;
    background: #220707;
    padding: 14px;
    font-family: monospace;
    font-size: 0.9em;
    border-radius: 8px;
    white-space: pre-wrap;
    border: 2px solid #aa0000;
  }
  label {
    display: block;
    margin: 8px 0 6px 0;
    font-weight: bold;
  }
  select, input[type=number], input[type=text] {
    width: 100%;
    padding: 8px 10px;
    border-radius: 6px;
    border: none;
    margin-bottom: 12px;
    background: #330909;
    color: #fff;
    font-size: 1em;
  }
  #risk-display {
    font-weight: bolder;
    margin: 16px 0 12px 0;
    font-size: 1.3em;
    color: #ff3333;
    text-align: center;
    text-shadow: 0 0 10px #ff0000;
  }
  hr {
    border: 1px solid #aa0000;
    margin: 28px 0;
  }
  .upgrade-btn {
    background: #880000;
    font-size: 0.9em;
    margin-left: 8px;
    padding: 5px 12px;
  }
  .upgrade-btn:hover {
    background: #cc0000;
  }
  .disabled-text {
    color: #770000;
    font-style: italic;
  }
</style>
</head>
<body>

<nav>
  <button onclick="switchScreen('gang')" class="active">ğŸ•¶ï¸ Ø¹ØµØ§Ø¨ØªÙƒ</button>
  <button onclick="switchScreen('market')">ğŸª Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡</button>
  <button onclick="switchScreen('loans')">ğŸ’¸ Ø§Ù„Ù‚Ø±ÙˆØ¶ ÙˆØ§Ù„ØªÙ…ÙˆÙŠÙ„</button>
  <button onclick="switchScreen('shipments')">ğŸšš Ø§Ù„Ø´Ø­Ù†Ø§Øª</button>
  <button onclick="switchScreen('upgrades')">âš™ï¸ Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª</button>
  <button onclick="switchScreen('events')">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</button>
</nav>

<!-- Ø´Ø§Ø´Ø© Ø¹ØµØ§Ø¨ØªÙƒ -->
<div id="gang" class="screen active">
  <h1>Ø¹ØµØ§Ø¨ØªÙƒ: Ù‚ÙˆØ© Ø§Ù„Ø¸Ù„Ø§Ù…</h1>
  <div class="card">
    <p>ğŸ’° Ø§Ù„Ù…Ø§Ù„: <span id="gang-money"></span> Ø¯Ø±Ù‡Ù…</p>
    <p>ğŸ‘¥ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ†: <span id="gang-workers"></span></p>
    <p>ğŸš› Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø§Ø­Ù†Ø§Øª: <span id="gang-trucks"></span></p>
    <p>ğŸ“¦ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ù„Ø¹ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: <span id="gang-inventory"></span></p>
    <p>ğŸ›¡ï¸ Ø§Ù„Ø³Ù…Ø¹Ø© Ù…Ø¹ Ø§Ù„Ø¹ØµØ§Ø¨Ø§Øª: <span id="gang-reputation"></span></p>
    <p>ğŸ”¥ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©: <span id="game-stage"></span></p>
  </div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø³ÙˆÙ‚ -->
<div id="market" class="screen">
  <h2>ğŸª Ø³ÙˆÙ‚ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØ§Ù„ØªÙØ§ÙˆØ¶</h2>
  
  <h3>Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ù…Ø§Ù„</h3>
  <div id="worker-suppliers"></div>

  <hr />

  <h3>Ø´Ø±Ø§Ø¡ Ø§Ù„Ø´Ø§Ø­Ù†Ø§Øª</h3>
  <div id="truck-suppliers"></div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù‚Ø±ÙˆØ¶ -->
<div id="loans" class="screen">
  <h2>ğŸ’¸ Ø§Ù„Ù‚Ø±ÙˆØ¶ ÙˆØ§Ù„ØªÙ…ÙˆÙŠÙ„</h2>
  <div id="loan-info" class="card"></div>

  <h3>Ø£Ø®Ø° Ù‚Ø±Ø¶ Ø¬Ø¯ÙŠØ¯</h3>
  <label for="loan-amount">Ø§Ù„Ù…Ø¨Ù„Øº (Ø¯Ø±Ù‡Ù…):</label>
  <input id="loan-amount" type="number" min="1000" />
  <label for="loan-interest">Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© %:</label>
  <input id="loan-interest" type="number" min="5" value="10" />
  <button id="take-loan-btn" class="action-btn" onclick="takeLoan()">Ø£Ø®Ø° Ù‚Ø±Ø¶</button>

  <hr />

  <h3>Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø±Ø¶</h3>
  <button id="pay-loan-btn" class="action-btn" onclick="payLoan()">Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø±Ø¶ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø´Ø­Ù†Ø§Øª -->
<div id="shipments" class="screen">
  <h2>ğŸšš Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø­Ù†Ø§Øª</h2>
  
  <label for="select-route">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø§Ø±:</label>
  <select id="select-route" onchange="onSelectionChange()"></select>

  <label for="select-truck">Ø§Ø®ØªØ± Ø§Ù„Ø´Ø§Ø­Ù†Ø©:</label>
  <select id="select-truck" onchange="onSelectionChange()"></select>

  <label for="select-worker">Ø§Ø®ØªØ± Ø§Ù„Ø³Ø§Ø¦Ù‚:</label>
  <select id="select-worker" onchange="onSelectionChange()"></select>

  <label for="shipment-qty">ÙƒÙ…ÙŠØ© Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© Ù„Ù„Ø¥Ø±Ø³Ø§Ù„:</label>
  <input id="shipment-qty" type="number" min="1" value="1" onchange="validateShipmentQty()" />

  <div id="risk-display">Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø±: 0%</div>

  <button class="action-btn" onclick="sendShipment()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ø­Ù†Ø©</button>

  <div id="shipping-status" style="margin-top: 12px;"></div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª -->
<div id="upgrades" class="screen">
  <h2>âš™ï¸ ØªØ±Ù‚ÙŠØ§Øª Ø§Ù„Ø´Ø§Ø­Ù†Ø§Øª ÙˆØ§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</h2>

  <h3>ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø´Ø§Ø­Ù†Ø§Øª</h3>
  <div id="upgrade-trucks"></div>

  <hr />

  <h3>ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</h3>
  <div id="upgrade-workers"></div>
</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« -->
<div id="events" class="screen">
  <h2>ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ø¯Ø±Ø§Ù…Ø§</h2>
  <div id="events-log"></div>
</div>

<script>
  // ==========================
  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
  // ==========================
  let money = 10000;
  let gangWorkers = 5;
  let gangTrucks = 2;
  let inventory = 0;
  let reputation = 50; // 0-100 Ù…Ø¹ Ø§Ù„Ø¹ØµØ§Ø¨Ø§Øª
  let stage = 1; // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© (ÙŠØªØµØ§Ø¹Ø¯)

  // Ø§Ù„Ù‚Ø±Ø¶ ÙˆØ§Ù„ØªÙ…ÙˆÙŠÙ„
  let loanAmount = 0;
  let loanInterest = 10; // %
  let loanDueTurns = 5; 
  let debtUnpaidTurns = 0;

  let currentTurn = 1;

  // Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø­Ù†Ø§Øª
  let shippingInProgress = false;
  let shippingTimer = 0;
  let shippingDetails = null;

  // Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
  let eventsLog = [];

  // Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† (Ø³ÙˆÙ‚)
  const workerSuppliers = [
    { id: 'jack', name: 'Jack the Hustler', temperament: 'greedy', basePrice: 2200 },
    { id: 'lisa', name: 'Lisa the Loyal', temperament: 'friendly', basePrice: 1800 }
  ];
  const truckSuppliers = [
    { id: 'speedy', name: 'Speedy Truck Co.', temperament: 'aggressive', basePrice: 16000,
      features: { speed: 8, capacity: 100, security: 3 } },
    { id: 'tank', name: 'Tank Haulers', temperament: 'defensive', basePrice: 20000,
      features: { speed: 5, capacity: 150, security: 8 } }
  ];

  // Ø¹Ù…Ø§Ù„ ÙˆØ³Ø§Ø¦Ù‚ÙŠÙ† Ù…ØªÙˆÙØ±ÙŠÙ†
  let workers = [
    { id: 'w1', name: 'Ø¹Ù„ÙŠ', skill: 'Ù…Ø¨ØªØ¯Ø¦', skillValue: 1, price: 1500, loyalty: 50, experience: 1 },
    { id: 'w2', name: 'Ø³Ø§Ø±Ø©', skill: 'Ù…ØªÙˆØ³Ø·', skillValue: 2, price: 3000, loyalty: 60, experience: 2 },
    { id: 'w3', name: 'Ø¹Ù…Ø±', skill: 'Ø±Ø§Ø¦Ø¹', skillValue: 3, price: 6000, loyalty: 70, experience: 3 },
    { id: 'w4', name: 'Ù†ÙˆØ±Ø§', skill: 'Ø£Ø³Ø·ÙˆØ±ÙŠ', skillValue: 5, price: 12000, loyalty: 80, experience: 5 }
  ];

  // Ø§Ù„Ø´Ø§Ø­Ù†Ø§Øª Ø§Ù„Ù…ØªÙˆÙØ±Ø©
  let trucks = [
    { id: 't1', name: 'Speedy', security: 3, capacity: 100, speed: 8, upgrades: { security: 0, speed: 0, capacity: 0 } },
    { id: 't2', name: 'Tank', security: 8, capacity: 150, speed: 5, upgrades: { security: 0, speed: 0, capacity: 0 } }
  ];

  // Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª
  let routes = [
    { id: 'safe', name: 'Ù…Ø³Ø§Ø± Ø¢Ù…Ù†', baseRisk: 10 },
    { id: 'risky', name: 'Ù…Ø³Ø§Ø± Ù…Ø­ÙÙˆÙ Ø¨Ø§Ù„Ù…Ø®Ø§Ø·Ø±', baseRisk: 40 },
    { id: 'darkweb', name: 'Ù…Ø³Ø§Ø± Ø¯Ø§Ø±Ùƒ ÙˆÙŠØ¨', baseRisk: 60 }
  ];

  // ==========================
  // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  // ==========================

  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø§Ø´Ø©
  function switchScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
    event.target?.classList.add('active');
  }

  // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹ØµØ§Ø¨Ø©
  function renderGangInfo() {
    document.getElementById('gang-money').textContent = money;
    document.getElementById('gang-workers').textContent = gangWorkers;
    document.getElementById('gang-trucks').textContent = gangTrucks;
    document.getElementById('gang-inventory').textContent = inventory;
    document.getElementById('gang-reputation').textContent = reputation + "%";
    document.getElementById('game-stage').textContent = stage;
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
  function renderWorkerSuppliers() {
    const container = document.getElementById('worker-suppliers');
    container.innerHTML = '';
    workers.forEach(w => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <b>${w.name}</b> - Ù…Ù‡Ø§Ø±Ø©: ${w.skill} - ÙˆÙ„Ø§Ø¡: ${w.loyalty}% - Ø³Ø¹Ø±: ${w.price} Ø¯Ø±Ù‡Ù…
        <button class="action-btn" onclick="buyWorker('${w.id}')">Ø´Ø±Ø§Ø¡</button>
      `;
      container.appendChild(card);
    });
  }
  function renderTruckSuppliers() {
    const container = document.getElementById('truck-suppliers');
    container.innerHTML = '';
    trucks.forEach(t => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <b>${t.name}</b> - Ø³Ø¹Ø©: ${t.capacity} - Ø³Ø±Ø¹Ø©: ${t.speed} - Ø£Ù…Ø§Ù†: ${t.security} - ØªØ±Ù‚ÙŠØ©: Ø£Ù…Ù†(${t.upgrades.security}), Ø³Ø±Ø¹Ø©(${t.upgrades.speed}), Ø³Ø¹Ø©(${t.upgrades.capacity})
        <button class="action-btn" onclick="buyTruck('${t.id}')">Ø´Ø±Ø§Ø¡</button>
      `;
      container.appendChild(card);
    });
  }

  // Ø´Ø±Ø§Ø¡ Ø¹Ø§Ù…Ù„
  function buyWorker(id) {
    const w = workers.find(x => x.id === id);
    if (!w) return alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ø§Ù…Ù„.");
    if (money < w.price) return alert("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ù…Ø§ ÙŠÙƒÙÙŠ Ù…Ù† Ø§Ù„Ù…Ø§Ù„.");
    money -= w.price;
    gangWorkers++;
    inventory += 0; // Ù„Ù… Ù†ØºÙŠØ± Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© Ù‡Ù†Ø§
    addEventLog(`âœ… Ø§Ø´ØªØ±ÙŠØª Ø§Ù„Ø¹Ø§Ù…Ù„ ${w.name} Ù…Ù‚Ø§Ø¨Ù„ ${w.price} Ø¯Ø±Ù‡Ù….`);
    renderGangInfo();
    renderLoanInfo();
    updateMoneyDisplay();
  }
  // Ø´Ø±Ø§Ø¡ Ø´Ø§Ø­Ù†Ø©
  function buyTruck(id) {
    const t = trucks.find(x => x.id === id);
    if (!t) return alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´Ø§Ø­Ù†Ø©.");
    if (money < t.basePrice) return alert("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ù…Ø§ ÙŠÙƒÙÙŠ Ù…Ù† Ø§Ù„Ù…Ø§Ù„.");
    money -= t.basePrice;
    gangTrucks++;
    addEventLog(`âœ… Ø§Ø´ØªØ±ÙŠØª Ø§Ù„Ø´Ø§Ø­Ù†Ø© ${t.name} Ù…Ù‚Ø§Ø¨Ù„ ${t.basePrice} Ø¯Ø±Ù‡Ù….`);
    renderGangInfo();
    renderLoanInfo();
    updateMoneyDisplay();
  }

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø§Ù„ (Ù†Ø­ØªØ§Ø¬Ù‡Ø§ ÙÙŠ Ø¹Ø¯Ø© Ø£Ù…Ø§ÙƒÙ†)
  function updateMoneyDisplay() {
    document.getElementById('gang-money').textContent = money;
  }

  // =======================
  // Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚Ø±ÙˆØ¶
  // =======================
  function renderLoanInfo() {
    const loanInfo = document.getElementById('loan-info');
    if (loanAmount > 0) {
      loanInfo.innerHTML = `
        Ù„Ø¯ÙŠÙƒ Ù‚Ø±Ø¶ Ø¨Ù…Ø¨Ù„Øº ${loanAmount} Ø¯Ø±Ù‡Ù….<br />
        Ù†Ø³Ø¨Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${loanInterest}%<br />
        ÙŠØ¬Ø¨ Ø§Ù„Ø³Ø¯Ø§Ø¯ Ø®Ù„Ø§Ù„ ${loanDueTurns} Ø¯ÙˆØ±Ø§Øª.
      `;
      document.getElementById('loan-amount').disabled = true;
      document.getElementById('loan-interest').disabled = true;
      document.getElementById('take-loan-btn').disabled = true;
      document.getElementById('pay-loan-btn').disabled = false;
    } else {
      loanInfo.textContent = "Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ù‚Ø±Ø¶ Ø­Ø§Ù„ÙŠØ§Ù‹.";
      document.getElementById('loan-amount').disabled = false;
      document.getElementById('loan-interest').disabled = false;
      document.getElementById('take-loan-btn').disabled = false;
      document.getElementById('pay-loan-btn').disabled = true;
    }
  }
  function takeLoan() {
    const amountInput = document.getElementById('loan-amount');
    const interestInput = document.getElementById('loan-interest');
    let amt = parseInt(amountInput.value);
    let intr = parseInt(interestInput.value);

    if (isNaN(amt) || amt < 1000) {
      alert("Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº Ù‚Ø±Ø¶ ØµØ§Ù„Ø­ (1000 Ø¯Ø±Ù‡Ù… Ø£Ùˆ Ø£ÙƒØ«Ø±).");
      return;
    }
    if (isNaN(intr) || intr < 5) {
      alert("Ø£Ø¯Ø®Ù„ Ù†Ø³Ø¨Ø© ÙØ§Ø¦Ø¯Ø© ØµØ­ÙŠØ­Ø© (5% Ø£Ùˆ Ø£ÙƒØ«Ø±).");
      return;
    }
    loanAmount = amt;
    loanInterest = intr;
    loanDueTurns = 5;
    debtUnpaidTurns = 0;
    money += amt;
    addEventLog(`ğŸ’° Ø£Ø®Ø°Øª Ù‚Ø±Ø¶Ù‹Ø§ Ø¨Ù…Ø¨Ù„Øº ${amt} Ø¯Ø±Ù‡Ù… Ø¨ÙØ§Ø¦Ø¯Ø© ${intr}%.`);
    updateMoneyDisplay();
    renderLoanInfo();
  }
  function payLoan() {
    if (loanAmount <= 0) return alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ø±Ø¶ Ù„Ø³Ø¯Ø§Ø¯Ù‡.");
    if (money < loanAmount) return alert("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ù…Ø§ ÙŠÙƒÙÙŠ Ù„Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø±Ø¶.");
    money -= loanAmount;
    addEventLog(`âœ… Ø³Ø¯Ø¯Øª Ø§Ù„Ù‚Ø±Ø¶ Ø¨Ù…Ø¨Ù„Øº ${loanAmount} Ø¯Ø±Ù‡Ù….`);
    loanAmount = 0;
    loanInterest = 10;
    loanDueTurns = 0;
    debtUnpaidTurns = 0;
    updateMoneyDisplay();
    renderLoanInfo();
  }

  // ==========================
  // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø­Ù†Ø§Øª
  // ==========================
  function populateShipmentsSelectors() {
    const routeSel = document.getElementById('select-route');
    const truckSel = document.getElementById('select-truck');
    const workerSel = document.getElementById('select-worker');

    routeSel.innerHTML = '';
    routes.forEach(r => {
      let opt = document.createElement('option');
      opt.value = r.id;
      opt.textContent = r.name;
      routeSel.appendChild(opt);
    });

    truckSel.innerHTML = '';
    trucks.forEach(t => {
      let opt = document.createElement('option');
      opt.value = t.id;
      opt.textContent = `${t.name} (Ø³Ø¹Ø©: ${t.capacity}, Ø£Ù…Ø§Ù†: ${t.security}, Ø³Ø±Ø¹Ø©: ${t.speed})`;
      truckSel.appendChild(opt);
    });

    workerSel.innerHTML = '';
    workers.forEach(w => {
      let opt = document.createElement('option');
      opt.value = w.id;
      opt.textContent = `${w.name} - ${w.skill} (Ø³Ø¹Ø±: ${w.price} Ø¯Ø±Ù‡Ù…)`;
      workerSel.appendChild(opt);
    });
  }

  // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
  function updateRiskDisplay() {
    const routeId = document.getElementById('select-route').value;
    const truckId = document.getElementById('select-truck').value;
    const workerId = document.getElementById('select-worker').value;
    const qty = parseInt(document.getElementById('shipment-qty').value);

    if (!routeId || !truckId || !workerId || isNaN(qty)) {
      document.getElementById('risk-display').textContent = "Ø§Ø®ØªØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙˆØ§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©.";
      return;
    }

    let route = routes.find(r => r.id === routeId);
    let truck = trucks.find(t => t.id === truckId);
    let worker = workers.find(w => w.id === workerId);

    // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø±: Ø£Ø³Ø§Ø³ÙŠØ§Ù‹ + Ø®ØµØ§Ø¦Øµ + ÙƒÙ…ÙŠØ© + Ø³Ù…Ø¹Ø©
    let risk = route.baseRisk;
    risk -= truck.security; // Ø§Ù„Ø£Ù…Ø§Ù† ÙŠÙ‚Ù„Ù„ Ø§Ù„Ø®Ø·Ø±
    risk -= worker.skillValue * 5; // Ù…Ù‡Ø§Ø±Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ ØªÙ‚Ù„Ù„ Ø§Ù„Ø®Ø·Ø±
    risk += qty * 0.5; // ÙƒÙ„ ÙˆØ­Ø¯Ø© ØªØ²ÙŠØ¯ Ø§Ù„Ø®Ø·Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹
    risk -= reputation / 10; // Ø§Ù„Ø³Ù…Ø¹Ø© ØªÙ‚Ù„Ù„ Ø§Ù„Ø®Ø·Ø±

    if (risk < 5) risk = 5;
    if (risk > 95) risk = 95;

    document.getElementById('risk-display').textContent = `Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø±: ${risk.toFixed(1)}%`;
    shippingDetails = { route, truck, worker, qty, risk };
  }

  function validateShipmentQty() {
    const qtyInput = document.getElementById('shipment-qty');
    let val = parseInt(qtyInput.value);
    if (isNaN(val) || val < 1) {
      qtyInput.value = 1;
    }
    if (val > inventory) {
      qtyInput.value = inventory;
    }
    updateRiskDisplay();
  }

  // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´Ø­Ù†Ø©
  function sendShipment() {
    if (shippingInProgress) {
      alert("Ù‡Ù†Ø§Ùƒ Ø´Ø­Ù†Ø© Ø¬Ø§Ø±ÙŠØ© Ø¨Ø§Ù„ÙØ¹Ù„ØŒ Ø§Ù†ØªØ¸Ø± Ø§Ù†ØªÙ‡Ø§Ø¡Ù‡Ø§.");
      return;
    }
    if (!shippingDetails) {
      alert("Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³Ø§Ø±ØŒ Ø§Ù„Ø´Ø§Ø­Ù†Ø©ØŒ Ø§Ù„Ø³Ø§Ø¦Ù‚ØŒ ÙˆØ§Ù„ÙƒÙ…ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹.");
      return;
    }
    if (shippingDetails.qty > inventory) {
      alert("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ÙƒÙ…ÙŠØ© ÙƒØ§ÙÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.");
      return;
    }

    shippingInProgress = true;
    shippingTimer = 3 + stage; // Ù…Ø¯Ø© Ø§Ù„Ø´Ø­Ù† ØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø­Ù„Ø© (ØªØµØ§Ø¹Ø¯ÙŠ)
    addEventLog(`ğŸšš Ø£Ø±Ø³Ù„Øª Ø´Ø­Ù†Ø© Ù…Ù† ${shippingDetails.qty} ÙˆØ­Ø¯Ø© Ø¹Ø¨Ø± ${shippingDetails.route.name} Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ${shippingDetails.truck.name} Ù…Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ ${shippingDetails.worker.name}.`);

    // Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙÙˆØ±Ø§Ù‹
    inventory -= shippingDetails.qty;
    renderGangInfo();

    document.getElementById('shipping-status').textContent = `Ø§Ù„Ø´Ø­Ù† Ø¬Ø§Ø±Ù... ØªØ¨Ù‚Ù‰ ${shippingTimer} Ø¯ÙˆØ±Ø§Øª.`;

    // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ Ù„Ù„Ø¯ÙˆØ±Ø§Øª Ø¹Ø¨Ø± setInterval
    let intervalId = setInterval(() => {
      shippingTimer--;
      if (shippingTimer <= 0) {
        clearInterval(intervalId);
        completeShipment();
      } else {
        document.getElementById('shipping-status').textContent = `Ø§Ù„Ø´Ø­Ù† Ø¬Ø§Ø±Ù... ØªØ¨Ù‚Ù‰ ${shippingTimer} Ø¯ÙˆØ±Ø§Øª.`;
      }
    }, 5000); // ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ Ø¯ÙˆØ±Ø©
  }

  // Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø­Ù†Ø©
  function completeShipment() {
    shippingInProgress = false;

    // Ø§Ø­ØªÙ…Ø§Ù„ Ø¶Ø¨Ø· Ø§Ù„Ø´Ø­Ù†Ø© Ø­Ø³Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø±
    let chance = Math.random() * 100;
    if (chance < shippingDetails.risk) {
      // ØªÙ… Ø¶Ø¨Ø· Ø§Ù„Ø´Ø­Ù†Ø©
      addEventLog(`âŒ ØªÙ… Ø¶Ø¨Ø· Ø´Ø­Ù†ØªÙƒ Ø¹Ù„Ù‰ Ø·Ø±ÙŠÙ‚ ${shippingDetails.route.name}! Ø®Ø³Ø±Øª Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø© ÙˆØ§Ù„Ù…Ø§Ù„.`);
      // Ø®Ø³Ø§Ø±Ø© Ù…Ø§Ù„ ÙˆÙ†Ù‚Øµ Ø³Ù…Ø¹Ø©
      money -= shippingDetails.qty * 100; // Ø®Ø³Ø§Ø±Ø© Ù†Ù‚Ø¯ÙŠØ© ØªÙ‚Ø¯ÙŠØ±ÙŠØ©
      if (money < 0) money = 0;
      reputation -= 10;
      if (reputation < 0) reputation = 0;
    } else {
      // Ù†Ø¬Ø§Ø­ Ø§Ù„Ø´Ø­Ù†Ø©
      let profit = shippingDetails.qty * (200 + (stage * 50)); // Ø±Ø¨Ø­ ØªØµØ§Ø¹Ø¯ÙŠ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
      money += profit;
      addEventLog(`âœ… ÙˆØµÙ„Øª Ø´Ø­Ù†ØªÙƒ Ø¨Ø³Ù„Ø§Ù… ÙˆØ±Ø¨Ø­Øª ${profit} Ø¯Ø±Ù‡Ù….`);
      reputation += 5;
      if (reputation > 100) reputation = 100;
    }
    shippingDetails = null;
    document.getElementById('shipping-status').textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø­Ù†Ø§Øª Ø¬Ø§Ø±ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹.";
    renderGangInfo();
    updateMoneyDisplay();
    renderLoanInfo();
  }

  // ======================
  // Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª
  // ======================
  function renderUpgrades() {
    const truckDiv = document.getElementById('upgrade-trucks');
    truckDiv.innerHTML = '';
    trucks.forEach(t => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <b>${t.name}</b> - Ø£Ù…Ø§Ù†: ${t.security + t.upgrades.security} (ØªØ±Ù‚ÙŠØ©: ${t.upgrades.security}) 
        - Ø³Ø±Ø¹Ø©: ${t.speed + t.upgrades.speed} (ØªØ±Ù‚ÙŠØ©: ${t.upgrades.speed})
        - Ø³Ø¹Ø©: ${t.capacity + t.upgrades.capacity} (ØªØ±Ù‚ÙŠØ©: ${t.upgrades.capacity})
        <br />
        <button class="action-btn upgrade-btn" onclick="upgradeTruck('${t.id}', 'security')">ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø£Ù…Ø§Ù† (5000 Ø¯Ø±Ù‡Ù…)</button>
        <button class="action-btn upgrade-btn" onclick="upgradeTruck('${t.id}', 'speed')">ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø³Ø±Ø¹Ø© (5000 Ø¯Ø±Ù‡Ù…)</button>
        <button class="action-btn upgrade-btn" onclick="upgradeTruck('${t.id}', 'capacity')">ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø³Ø¹Ø© (5000 Ø¯Ø±Ù‡Ù…)</button>
      `;
      truckDiv.appendChild(card);
    });

    const workerDiv = document.getElementById('upgrade-workers');
    workerDiv.innerHTML = '';
    workers.forEach(w => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <b>${w.name}</b> - Ù…Ù‡Ø§Ø±Ø©: ${w.skill} - ÙˆÙ„Ø§Ø¡: ${w.loyalty}%
        <br />
        <button class="action-btn upgrade-btn" onclick="upgradeWorker('${w.id}')">ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø±Ø© (4000 Ø¯Ø±Ù‡Ù…)</button>
      `;
      workerDiv.appendChild(card);
    });
  }

  function upgradeTruck(id, feature) {
    if (money < 5000) {
      alert("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ù…Ø§ ÙŠÙƒÙÙŠ Ù…Ù† Ø§Ù„Ù…Ø§Ù„ Ù„ØªØ±Ù‚ÙŠØ©.");
      return;
    }
    const t = trucks.find(x => x.id === id);
    if (!t) return;

    t.upgrades[feature]++;
    money -= 5000;
    addEventLog(`âš™ï¸ ØªÙ… ØªØ±Ù‚ÙŠØ© ${feature} Ù„Ù„Ø´Ø§Ø­Ù†Ø© ${t.name}.`);
    renderGangInfo();
    updateMoneyDisplay();
    renderUpgrades();
  }

  function upgradeWorker(id) {
    if (money < 4000) {
      alert("Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ù…Ø§ ÙŠÙƒÙÙŠ Ù…Ù† Ø§Ù„Ù…Ø§Ù„ Ù„ØªØ±Ù‚ÙŠØ©.");
      return;
    }
    const w = workers.find(x => x.id === id);
    if (!w) return;
    // ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…Ù‡Ø§Ø±Ø© (Ø±ÙØ¹ Ù‚ÙŠÙ…Ø© skillValue ÙˆÙ†Ù‚Ø·Ø© ÙˆÙ„Ø§Ø¡)
    if (w.skillValue >= 5) {
      alert("Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù‡Ø§Ø±Ø© ÙÙŠ Ø£Ù‚ØµÙ‰ Ù…Ø³ØªÙˆÙ‰.");
      return;
    }
    w.skillValue++;
    w.loyalty += 10;
    w.price += 2000;
    money -= 4000;

    // ØªØ­Ø¯ÙŠØ« Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ø§Ø±Ø©
    const skills = ['Ù…Ø¨ØªØ¯Ø¦', 'Ù…ØªÙˆØ³Ø·', 'Ø±Ø§Ø¦Ø¹', 'Ø£Ø³Ø·ÙˆØ±ÙŠ', 'Ø¥Ø³Ø·ÙˆØ±Ø©', 'Ù…Ø§ÙÙŠØ§'];
    w.skill = skills[Math.min(w.skillValue - 1, skills.length -1)];

    addEventLog(`âš™ï¸ ØªÙ… ØªØ±Ù‚ÙŠØ© Ù…Ù‡Ø§Ø±Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ ${w.name} Ø¥Ù„Ù‰ ${w.skill}.`);
    renderGangInfo();
    updateMoneyDisplay();
    renderUpgrades();
  }

  // ========================
  // Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
  // ========================
  function addEventLog(text) {
    const now = new Date().toLocaleTimeString();
    eventsLog.unshift(`[${now}][Ø§Ù„Ø¯ÙˆØ± ${currentTurn}] ${text}`);
    if (eventsLog.length > 100) eventsLog.pop();
    document.getElementById('events-log').textContent = eventsLog.join('\n');
  }

  // ========================
  // ØªØ­Ø¯ÙŠØ«Ø§Øª Ø¯ÙˆØ±ÙŠØ© ÙˆØªÙ‚Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©
  // ========================
  function runTurn() {
    currentTurn++;

    // Ù‚Ø±ÙˆØ¶: Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ø³Ø¯Ø§Ø¯
    if (loanAmount > 0) {
      loanDueTurns--;
      if (loanDueTurns <= 0) {
        debtUnpaidTurns++;
        loanInterest += 5;
        loanDueTurns = 5;
        addEventLog(`âš ï¸ Ù„Ù… ØªØ³Ø¯Ø¯ Ø§Ù„Ù‚Ø±Ø¶ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø­Ø¯Ø¯. Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ø±ØªÙØ¹Øª Ø¥Ù„Ù‰ ${loanInterest}%.`);
      }
    }

    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ù…Ø¹ Ù…Ø±ÙˆØ± Ø§Ù„Ø²Ù…Ù†
    if (currentTurn % 10 === 0) {
      stage++;
      addEventLog(`ğŸ”¥ Ø§Ø±ØªÙØ¹ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ø¥Ù„Ù‰ ${stage}.`);
    }
  }

  // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
  function init() {
    renderGangInfo();
    renderWorkerSuppliers();
    renderTruckSuppliers();
    renderLoanInfo();
    populateShipmentsSelectors();
    renderUpgrades();
    addEventLog("ğŸ”¥ ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©. Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ù‡ÙŠÙ…Ù†Ø©!");
    updateRiskDisplay();
  }

  // ÙƒÙ„ 15 Ø«Ø§Ù†ÙŠØ© Ø¯ÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© (ØªØ³Ø§Ø±Ø¹ Ù…Ø¹ Ø§Ù„Ø²Ù…Ù† Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù…Ù…ÙƒÙ†)
  setInterval(() => {
    runTurn();
  }, 15000);

  // ØªØ­Ø¯ÙŠØ« Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø± Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
  document.getElementById('select-route').addEventListener('change', updateRiskDisplay);
  document.getElementById('select-truck').addEventListener('change', updateRiskDisplay);
  document.getElementById('select-worker').addEventListener('change', updateRiskDisplay);
  document.getElementById('shipment-qty').addEventListener('input', validateShipmentQty);

  // Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
  window.onload = init;

</script>

</body>
</html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ’€ Ø¥Ù…Ø¨Ø±Ø§Ø·ÙˆØ±ÙŠØ© Ø§Ù„Ø¸Ù„Ø§Ù… - Ù„Ø¹Ø¨Ø© Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠÙƒ Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡</title>
  <style>
    body {
      background: #0d0d0d;
      color: #eee;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
    }
    nav {
      background: #330000;
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 15px;
      border-bottom: 3px solid #ff0000;
    }
    nav button {
      background: #aa0000;
      border: none;
      padding: 10px 20px;
      color: white;
      font-weight: bold;
      font-size: 1em;
      cursor: pointer;
      border-radius: 6px;
      transition: background 0.3s;
    }
    nav button:hover, nav button.active {
      background: #ff0000;
    }
    .screen {
      display: none;
      padding: 20px;
    }
    .screen.active {
      display: block;
    }
    .card {
      background: #1a0a0a;
      padding: 15px;
      margin: 15px 0;
      border-radius: 8px;
      box-shadow: 0 0 10px #aa0000a0;
    }
    .action-btn {
      background: #aa0000;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      font-weight: bold;
      margin-top: 10px;
      cursor: pointer;
    }
    .action-btn:hover {
      background: #ff0000;
    }
    h1, h2, h3 {
      margin: 0 0 10px 0;
    }
    .data-line {
      margin: 5px 0;
    }
    select, input {
      padding: 8px;
      border: none;
      border-radius: 5px;
      margin: 5px 0 10px 0;
      width: 100%;
      background: #330000;
      color: white;
    }
    #log {
      background: #220000;
      padding: 10px;
      font-family: monospace;
      height: 150px;
      overflow-y: scroll;
      border: 1px solid #550000;
      margin-top: 15px;
      border-radius: 5px;
    }
  </style>
</head>
<body>
<script>
  // Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ©
  let money = 10000;
  let inventory = 0;
  let trucks = [];
  let workers = [];
  let level = 1;
  let reputation = 50;
  let loan = { amount: 0, rate: 10, turnsLeft: 5 };

  const items = [
    { name: "AK-47", type: "Ø³Ù„Ø§Ø­", price: 2000 },
    { name: "Cocaine", type: "Ù…Ø®Ø¯Ø±", price: 3500 },
    { name: "Pistol", type: "Ø³Ù„Ø§Ø­", price: 1000 },
    { name: "Meth", type: "Ù…Ø®Ø¯Ø±", price: 4000 }
  ];

  const routes = [
    { name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…ÙˆØª", risk: 70 },
    { name: "Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø±Ù‚ÙŠØ©", risk: 40 },
    { name: "Ù†ÙÙ‚ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡", risk: 60 },
    { name: "Ø·Ø±ÙŠÙ‚ Ø¢Ù…Ù†", risk: 20 }
  ];

  const availableTrucks = [
    { name: "Truck Z", speed: 7, security: 4, capacity: 80 },
    { name: "Armor Van", speed: 5, security: 9, capacity: 60 },
    { name: "Fast Hauler", speed: 9, security: 3, capacity: 100 }
  ];

  const availableWorkers = [
    { name: "Ø£Ù…ÙŠÙ†", skill: "Ù…Ø¨ØªØ¯Ø¦", value: 1 },
    { name: "ÙÙ‡Ø¯", skill: "Ù…ØªÙˆØ³Ø·", value: 2 },
    { name: "ÙŠØ§Ø³ÙŠÙ†", skill: "Ø±Ø§Ø¦Ø¹", value: 3 },
    { name: "Ø¬Ù…Ø§Ù„", skill: "Ø£Ø³Ø·ÙˆØ±ÙŠ", value: 5 }
  ];

  const log = [];

  // ====== Ø¯ÙˆØ§Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù„Ø¹Ø¨Ø© ======

  function updateUI() {
    document.getElementById("money").innerText = money;
    document.getElementById("inventory").innerText = inventory;
    document.getElementById("truckCount").innerText = trucks.length;
    document.getElementById("workerCount").innerText = workers.length;
    document.getElementById("level").innerText = level;
    document.getElementById("reputation").innerText = reputation;
    document.getElementById("logBox").innerText = log.join("\n");

    document.getElementById("marketItems").innerHTML = items.map((item, i) => `
      <div class="card">
        ${item.type} - <b>${item.name}</b> | Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø¯Ø±Ù‡Ù…
        <button onclick="buyItem(${i})" class="action-btn">Ø´Ø±Ø§Ø¡</button>
      </div>
    `).join("");

    document.getElementById("selectItem").innerHTML = items.map((item, i) => `
      <option value="${i}">${item.name}</option>
    `).join("");

    document.getElementById("selectWorker").innerHTML = workers.map((w, i) => `
      <option value="${i}">${w.name} (${w.skill})</option>
    `).join("");

    document.getElementById("selectTruck").innerHTML = trucks.map((t, i) => `
      <option value="${i}">${t.name}</option>
    `).join("");

    document.getElementById("selectRoute").innerHTML = routes.map((r, i) => `
      <option value="${i}">${r.name} - Ø®Ø·ÙˆØ±Ø©: ${r.risk}%</option>
    `).join("");

    document.getElementById("loanStatus").innerHTML = loan.amount > 0 ?
      `ğŸ’¸ Ù„Ø¯ÙŠÙƒ Ù‚Ø±Ø¶ Ø¨Ù€ ${loan.amount} Ø¯Ø±Ù‡Ù… Ø¨Ù†Ø³Ø¨Ø© ${loan.rate}%. Ø¨Ø§Ù‚ÙŠ ${loan.turnsLeft} Ø¯ÙˆØ±Ø©.` :
      `âœ”ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ù‚Ø±Ø¶ Ø­Ø§Ù„ÙŠØ§Ù‹.`;
  }

  function switchScreen(screen) {
    document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
    document.getElementById(screen).classList.add("active");
    document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
    event.target.classList.add("active");
  }

  function addLog(entry) {
    const time = new Date().toLocaleTimeString();
    log.unshift(`[${time}] ${entry}`);
    if (log.length > 100) log.pop();
    updateUI();
  }

  // ====== Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ======

  function buyItem(index) {
    const item = items[index];
    if (money >= item.price) {
      money -= item.price;
      inventory++;
      addLog(`ğŸ“¦ Ø§Ø´ØªØ±ÙŠØª ${item.name} Ù…Ù‚Ø§Ø¨Ù„ ${item.price} Ø¯Ø±Ù‡Ù….`);
    } else {
      alert("âŒ Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ù…Ø§Ù„ ÙƒØ§Ù.");
    }
  }

  function sendShipment() {
    const qty = parseInt(document.getElementById("shipmentQty").value);
    const item = items[document.getElementById("selectItem").value];
    const worker = workers[document.getElementById("selectWorker").value];
    const truck = trucks[document.getElementById("selectTruck").value];
    const route = routes[document.getElementById("selectRoute").value];

    if (!item || !worker || !truck || !route || isNaN(qty) || qty < 1 || qty > inventory) {
      alert("âŒ ØªØ£ÙƒØ¯ Ù…Ù† ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.");
      return;
    }

    let risk = route.risk - truck.security * 3 - worker.value * 4;
    if (risk < 5) risk = 5;

    document.getElementById("riskDisplay").innerText = `Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø±: ${risk}%`;

    const caught = Math.random() * 100 < risk;

    if (caught) {
      inventory -= qty;
      reputation -= 10;
      addLog(`âŒ ØªÙ… Ø¶Ø¨Ø· Ø´Ø­Ù†Ø© Ù…Ù† ${qty} Ã— ${item.name} Ø¹Ù„Ù‰ Ø·Ø±ÙŠÙ‚ ${route.name}.`);
    } else {
      inventory -= qty;
      const profit = qty * item.price * (1.2 + level * 0.1);
      money += Math.round(profit);
      reputation += 5;
      addLog(`âœ… Ø´Ø­Ù†Ø© Ù†Ø§Ø¬Ø­Ø©: ${qty} Ã— ${item.name}. Ø§Ù„Ø±Ø¨Ø­: ${Math.round(profit)} Ø¯Ø±Ù‡Ù….`);
    }

    updateUI();
  }

  function takeLoan() {
    const amt = parseInt(document.getElementById("loanAmountInput").value);
    const rate = parseInt(document.getElementById("loanRateInput").value);

    if (loan.amount > 0) {
      alert("Ù„Ø¯ÙŠÙƒ Ù‚Ø±Ø¶ Ø¬Ø§Ø±ÙŠ Ø¨Ø§Ù„ÙØ¹Ù„.");
      return;
    }

    if (amt < 1000 || rate < 5) {
      alert("âŒ ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¨Ù„Øº ÙˆØ§Ù„Ù†Ø³Ø¨Ø©.");
      return;
    }

    loan.amount = amt;
    loan.rate = rate;
    loan.turnsLeft = 5;
    money += amt;
    addLog(`ğŸ’¸ ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‚Ø±Ø¶ Ø¨Ù‚ÙŠÙ…Ø© ${amt} Ø¯Ø±Ù‡Ù….`);
    updateUI();
  }

  function payLoan() {
    const total = loan.amount + Math.round(loan.amount * loan.rate / 100);
    if (money >= total) {
      money -= total;
      loan = { amount: 0, rate: 10, turnsLeft: 0 };
      addLog(`âœ… ØªÙ… Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø±Ø¶ Ø¨Ù†Ø¬Ø§Ø­.`);
    } else {
      alert("âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„ÙƒØ§ÙÙŠ.");
    }
    updateUI();
  }

  // ====== Ø§Ù„ØªØ±Ù‚ÙŠØ§Øª ======

  function upgrade() {
    document.getElementById("upgradeOptions").innerHTML = `
      <div class="card">
        <h3>ğŸš› Ø´Ø±Ø§Ø¡ Ø´Ø§Ø­Ù†Ø©</h3>
        ${availableTrucks.map((t, i) => `
          <div>${t.name} - Ø³Ø¹Ø©: ${t.capacity}, Ø£Ù…Ø§Ù†: ${t.security}
          <button onclick="buyTruck(${i})" class="action-btn">Ø´Ø±Ø§Ø¡</button></div>
        `).join("")}
        <hr />
        <h3>ğŸ§â€â™‚ï¸ ØªÙˆØ¸ÙŠÙ Ø³Ø§Ø¦Ù‚</h3>
        ${availableWorkers.map((w, i) => `
          <div>${w.name} - ${w.skill}
          <button onclick="hireWorker(${i})" class="action-btn">ØªÙˆØ¸ÙŠÙ</button></div>
        `).join("")}
      </div>
    `;
  }

  function buyTruck(i) {
    const t = availableTrucks[i];
    const cost = 10000 + t.security * 1000;
    if (money >= cost) {
      trucks.push(t);
      money -= cost;
      addLog(`ğŸš› Ø§Ø´ØªØ±ÙŠØª ${t.name}`);
      updateUI();
    } else {
      alert("âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„ÙƒØ§ÙÙŠ.");
    }
  }

  function hireWorker(i) {
    const w = availableWorkers[i];
    const cost = 5000 + w.value * 1500;
    if (money >= cost) {
      workers.push(w);
      money -= cost;
      addLog(`ğŸ§â€â™‚ï¸ ÙˆØ¸Ù‘ÙØª ${w.name}`);
      updateUI();
    } else {
      alert("âŒ Ù„Ø§ ØªÙ…Ù„Ùƒ Ø§Ù„Ù…Ø§Ù„ Ø§Ù„ÙƒØ§ÙÙŠ.");
    }
  }

  // ====== ØªÙ‚Ø¯Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© ======
  setInterval(() => {
    level++;
    if (loan.amount > 0) {
      loan.turnsLeft--;
      if (loan.turnsLeft <= 0) {
        loan.rate += 5;
        loan.turnsLeft = 5;
        addLog(`âš ï¸ ØªØ£Ø®ÙŠØ± ÙÙŠ Ø³Ø¯Ø§Ø¯ Ø§Ù„Ù‚Ø±Ø¶. Ø§Ù„ÙØ§Ø¦Ø¯Ø© Ø§Ø±ØªÙØ¹Øª Ù„Ù€ ${loan.rate}%`);
      }
    }
    updateUI();
  }, 15000); // ÙƒÙ„ 15 Ø«Ø§Ù†ÙŠØ©

  window.onload = () => {
    trucks.push(availableTrucks[0]);
    workers.push(availableWorkers[0]);
    upgrade();
    updateUI();
  };
</script>
