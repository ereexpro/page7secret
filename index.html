<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إمبراطورية المخدرات - النسخة الأسطورية</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* الأنماط الأساسية */
        body {
            font-family: 'Courier New', monospace;
            background: #0f0f0f;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        #game-container {
            max-width: 1200px;
            margin: 0 auto;
            background: #1a1a1a;
            border: 2px solid #444;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 25px #ff4500;
        }
        
        /* أنماط الأقسام الجديدة */
        .property-card {
            background: #252525;
            border-left: 4px solid #ff4500;
            padding: 10px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .mission-item {
            background: #2a2a2a;
            border: 1px solid #555;
            padding: 8px;
            margin: 5px 0;
        }
        #crypto-chart {
            background: #1a1a2e;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .skill-bar {
            height: 10px;
            background: #333;
            margin: 5px 0;
            border-radius: 5px;
        }
        .skill-progress {
            height: 100%;
            background: #ff4500;
            border-radius: 5px;
            width: 0%;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>👑 إمبراطورية المخدرات - النسخة الأسطورية</h1>
        
        <!-- الإحصائيات الأساسية -->
        <div id="stats">
            <!-- ... (إحصائيات موجودة سابقاً) ... -->
            <div class="stat">
                <div>📊 المهارة</div>
                <div class="stat-value" id="skill-level">1</div>
            </div>
        </div>
        
        <!-- الأقسام الجديدة -->
        <div class="tab-system">
            <button class="tab-button active" onclick="openTab('main-tab')">الرئيسية</button>
            <button class="tab-button" onclick="openTab('properties-tab')">العقارات</button>
            <button class="tab-button" onclick="openTab('missions-tab')">المهام</button>
            <button class="tab-button" onclick="openTab('skills-tab')">المهارات</button>
            <button class="tab-button" onclick="openTab('crypto-tab')">الكريبتو</button>
        </div>
        
        <div id="main-tab" class="tab-content">
            <!-- المحتوى الأصلي -->
        </div>
        
        <div id="properties-tab" class="tab-content" style="display:none;">
            <h3>🏢 ممتلكاتك</h3>
            <div id="properties-list"></div>
            <button id="buy-property">شراء عقار جديد</button>
        </div>
        
        <div id="missions-tab" class="tab-content" style="display:none;">
            <h3>🎯 المهام اليومية</h3>
            <div id="missions-list"></div>
        </div>
        
        <div id="skills-tab" class="tab-content" style="display:none;">
            <h3>📚 شجرة المهارات</h3>
            <div id="skills-tree"></div>
        </div>
        
        <div id="crypto-tab" class="tab-content" style="display:none;">
            <h3>₿ سوق الكريبتو</h3>
            <div id="crypto-prices"></div>
            <canvas id="crypto-chart" width="400" height="200"></canvas>
        </div>
        
        <!-- الأقسام السابقة (الأكوان المتوازية، نهاية العالم، إلخ) -->
    </div>

    <script>
        // ======== الأنظمة الجديدة ======== //
        
        // 1. نظام العقارات
        const properties = {
            list: [
                { id: 1, name: "شقة آمنة", price: 50000, income: 2000, owned: false },
                { id: 2, name: "مخزن سري", price: 100000, income: 5000, owned: false }
            ],
            buyProperty(id) {
                const property = this.list.find(p => p.id === id);
                if (property && !property.owned && state.money >= property.price) {
                    property.owned = true;
                    state.money -= property.price;
                    addMessage(`✅ اشتريت ${property.name}! دخل يومي: $${property.income}`, "success");
                    updatePropertiesUI();
                }
            },
            collectIncome() {
                this.list.forEach(p => {
                    if (p.owned) state.money += p.income;
                });
            }
        };

        // 2. نظام المهام
        const missions = {
            active: [],
            generateDailyMissions() {
                this.active = [
                    { id: 1, title: "تهريب شحنة صغيرة", reward: 5000, risk: 0.3, completed: false },
                    { id: 2, title: "رشوة ضابط", reward: 3000, risk: 0.5, completed: false }
                ];
                updateMissionsUI();
            },
            completeMission(id) {
                const mission = this.active.find(m => m.id === id);
                if (mission && !mission.completed) {
                    mission.completed = true;
                    state.money += mission.reward;
                    state.policeSuspicion += mission.risk * 10;
                    addMessage(`🎉 أكملت المهمة: ${mission.title}! ربحت $${mission.reward}`, "success");
                    updateMissionsUI();
                }
            }
        };

        // 3. نظام المهارات
        const skills = {
            list: [
                { id: 1, name: "التخويف", level: 1, exp: 0, expToNext: 100 },
                { id: 2, name: "التفاوض", level: 1, exp: 0, expToNext: 100 }
            ],
            addExp(skillId, amount) {
                const skill = this.list.find(s => s.id === skillId);
                if (skill) {
                    skill.exp += amount;
                    if (skill.exp >= skill.expToNext) {
                        skill.level++;
                        skill.exp -= skill.expToNext;
                        skill.expToNext = Math.floor(skill.expToNext * 1.5);
                        addMessage(`📈 ارتفعت مهارة ${skill.name} إلى المستوى ${skill.level}!`, "success");
                    }
                    updateSkillsUI();
                }
            }
        };

        // 4. نظام الكريبتو
        const crypto = {
            prices: {
                bitcoin: { value: 50000, history: [] },
                monero: { value: 300, history: [] }
            },
            portfolio: {
                bitcoin: 0,
                monero: 0
            },
            updatePrices() {
                Object.keys(this.prices).forEach(crypto => {
                    const change = (Math.random() - 0.5) * 0.1;
                    this.prices[crypto].value *= (1 + change);
                    this.prices[crypto].history.push(this.prices[crypto].value);
                    if (this.prices[crypto].history.length > 20) {
                        this.prices[crypto].history.shift();
                    }
                });
                updateCryptoUI();
            },
            buy(cryptoName, amount) {
                const cost = this.prices[cryptoName].value * amount;
                if (state.money >= cost) {
                    this.portfolio[cryptoName] += amount;
                    state.money -= cost;
                    addMessage(`✅ اشتريت ${amount} ${cryptoName}`, "success");
                    updateCryptoUI();
                }
            }
        };

        // 5. نظام السمعة العالمية
        const internationalRep = {
            regions: {
                asia: 0,
                europe: 0,
                america: 0
            },
            updateReputation(region, amount) {
                this.regions[region] = Math.max(0, Math.min(100, this.regions[region] + amount));
                if (amount > 0) {
                    addMessage(`🌍 تحسنت سمعتك في ${region} إلى ${this.regions[region]}%`, "success");
                }
            }
        };

        // 6. نظام الأمراض
        const health = {
            addiction: 0,
            diseases: [],
            update() {
                if (state.drugs > 500) this.addiction += 5;
                if (this.addiction >= 50 && Math.random() < 0.1) {
                    this.diseases.push("إدمان شديد");
                    addMessage("⚠️ أصبت بإدمان شديد تحتاج إلى علاج!", "alert");
                }
            }
        };

        // 7. نظام الإنجازات
        const achievements = {
            list: [
                { id: "first_sale", name: "أول عملية بيع", unlocked: false },
                { id: "drug_lord", name: "ملك المخدرات", unlocked: false }
            ],
            unlock(id) {
                const achievement = this.list.find(a => a.id === id);
                if (achievement && !achievement.unlocked) {
                    achievement.unlocked = true;
                    addMessage(`🏆 إنجاز مفتوح: ${achievement.name}!`, "success");
                }
            }
        };

        // 8. نظام التقارير الإخبارية
        const news = {
            events: [
                "شرطة تكثف حملاتها على تجار المخدرات",
                "زيادة الطلب على المخدرات في السوق السوداء"
            ],
            generate() {
                if (Math.random() < 0.3) {
                    const randomNews = this.events[Math.floor(Math.random() * this.events.length)];
                    addMessage(`📰 خبر عاجل: ${randomNews}`, "event");
                }
            }
        };

        // 9. نظام الأسلحة الخاصة
        const specialWeapons = {
            list: [
                { name: "بندقية هجومية", price: 15000, power: 20, owned: false },
                { name: "قنابل دخانية", price: 8000, power: 10, owned: false }
            ]
        };

        // 10. نظام التخفي
        const stealth = {
            level: 1,
            update() {
                this.level = Math.max(1, Math.min(10, 
                    skills.list.find(s => s.name === "التخفي")?.level || 1
                ));
            },
            getDetectionChance() {
                return 0.5 - (this.level * 0.04);
            }
        };

        // 11. نظام الاحتجاجات
        const protests = {
            active: false,
            check() {
                if (state.reputation < 30 && Math.random() < 0.2) {
                    this.active = true;
                    addMessage("✊ احتجاجات شعبية ضد عصابتك! المبيعات تنخفض.", "alert");
                }
            }
        };

        // 12. نظام السيارات
        const vehicles = {
            list: [
                { name: "سيارة سريعة", price: 30000, speed: 2, owned: false },
                { name: "شاحنة تهريب", price: 50000, capacity: 1000, owned: false }
            ]
        };

        // 13. نظام المخبرين
        const informants = {
            count: 0,
            cost: 10000,
            hire() {
                if (state.money >= this.cost) {
                    this.count++;
                    state.money -= this.cost;
                    addMessage("🕵️‍♂️ وظفت مخبراً جديداً في صفوف الشرطة!", "success");
                }
            }
        };

        // 14. نظام الفصائل الدينية
        const religiousGroups = {
            influence: 0,
            affectBusiness() {
                if (this.influence > 50) {
                    state.reputation -= 5;
                    addMessage("⛪ الفصائل الدينية تضغط على عملك!", "alert");
                }
            }
        };

        // 15. نظام الطقس
        const weather = {
            current: "عادي",
            update() {
                const conditions = ["عاصف", "ممطر", "جاف", "عاصفة رملية"];
                if (Math.random() < 0.1) {
                    this.current = conditions[Math.floor(Math.random() * conditions.length)];
                    addMessage(`☁️ الطقس اليوم: ${this.current} - قد يؤثر على عملياتك`, "event");
                }
            }
        };

        // 16. نظام السجون
        const prison = {
            escapeChance: 0.3,
            arrested: false,
            tryEscape() {
                if (this.arrested && Math.random() < this.escapeChance) {
                    this.arrested = false;
                    addMessage("🔓 نجحت في الهروب من السجن!", "success");
                }
            }
        };

        // 17. نظام العملات الأجنبية
        const foreignCurrency = {
            exchangeRates: {
                usd: 1,
                eur: 0.85,
                gbp: 0.75
            },
            convert(amount, from, to) {
                return (amount / this.exchangeRates[from]) * this.exchangeRates[to];
            }
        };

        // 18. نظام التوظيف
        const recruitment = {
            candidates: [
                { name: "سائق", skill: "قيادة", cost: 2000 },
                { name: "قرصان كمبيوتر", skill: "اختراق", cost: 5000 }
            ]
        };

        // 19. نظام الأحداث التاريخية
        const historicalEvents = {
            events: [
                { name: "أزمة اقتصادية", effect: () => state.drugPrice *= 0.7 },
                { name: "حرب عصابات", effect: () => state.gangs.forEach(g => g.power += 10) }
            ],
            trigger() {
                if (Math.random() < 0.05) {
                    const event = this.events[Math.floor(Math.random() * this.events.length)];
                    event.effect();
                    addMessage(`🗓️ حدث تاريخي: ${event.name}!`, "event");
                }
            }
        };

        // 20. نظام الذكريات
        const memories = {
            list: [],
            add(memory) {
                this.list.push({
                    day: state.day,
                    text: memory
                });
                if (this.list.length > 10) this.list.shift();
            }
        };

        // ======== تحديث واجهات المستخدم ======== //
        
        function updatePropertiesUI() {
            let html = '';
            properties.list.forEach(prop => {
                html += `
                <div class="property-card" onclick="properties.buyProperty(${prop.id})" 
                     style="${prop.owned ? 'border-color:#00ff7f;background:#1a2a1a' : ''}">
                    <h4>${prop.name} ${prop.owned ? '✅' : ''}</h4>
                    <p>السعر: $${prop.price.toLocaleString()}</p>
                    <p>الدخل: $${prop.income}/يوم</p>
                </div>`;
            });
            document.getElementById('properties-list').innerHTML = html;
        }

        function updateMissionsUI() {
            let html = '';
            missions.active.forEach(mission => {
                html += `
                <div class="mission-item" onclick="missions.completeMission(${mission.id})"
                     style="${mission.completed ? 'opacity:0.5' : ''}">
                    <h4>${mission.title}</h4>
                    <p>المكافأة: $${mission.reward}</p>
                    <p>الخطر: ${mission.risk * 100}%</p>
                    ${mission.completed ? '<p>✔️ مكتمل</p>' : ''}
                </div>`;
            });
            document.getElementById('missions-list').innerHTML = html;
        }

        function updateSkillsUI() {
            let html = '';
            skills.list.forEach(skill => {
                const percent = Math.floor((skill.exp / skill.expToNext) * 100);
                html += `
                <div>
                    <h4>${skill.name} (المستوى ${skill.level})</h4>
                    <div class="skill-bar">
                        <div class="skill-progress" style="width:${percent}%"></div>
                    </div>
                    <p>${skill.exp}/${skill.expToNext} خبرة</p>
                </div>`;
            });
            document.getElementById('skills-tree').innerHTML = html;
        }

        function updateCryptoUI() {
            // تحديث الأسعار
            let html = `
            <div>
                <h4>₿ البيتكوين: $${crypto.prices.bitcoin.value.toFixed(2)}</h4>
                <button onclick="crypto.buy('bitcoin', 1)">شراء 1 بيتكوين</button>
                <p>تملك: ${crypto.portfolio.bitcoin}</p>
            </div>
            <div>
                <h4>Ⓜ️ المونيرو: $${crypto.prices.monero.value.toFixed(2)}</h4>
                <button onclick="crypto.buy('monero', 10)">شراء 10 مونيرو</button>
                <p>تملك: ${crypto.portfolio.monero}</p>
            </div>`;
            document.getElementById('crypto-prices').innerHTML = html;
            
            // تحديث الرسم البياني
            updateCryptoChart();
        }

        function updateCryptoChart() {
            const ctx = document.getElementById('crypto-chart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: crypto.prices.bitcoin.history.length}, (_, i) => i+1),
                    datasets: [
                        {
                            label: 'بيتكوين',
                            data: crypto.prices.bitcoin.history,
                            borderColor: '#f7931a',
                            tension: 0.1
                        },
                        {
                            label: 'مونيرو',
                            data: crypto.prices.monero.history,
                            borderColor: '#ff6600',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }

        // ======== التكامل مع النظام الأساسي ======== //
        
        function nextDay() {
            // الأنظمة الجديدة
            properties.collectIncome();
            crypto.updatePrices();
            health.update();
            weather.update();
            historicalEvents.trigger();
            
            // الباقي...
        }

        // ======== تهيئة اللعبة ======== //
        
        function initGame() {
            missions.generateDailyMissions();
            setInterval(() => crypto.updatePrices(), 30000); // تحديث كل 30 ثانية
            
            // تهيئة الواجهات
            updatePropertiesUI();
            updateMissionsUI();
            updateSkillsUI();
            updateCryptoUI();
        }

        initGame();
    </script>
</body>
</html>
