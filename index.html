<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ‘¹ Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù„ÙˆØ¬ÙŠØ³ØªÙŠÙƒ Ø§Ù„Ø´ÙŠØ·Ø§Ù†ÙŠ - Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©</title>
<style>
  body {
    background: #0d0d0d;
    color: #e6e6e6;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    direction: rtl;
    padding: 20px;
    max-width: 1000px;
    margin: auto;
    user-select: none;
  }
  h1 {
    color: #ff1a1a;
    text-align: center;
    margin-bottom: 20px;
    text-shadow: 0 0 20px #ff0000;
  }
  .status-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    font-size: 16px;
    color: #bbb;
  }
  .client, .competitor {
    background: #222;
    padding: 15px;
    margin-bottom: 15px;
    border-radius: 12px;
    box-shadow: 0 0 20px #ff0000;
    transition: box-shadow 0.4s ease;
  }
  .client:hover, .competitor:hover {
    box-shadow: 0 0 35px #ff4c4c;
  }
  .client h2, .competitor h3 {
    margin-top: 0;
    color: #ff6666;
    user-select: text;
  }
  .stock-bar {
    background: #444;
    border-radius: 12px;
    overflow: hidden;
    margin: 10px 0 10px 0;
    height: 24px;
  }
  .stock-fill {
    height: 100%;
    background: #ff4c4c;
    width: 0%;
    transition: width 0.7s ease;
  }
  button {
    background: #330000;
    color: #ff4c4c;
    border: none;
    border-radius: 10px;
    padding: 12px 20px;
    margin-top: 8px;
    cursor: pointer;
    font-weight: bold;
    width: 100%;
    transition: background 0.3s ease;
    user-select: none;
  }
  button:hover:not(:disabled) {
    background: #550000;
  }
  button:disabled {
    background: #111;
    cursor: not-allowed;
    color: #660000;
  }
  #events, #analytics {
    background: #111;
    border-radius: 12px;
    padding: 12px;
    max-height: 180px;
    overflow-y: auto;
    margin-bottom: 20px;
    font-size: 14px;
    box-shadow: inset 0 0 10px #440000;
  }
  #feedback {
    margin-top: 10px;
    font-weight: bold;
    font-size: 20px;
    text-align: center;
    min-height: 26px;
    color: #ff4c4c;
    user-select: text;
  }
  #start-btn {
    background: #ff1a1a;
    margin-bottom: 20px;
    font-size: 20px;
    font-weight: bold;
  }
</style>
</head>
<body>

<h1>ğŸ‘¹ Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù„ÙˆØ¬ÙŠØ³ØªÙŠÙƒ Ø§Ù„Ø´ÙŠØ·Ø§Ù†ÙŠ - Ø§Ù„Ø³ÙŠØ·Ø±Ø© Ø§Ù„Ù…Ø·Ù„Ù‚Ø©</h1>

<div class="status-bar">
  <div>â±ï¸ Ø§Ù„ÙˆÙ‚Øª: <span id="time">0</span> Ø«Ø§Ù†ÙŠØ©</div>
  <div>ğŸ’  Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
  <div>ğŸ”¥ Ø§Ù„ØªØ­Ø¯ÙŠ: <span id="difficulty">1</span></div>
</div>

<button id="start-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø³ÙŠØ§Ø¯Ø© Ø§Ù„Ø´ÙŠØ·Ø§Ù†ÙŠØ©</button>

<div id="clients-container"></div>

<h3 style="color:#ff5555;">Ø§Ù„Ù…Ù†Ø§ÙØ³ÙˆÙ† Ø§Ù„ÙˆÙ‡Ù…ÙŠÙˆÙ†</h3>
<div id="competitors-container"></div>

<h3 style="color:#ff5555;">Ø³Ø¬Ù„ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</h3>
<div id="events"></div>

<h3 style="color:#ff5555;">Ù„ÙˆØ­Ø© ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø´ÙŠØ·Ø§Ù†</h3>
<div id="analytics"></div>

<div id="feedback"></div>

<script>
(() => {
  // --- Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ---
  const totalDays = 20;
  const maxDifficulty = 10;
  let day = 1;
  let score = 0;
  let timeElapsed = 0;
  let difficulty = 1;
  let gameActive = false;
  let gameTimer;

  // --- DOM Elements ---
  const timeElem = document.getElementById('time');
  const scoreElem = document.getElementById('score');
  const difficultyElem = document.getElementById('difficulty');
  const clientsContainer = document.getElementById('clients-container');
  const competitorsContainer = document.getElementById('competitors-container');
  const eventsElem = document.getElementById('events');
  const analyticsElem = document.getElementById('analytics');
  const feedbackElem = document.getElementById('feedback');
  const startBtn = document.getElementById('start-btn');

  // --- Ø®ØµØ§Ø¦Øµ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ---
  class AIClient {
    constructor(id, name, baseStock, maxStock, price, personality) {
      this.id = id;
      this.name = name;
      this.stock = baseStock;
      this.maxStock = maxStock;
      this.price = price;
      this.personality = personality; // 'Ø¬Ø´Ø¹', 'Ù…ØªØ±Ø¯Ø¯', 'Ø¹Ù†ÙŠØ¯', 'Ø°ÙƒÙŠ'
      this.mood = Math.random();
      this.demandBase = Math.floor(baseStock * 0.25);
      this.reorderPoint = Math.floor(baseStock * 0.5);
      this.reorderAmount = Math.floor(baseStock * 0.7);
      this.negotiationAttempts = 0;
    }

    decideDemand() {
      let base = this.demandBase;
      switch(this.personality) {
        case 'Ø¬Ø´Ø¹': base *= 1.3; break;
        case 'Ù…ØªØ±Ø¯Ø¯': base *= 0.8; break;
        case 'Ø¹Ù†ÙŠØ¯': base *= 1.1; break;
        case 'Ø°ÙƒÙŠ': base *= 1.0; break;
      }
      let fluctuation = (Math.random() - 0.5) * 0.3;
      let demand = Math.floor(base * (1 + this.mood + fluctuation));
      demand = Math.min(demand, this.stock);
      return Math.max(1, demand);
    }

    negotiate(offerPrice) {
      this.negotiationAttempts++;
      if (offerPrice < this.price * 0.85 && this.personality === 'Ø¹Ù†ÙŠØ¯') {
        return {accept: false, counterOffer: this.price * 0.95};
      }
      if (offerPrice > this.price * 1.15 && this.personality === 'Ø¬Ø´Ø¹') {
        return {accept: false, counterOffer: this.price * 1.1};
      }
      if (offerPrice >= this.price * 0.9 && offerPrice <= this.price * 1.1) {
        return {accept: true};
      }
      if (Math.random() < 0.5) return {accept: true};
      return {accept: false, counterOffer: this.price};
    }

    needsReorder() {
      return this.stock <= this.reorderPoint;
    }

    reorder() {
      if (this.needsReorder()) {
        this.stock += this.reorderAmount;
        this.negotiationAttempts = 0;
        return `Ø§Ù„Ø¹Ù…ÙŠÙ„ ${this.name} Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ±ÙŠØ¯ ${this.reorderAmount} ÙˆØ­Ø¯Ø© Ø¨Ø³Ø¹Ø± ${this.price.toFixed(0)} Ø¯Ø±Ù‡Ù….`;
      }
      return null;
    }

    updateStock(used) {
      this.stock -= used;
      if (this.stock < 0) this.stock = 0;
    }
  }

  // --- Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù…Ù†Ø§ÙØ³ Ø§Ù„ÙˆÙ‡Ù…ÙŠ ---
  class Competitor {
    constructor(id, name) {
      this.id = id;
      this.name = name;
      this.score = 0;
      this.price = 100 + Math.floor(Math.random() * 100);
      this.activityLevel = Math.random();
    }

    act() {
      // Ù…Ù†Ø§ÙØ³ ÙŠØ²ÙŠØ¯ Ù†Ù‚Ø§Ø·Ù‡ Ø¨Ø´ÙƒÙ„ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ø¹ ØµØ¹ÙˆØ¨Ø© Ù…ØªØ²Ø§ÙŠØ¯Ø©
      let gain = Math.floor(5 + this.activityLevel * 10 * difficulty * Math.random());
      this.score += gain;
      return `${this.name} Ø­Ù‚Ù‚ Ù†Ù‚Ø§Ø· +${gain}`;
    }
  }

  let clientsAI = [];
  let competitors = [];

  // --- Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© ---
  function createClients(level) {
    const personalities = ['Ø¬Ø´Ø¹', 'Ù…ØªØ±Ø¯Ø¯', 'Ø¹Ù†ÙŠØ¯', 'Ø°ÙƒÙŠ'];
    clientsAI = [];
    for (let i = 1; i <= level + 3; i++) {
      let baseStock = 100 + i * 20;
      let price = 80 + i * 20;
      let personality = personalities[i % personalities.length];
      clientsAI.push(new AIClient(i, `Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø´ÙŠØ·Ø§Ù†ÙŠ #${i}`, baseStock, baseStock * 2, price, personality));
    }
  }

  // --- Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù†Ø§ÙØ³ÙŠÙ† ÙˆÙ‡Ù…ÙŠÙŠÙ† ---
  function createCompetitors(level) {
    competitors = [];
    for (let i = 1; i <= level + 2; i++) {
      competitors.push(new Competitor(i, `Ù…Ù†Ø§ÙØ³ Ø§Ù„Ù„ÙˆØ¬ÙŠØ³ØªÙŠÙƒ #${i}`));
    }
  }

  // --- Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ---
  function displayClients() {
    clientsContainer.innerHTML = '';
    clientsAI.forEach(client => {
      let div = document.createElement('div');
      div.className = 'client';
      div.id = `client-${client.id}`;
      div.innerHTML = `
        <h2>${client.name} (${client.personality})</h2>
        <div>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: <span class="stock-value">${client.stock}</span> / ${client.maxStock}</div>
        <div class="stock-bar"><div class="stock-fill" style="width: ${(client.stock / client.maxStock) * 100}%"></div></div>
        <div>Ø§Ù„Ø³Ø¹Ø±: <b>${client.price.toFixed(0)} Ø¯Ø±Ù‡Ù…</b></div>
        <button onclick="manualReorder(${client.id})">Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ±ÙŠØ¯ ÙŠØ¯ÙˆÙŠ</button>
        <button onclick="negotiateClient(${client.id})">Ø§Ù„ØªÙØ§ÙˆØ¶ Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
      `;
      clientsContainer.appendChild(div);
    });
  }

  // --- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ† ---
  function displayCompetitors() {
    competitorsContainer.innerHTML = '';
    competitors.forEach(comp => {
      let div = document.createElement('div');
      div.className = 'competitor';
      div.id = `competitor-${comp.id}`;
      div.innerHTML = `
        <h3>${comp.name}</h3>
        <div>Ø§Ù„Ù†Ù‚Ø§Ø·: <span class="comp-score">${comp.score}</span></div>
      `;
      competitorsContainer.appendChild(div);
    });
  }

  // --- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ---
  function updateClientUI(client) {
    const div = document.getElementById(`client-${client.id}`);
    if (!div) return;
    div.querySelector('.stock-value').textContent = client.stock;
    div.querySelector('.stock-fill').style.width = Math.min(100, (client.stock / client.maxStock) * 100) + '%';
  }

  // --- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ† ---
  function updateCompetitorUI(comp) {
    const div = document.getElementById(`competitor-${comp.id}`);
    if (!div) return;
    div.querySelector('.comp-score').textContent = comp.score;
  }

  // --- ØªØ³Ø¬ÙŠÙ„ Ø­Ø¯Ø« ---
  function addEvent(text) {
    const p = document.createElement('p');
    p.textContent = `ğŸ“¢ ${text}`;
    eventsElem.prepend(p);
    if (eventsElem.childElementCount > 10) eventsElem.removeChild(eventsElem.lastChild);
  }

  // --- ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª ---
  function updateAnalytics() {
    let totalStock = clientsAI.reduce((a,c) => a + c.stock, 0);
    let totalMax = clientsAI.reduce((a,c) => a + c.maxStock, 0);
    let avgStock = (totalStock / totalMax) * 100;

    let analyticsText = `
      Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡: ${clientsAI.length}
      | Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${avgStock.toFixed(2)}%
      | Ø§Ù„Ù†Ù‚Ø§Ø·: ${score}
      | Ø§Ù„ÙŠÙˆÙ…: ${day} / ${totalDays}
      | Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©: ${difficulty}
    `;
    analyticsElem.textContent = analyticsText;
  }

  // --- ØªÙ†ÙÙŠØ° ÙŠÙˆÙ… Ø¬Ø¯ÙŠØ¯ ---
  function nextDay() {
    if (day > totalDays) {
      endGame(true);
      return;
    }
    addEvent(`--- Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙŠÙˆÙ… ${day} ---`);
    feedbackElem.textContent = '';

    // Ø¹Ù…Ù„Ø§Ø¡ ÙŠØ³ØªÙ‡Ù„ÙƒÙˆÙ† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø·Ù„Ø¨Ù‡Ù… Ø§Ù„Ø°ÙƒÙŠ
    clientsAI.forEach(client => {
      const demand = client.decideDemand();
      client.updateStock(demand);
      addEvent(`${client.name} Ø·Ù„Ø¨ ${demand} ÙˆØ­Ø¯Ø©.`);
      updateClientUI(client);
    });

    // Ù…Ù†Ø§ÙØ³ÙˆÙ† ÙŠØ­Ù‚Ù‚ÙˆÙ† Ù†Ù‚Ø§Ø·
    competitors.forEach(comp => {
      const result = comp.act();
      updateCompetitorUI(comp);
      addEvent(result);
    });

    // ØªØ­Ù‚Ù‚ Ø·Ù„Ø¨Ø§Øª Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ±ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    clientsAI.forEach(client => {
      if (client.needsReorder()) {
        const reorderMsg = client.reorder();
        if (reorderMsg) {
          score += 10;
          addEvent(reorderMsg);
          updateClientUI(client);
        }
      }
    });

    // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØµØ¹ÙˆØ¨Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹ ÙƒÙ„ 3 Ø£ÙŠØ§Ù…
    if (day % 3 === 0 && difficulty < maxDifficulty) {
      difficulty++;
      difficultyElem.textContent = difficulty;
      createClients(difficulty);
      createCompetitors(difficulty);
      displayClients();
      displayCompetitors();
      addEvent(`ğŸ”¥ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© Ø§Ø±ØªÙØ¹ Ø¥Ù„Ù‰ ${difficulty}`);
    }

    day++;
    updateAnalytics();
  }

  // --- Ø§Ù„ØªÙØ§ÙˆØ¶ Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ ---
  window.negotiateClient = function(clientId) {
    if (!gameActive) return;
    const client = clientsAI.find(c => c.id === clientId);
    if (!client) return;
    let offer = prompt(`Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù„${client.name} (Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: ${client.price.toFixed(0)} Ø¯Ø±Ù‡Ù…):`, client.price.toFixed(0));
    if (offer === null) return;
    offer = parseFloat(offer);
    if (isNaN(offer) || offer <= 0) {
      feedbackElem.textContent = 'âŒ Ø¹Ø±Ø¶ ØºÙŠØ± ØµØ§Ù„Ø­!';
      return;
    }
    const result = client.negotiate(offer);
    if (result.accept) {
      feedbackElem.textContent = `âœ”ï¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ ${client.name} Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ù€ ${offer.toFixed(0)} Ø¯Ø±Ù‡Ù…!`;
      score += 15;
    } else if (result.counterOffer) {
      feedbackElem.textContent = `âš ï¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø±ÙØ¶ Ø§Ù„Ø¹Ø±Ø¶! Ø¹Ø±Ø¶ Ù…Ø¶Ø§Ø¯: ${result.counterOffer.toFixed(0)} Ø¯Ø±Ù‡Ù…`;
    } else {
      feedbackElem.textContent = `âŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø±ÙØ¶ Ø§Ù„Ø¹Ø±Ø¶ ØªÙ…Ø§Ù…Ø§Ù‹.`;
    }
  };

  // --- Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ±ÙŠØ¯ ÙŠØ¯ÙˆÙŠ ---
  window.manualReorder = function(clientId) {
    if (!gameActive) return;
    const client = clientsAI.find(c => c.id === clientId);
    if (!client) return;
    if (client.stock + client.reorderAmount > client.maxStock) {
      feedbackElem.textContent = `âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙÙˆÙ‚ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ø¹Ù…ÙŠÙ„ ${client.name}`;
      return;
    }
    client.stock += client.reorderAmount;
    score += 5;
    updateClientUI(client);
    feedbackElem.textContent = `âœ”ï¸ Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ±ÙŠØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù„Ø¹Ù…ÙŠÙ„ ${client.name} ØªÙ…Øª Ø¨Ù†Ø¬Ø§Ø­! +5 Ù†Ù‚Ø§Ø·`;
    addEvent(`ØªÙ… Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ±ÙŠØ¯ ${client.reorderAmount} ÙˆØ­Ø¯Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù„Ù„Ø¹Ù…ÙŠÙ„ ${client.name}`);
  };

  // --- Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© ---
  function endGame(win) {
    gameActive = false;
    clearInterval(gameTimer);
    startBtn.disabled = false;
    feedbackElem.textContent = win ? `ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø£Ù†Øª Ø³ÙŠØ·Ø±ØªÙ… Ø¹Ù„Ù‰ Ø§Ù„Ù„ÙˆØ¬ÙŠØ³ØªÙŠÙƒ Ø§Ù„Ø´ÙŠØ·Ø§Ù†ÙŠ Ø¨Ù†Ø¬Ø§Ø­! Ù†Ù‚Ø§Ø·Ùƒ: ${score}` : 'âŒ Ø®Ø³Ø±Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!';
    addEvent('ğŸ† Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù†ØªÙ‡Øª.');
  }

  // --- Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© ---
  function startGame() {
    day = 1;
    score = 0;
    difficulty = 1;
    gameActive = true;
    startBtn.disabled = true;
    feedbackElem.textContent = '';
    timeElapsed = 0;
    difficultyElem.textContent = difficulty;
    createClients(difficulty);
    createCompetitors(difficulty);
    displayClients();
    displayCompetitors();
    updateAnalytics();
    eventsElem.innerHTML = '';

    if (gameTimer) clearInterval(gameTimer);
    gameTimer = setInterval(() => {
      timeElapsed++;
      timeElem.textContent = timeElapsed;
      if (timeElapsed % 15 === 0) {
        nextDay();
      }
    }, 1000);
  }

  startBtn.addEventListener('click', startGame);

  // ØªØµØ¯ÙŠØ± Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ HTML buttons
  window.manualReorder = window.manualReorder;
  window.negotiateClient = window.negotiateClient;

})();
</script>

</body>
</html>
