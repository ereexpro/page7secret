<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ‘‘ Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù„ÙˆØ¬ÙŠØ³ØªÙŠÙƒ - Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø´ÙŠØ·Ø§Ù†ÙŠ</title>
<style>
  body {
    background: #111;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    direction: rtl;
    padding: 20px;
    max-width: 900px;
    margin: auto;
    user-select: none;
  }
  h1 {
    color: #00ffe1;
    text-align: center;
    margin-bottom: 25px;
    text-shadow: 0 0 10px crimson;
  }
  .status-bar {
    font-size: 16px;
    color: #aaa;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    user-select: text;
  }
  .client {
    background: #222;
    padding: 18px;
    margin-bottom: 18px;
    border-radius: 12px;
    box-shadow: 0 0 15px crimson;
    transition: box-shadow 0.3s ease;
  }
  .client:hover {
    box-shadow: 0 0 25px #00ffe1;
  }
  .client h2 {
    margin-top: 0;
    color: #ff4c4c;
    user-select: text;
  }
  .stock-bar {
    background: #444;
    border-radius: 10px;
    overflow: hidden;
    margin: 10px 0 15px 0;
    height: 24px;
  }
  .stock-fill {
    height: 100%;
    background: #00ffe1;
    width: 0%;
    transition: width 0.6s ease;
  }
  button {
    background: #333;
    color: #eee;
    border: none;
    border-radius: 10px;
    padding: 12px 20px;
    margin-top: 10px;
    cursor: pointer;
    font-weight: bold;
    width: 100%;
    transition: background 0.3s ease;
    user-select: none;
  }
  button:hover:not(:disabled) {
    background: #555;
  }
  button:disabled {
    background: #111;
    cursor: not-allowed;
    color: #666;
  }
  #events {
    background: #222;
    border-radius: 12px;
    padding: 12px;
    max-height: 180px;
    overflow-y: auto;
    margin-bottom: 20px;
    font-size: 15px;
    box-shadow: inset 0 0 8px #000;
  }
  #feedback {
    margin-top: 12px;
    font-weight: bold;
    text-align: center;
    font-size: 20px;
    min-height: 26px;
    color: #ff4c4c;
    user-select: text;
  }
  #start-btn {
    background: crimson;
    margin-bottom: 25px;
    font-size: 18px;
  }
</style>
</head>
<body>

<h1>ğŸ‘‘ Ø³Ù„Ø·Ø§Ù† Ø§Ù„Ù„ÙˆØ¬ÙŠØ³ØªÙŠÙƒ - Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø´ÙŠØ·Ø§Ù†ÙŠ</h1>

<div class="status-bar">
  <div>â±ï¸ Ø§Ù„ÙˆÙ‚Øª: <span id="time">0</span> Ø«Ø§Ù†ÙŠØ©</div>
  <div>ğŸ’  Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
  <div>ğŸ”¥ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ­Ø¯ÙŠ: <span id="difficulty">1</span></div>
</div>

<button id="start-btn">Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø´ÙŠØ·Ø§Ù†ÙŠØ©</button>

<div id="clients-container"></div>

<div id="events"></div>

<div id="feedback"></div>

<script>
(() => {
  // --- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ­ÙƒÙ… ---
  let score = 0;
  let timeElapsed = 0;
  let difficultyLevel = 1;
  const maxDifficulty = 10;
  let day = 1;
  const totalDays = 15;
  let gameActive = false;
  let gameTimer;

  // --- Ø¹Ù†Ø§ØµØ± DOM ---
  const timeElem = document.getElementById("time");
  const scoreElem = document.getElementById("score");
  const difficultyElem = document.getElementById("difficulty");
  const clientsContainer = document.getElementById("clients-container");
  const eventsElem = document.getElementById("events");
  const feedbackElem = document.getElementById("feedback");
  const startBtn = document.getElementById("start-btn");

  // --- ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ---
  class AIClient {
    constructor(id, name, baseStock, maxStock, price, personality) {
      this.id = id;
      this.name = name;
      this.stock = baseStock;
      this.maxStock = maxStock;
      this.price = price;
      this.personality = personality; // 'Ø¬Ø´Ø¹', 'Ù…ØªØ±Ø¯Ø¯', 'Ø¹Ù†ÙŠØ¯', 'Ø°ÙƒÙŠ'
      this.mood = Math.random();
      this.demandBase = Math.floor(baseStock * 0.25);
      this.reorderPoint = Math.floor(baseStock * 0.5);
      this.reorderAmount = Math.floor(baseStock * 0.7);
      this.lastOfferPrice = price;
      this.negotiationAttempts = 0;
    }

    decideDemand() {
      // Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„ÙŠÙˆÙ…ÙŠ ÙŠØªØºÙŠØ± Ø­Ø³Ø¨ Ø§Ù„Ø´Ø®ØµÙŠØ© ÙˆØ§Ù„Ù…Ø²Ø§Ø¬
      let base = this.demandBase;
      switch(this.personality) {
        case 'Ø¬Ø´Ø¹': base *= 1.3; break;
        case 'Ù…ØªØ±Ø¯Ø¯': base *= 0.8; break;
        case 'Ø¹Ù†ÙŠØ¯': base *= 1.1; break;
        case 'Ø°ÙƒÙŠ': base *= 1.0; break;
      }
      let fluctuation = (Math.random() - 0.5) * 0.3; 
      let demand = Math.floor(base * (1 + this.mood + fluctuation));
      demand = Math.min(demand, this.stock);
      return Math.max(1, demand);
    }

    negotiate(offerPrice) {
      this.negotiationAttempts++;
      // Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Øª ØªÙØ§ÙˆØ¶ Ø­Ø³Ø¨ Ø§Ù„Ø´Ø®ØµÙŠØ©
      if (offerPrice < this.price * 0.85 && this.personality === 'Ø¹Ù†ÙŠØ¯') {
        // Ø¹Ù†ÙŠØ¯ ÙŠØ±ÙØ¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹
        return {accept: false, counterOffer: this.price * 0.95};
      }
      if (offerPrice > this.price * 1.15 && this.personality === 'Ø¬Ø´Ø¹') {
        // Ø¬Ø´Ø¹ ÙŠØ­Ø§ÙˆÙ„ Ø±ÙØ¹ Ø§Ù„Ø³Ø¹Ø± Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰
        return {accept: false, counterOffer: this.price * 1.1};
      }
      if (offerPrice >= this.price * 0.9 && offerPrice <= this.price * 1.1) {
        // Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø³Ø¹Ø± Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ù†Ø·Ù‚ÙŠ
        return {accept: true};
      }
      // Ù…ØªØ±Ø¯Ø¯ ÙˆØ£ÙŠ Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰: 50% ÙØ±ØµØ© Ù‚Ø¨ÙˆÙ„
      if (Math.random() < 0.5) return {accept: true};
      return {accept: false, counterOffer: this.price};
    }

    needsReorder() {
      return this.stock <= this.reorderPoint;
    }

    reorder() {
      if (this.needsReorder()) {
        this.stock += this.reorderAmount;
        this.negotiationAttempts = 0;
        return `Ø§Ù„Ø¹Ù…ÙŠÙ„ ${this.name} Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ±ÙŠØ¯ ${this.reorderAmount} ÙˆØ­Ø¯Ø© Ø¨Ø³Ø¹Ø± ${this.price.toFixed(0)} Ø¯Ø±Ù‡Ù….`;
      }
      return null;
    }

    updateStock(used) {
      this.stock -= used;
      if (this.stock < 0) this.stock = 0;
    }
  }

  // --- Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ù„Ø§Ø¡ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ---
  let clientsAI = [];

  function createClientsForDifficulty(level) {
    const personalities = ['Ø¬Ø´Ø¹', 'Ù…ØªØ±Ø¯Ø¯', 'Ø¹Ù†ÙŠØ¯', 'Ø°ÙƒÙŠ'];
    clientsAI = [];
    for (let i = 1; i <= level + 2; i++) {
      let baseStock = 100 + i * 30;
      let price = 80 + i * 25;
      let personality = personalities[i % personalities.length];
      clientsAI.push(new AIClient(i, `Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø§Ù„Ø´ÙŠØ·Ø§Ù†ÙŠ #${i}`, baseStock, baseStock * 2, price, personality));
    }
  }

  // --- Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø¹Ù…ÙŠÙ„ ---
  function createClientUI(client) {
    const div = document.createElement("div");
    div.className = "client";
    div.id = `client-${client.id}`;

    div.innerHTML = `
      <h2>${client.name} (${client.personality})</h2>
      <div>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ: <span class="stock-value">${client.stock}</span> / ${client.maxStock}</div>
      <div class="stock-bar"><div class="stock-fill" style="width: ${(client.stock / client.maxStock) * 100}%"></div></div>
      <div>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ: <b>${client.price.toFixed(0)} Ø¯Ø±Ù‡Ù…</b></div>
      <button onclick="manualReorder(${client.id})">Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ±ÙŠØ¯ (ÙŠØ¯ÙˆÙŠ)</button>
      <button onclick="negotiateClient(${client.id})">Ø§Ù„ØªÙØ§ÙˆØ¶ Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„</button>
    `;

    return div;
  }

  function displayClients() {
    clientsContainer.innerHTML = "";
    clientsAI.forEach(client => {
      clientsContainer.appendChild(createClientUI(client));
    });
  }

  function updateClientUI(client) {
    const clientDiv = document.getElementById(`client-${client.id}`);
    if (!clientDiv) return;
    clientDiv.querySelector(".stock-value").textContent = client.stock;
    const fillPercent = Math.min(100, (client.stock / client.maxStock) * 100);
    clientDiv.querySelector(".stock-fill").style.width = fillPercent + "%";
  }

  // --- Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« ---
  function addEvent(text) {
    const p = document.createElement("p");
    p.textContent = `ğŸ“¢ ${text}`;
    eventsElem.prepend(p);
    if (eventsElem.childElementCount > 7) {
      eventsElem.removeChild(eventsElem.lastChild);
    }
  }

  // --- Ø£Ù…Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ±ÙŠØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠ ---
  window.manualReorder = function(clientId) {
    if (!gameActive) return;
    const client = clientsAI.find(c => c.id === clientId);
    if (!client) return;

    if (client.stock + client.reorderAmount > client.maxStock) {
      feedbackElem.textContent = `âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø²ÙŠØ§Ø¯Ø© Ù…Ø®Ø²ÙˆÙ† ${client.name} ÙÙˆÙ‚ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰!`;
      return;
    }
    client.stock += client.reorderAmount;
    score += 10;
    updateClientUI(client);
    scoreElem.textContent = score;
    feedbackElem.textContent = `âœ”ï¸ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙˆØ±ÙŠØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠ Ù„Ù€ ${client.name} ØªÙ…Øª +10 Ù†Ù‚Ø§Ø·!`;
    addEvent(`ØªÙ… Ø·Ù„Ø¨ Ø¥Ø¹Ø§Ø¯Ø© ØªÙˆØ±ÙŠØ¯ ${client.reorderAmount} ÙˆØ­Ø¯Ø© Ù„Ù„Ø¹Ù…ÙŠÙ„ ${client.name} (ÙŠØ¯ÙˆÙŠ).`);
  };

  // --- ØªÙØ§ÙˆØ¶ Ù…Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ ---
  window.negotiateClient = function(clientId) {
    if (!gameActive) return;
    const client = clientsAI.find(c => c.id === clientId);
    if (!client) return;

    // Ø£Ù†Øª ØªÙ‚Ø¯Ù… Ø¹Ø±Ø¶ Ø³Ø¹Ø± (Ù†Ù…ÙˆØ°Ø¬ Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø¨ÙŠÙ† 80% Ùˆ 120% Ù…Ù† Ø§Ù„Ø³Ø¹Ø±)
    let offerPrice = client.price * (0.8 + Math.random() * 0.4);
    offerPrice = parseFloat(offerPrice.toFixed(2));
    addEvent(`âš”ï¸ ØªÙØ§ÙˆØ¶: Ù‚Ø¯Ù…Øª Ø¹Ø±Ø¶ Ø³Ø¹Ø± ${offerPrice} Ø¯Ø±Ù‡Ù… Ù„Ù„Ø¹Ù…ÙŠÙ„ ${client.name}.`);

    const result = client.negotiate(offerPrice);
    if (result.accept) {
      score += 15;
      client.price = offerPrice; // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªÙØ§ÙˆØ¶
      feedbackElem.textContent = `ğŸ‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ ${client.name} ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¹Ø± ${offerPrice.toFixed(2)} Ø¯Ø±Ù‡Ù…! +15 Ù†Ù‚Ø§Ø·`;
      addEvent(`âœ”ï¸ Ø§Ù„Ø¹Ù…ÙŠÙ„ ${client.name} Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø±Ø¶.`);
    } else {
      feedbackElem.textContent = `âŒ Ø§Ù„Ø¹Ù…ÙŠÙ„ ${client.name} Ø±ÙØ¶ Ø§Ù„Ø¹Ø±Ø¶ØŒ Ù‚Ø¯Ù… Ø¹Ø±Ø¶ Ù…Ø¶Ø§Ø¯ ${result.counterOffer.toFixed(2)} Ø¯Ø±Ù‡Ù…`;
      addEvent(`ğŸ’¥ Ø§Ù„Ø¹Ù…ÙŠÙ„ ${client.name} Ø±ÙØ¶ ÙˆØ·Ù„Ø¨ ${result.counterOffer.toFixed(2)} Ø¯Ø±Ù‡Ù….`);
      client.price = result.counterOffer;
    }
    updateClientUI(client);
    scoreElem.textContent = score;
  };

  // --- ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ… (ÙŠØªÙ… ÙƒÙ„ 12 Ø«Ø§Ù†ÙŠØ©) ---
  function nextDay() {
    if (!gameActive) return;

    if (day > totalDays) {
      endGame(true);
      return;
    }

    feedbackElem.textContent = "";
    addEvent(`-- Ø¨Ø¯Ø¡ Ø§Ù„ÙŠÙˆÙ… ${day} --`);
    difficultyElem.textContent = difficultyLevel;

    clientsAI.forEach(client => {
      const demand = client.decideDemand();
      client.updateStock(demand);
      addEvent(`ğŸ¤– ${client.name} Ø·Ù„Ø¨ ${demand} ÙˆØ­Ø¯Ø©.`);
      updateClientUI(client);

      if (client.needsReorder()) {
        const reorderMsg = client.reorder();
        if (reorderMsg) {
          addEvent(`âš ï¸ ${reorderMsg}`);
          score += 5;
          scoreElem.textContent = score;
          updateClientUI(client);
        }
      }
    });

    // ØªØ­Ù‚Ù‚ Ø®Ø³Ø§Ø±Ø© Ù†ÙØ§Ø¯ Ù…Ø®Ø²ÙˆÙ† Ø£ÙŠ Ø¹Ù…ÙŠÙ„
    const outOfStockClients = clientsAI.filter(c => c.stock === 0);
    if (outOfStockClients.length > 0) {
      endGame(false, outOfStockClients.map(c => c.name));
      return;
    }

    // Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹ ÙƒÙ„ 3 Ø£ÙŠØ§Ù…
    if (day % 3 === 0 && difficultyLevel < maxDifficulty) {
      difficultyLevel++;
      createClientsForDifficulty(difficultyLevel);
      displayClients();
      addEvent(`ğŸ”¥ ØªÙ… Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ­Ø¯ÙŠ Ø¥Ù„Ù‰ ${difficultyLevel}!`);
    }

    day++;
  }

  // --- Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© ---
  function endGame(won, outOfStockClients = []) {
    gameActive = false;
    clearInterval(gameTimer);
    disableButtons(true);
    if (won) {
      feedbackElem.style.color = '#00ff00';
      feedbackElem.textContent = `ğŸ† Ù…Ø¨Ø±ÙˆÙƒ! Ø£ÙƒÙ…Ù„Øª ${totalDays} Ø£ÙŠØ§Ù…. Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${score}`;
      addEvent("ğŸ‰ Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù†ØªÙ‡Øª Ø¨Ù†Ø¬Ø§Ø­!");
    } else {
      feedbackElem.style.color = '#ff4c4c';
      feedbackElem.textContent = `ğŸ’€ Ø®Ø³Ø±Øª! Ù†ÙØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ø¯Ù‰: ${outOfStockClients.join(", ")} ÙÙŠ Ø§Ù„ÙŠÙˆÙ… ${day-1}`;
      addEvent("âš ï¸ Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø¨Ø³Ø¨Ø¨ Ù†ÙØ§Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.");
    }
  }

  // --- ØªØ¹Ø·ÙŠÙ„ Ø£Ùˆ ØªÙ…ÙƒÙŠÙ† Ø£Ø²Ø±Ø§Ø± ---
  function disableButtons(disable) {
    const buttons = clientsContainer.querySelectorAll('button');
    buttons.forEach(btn => btn.disabled = disable);
  }

  // --- ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© ---
  function updateTime() {
    timeElapsed++;
    timeElem.textContent = timeElapsed;
  }

  // --- Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© ---
  function startGame() {
    score = 0;
    timeElapsed = 0;
    difficultyLevel = 1;
    day = 1;
    gameActive = true;
    feedbackElem.style.color = '#ff4c4c';
    feedbackElem.textContent = "";
    addEvent("ğŸš€ Ø¨Ø¯Ø£Øª Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø´Ø±ÙŠØ±Ø©!");
    createClientsForDifficulty(difficultyLevel);
    displayClients();
    disableButtons(false);
    scoreElem.textContent = score;
    difficultyElem.textContent = difficultyLevel;
    timeElem.textContent = timeElapsed;

    if (gameTimer) clearInterval(gameTimer);
    gameTimer = setInterval(() => {
      nextDay();
      updateTime();
    }, 12000);
  }

  // --- Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø²Ø± ---
  startBtn.addEventListener('click', () => {
    startGame();
  });

  // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© ---
  disableButtons(true);

  // --- ØªØ¹Ø±ÙŠØ¶ ÙˆØ¸Ø§Ø¦Ù Ø¹Ø§Ù„Ù…ÙŠØ© Ù„Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ HTML ---
  window.manualReorder = window.manualReorder;
  window.negotiateClient = window.negotiateClient;

})();
</script>

</body>
</html>
